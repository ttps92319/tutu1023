<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å­æ¯ç•«é¢Picture in picture</title>
      <link href="/tutu1023/2021/09/16/%E5%AD%90%E6%AF%8D%E7%95%AB%E9%9D%A2Picture%20in%20picture/"/>
      <url>/tutu1023/2021/09/16/%E5%AD%90%E6%AF%8D%E7%95%AB%E9%9D%A2Picture%20in%20picture/</url>
      
        <content type="html"><![CDATA[<p>  Createï¼š2021/05/11<br>  Updateï¼š2021/09/16<br>  Byï¼šAda<br>  Codeï¼šKotlin</p><p>è³‡æ–™ä¾†æºï¼š<br><span class="exturl"><a class="exturl__link"   href="https://developer.android.com/guide/topics/ui/picture-in-picture" >https://developer.android.com/guide/topics/ui/picture-in-picture</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><video autoplay controls width="350" loop>    <source type="video/mp4" src="https://developer.android.com/images/pip.mp4"></source></video><p><span class="exturl"><a class="exturl__link"   href="https://developer.android.com/images/pip.mp4" >https://developer.android.com/images/pip.mp4</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><hr>        <h2 id="å­æ¯ç•«é¢"   >          <a href="#å­æ¯ç•«é¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#å­æ¯ç•«é¢" class="headerlink" title="å­æ¯ç•«é¢"></a>å­æ¯ç•«é¢</h2>      <p><img src="https://i.imgur.com/yQjTBDx.jpg" alt="Imgur"></p><p>Android 8.0ï¼ˆAPI ç´šåˆ¥26ï¼‰å…è¨±ä»¥ç•«ä¸­ç•«(PIP)æ¨¡å¼å•Ÿå‹•Activityã€‚ç•«ä¸­ç•«æ˜¯ä¸€ç¨®ç‰¹æ®Šé¡å‹çš„å¤šçª—å£æ¨¡å¼ï¼Œæœ€å¸¸ç”¨æ–¼è¦–é »æ’­æ”¾ã€‚ä½¿ç”¨è©²æ¨¡å¼æ™‚ï¼Œç”¨æˆ¶å¯ä»¥é€šéå›ºå®šåˆ°å±å¹•ä¸€è§’çš„å°çª—å£è§€çœ‹è¦–é »ï¼ŒåŒæ™‚åœ¨æ‡‰ç”¨ä¹‹é–“é€²è¡Œå°èˆªæˆ–ç€è¦½ä¸»å±å¹•ä¸Šçš„å…§å®¹ã€‚</p><p>å¦‚è¦å°‡ç•«ä¸­ç•«æ·»åŠ åˆ°æ‚¨çš„æ‡‰ç”¨ä¸­ï¼Œæ‚¨éœ€è¦è¨»å†Šæ”¯æŒç•«ä¸­ç•«çš„Activityï¼Œæ ¹æ“šéœ€è¦å°‡Activity åˆ‡æ›ç‚ºç•«ä¸­ç•«æ¨¡å¼ï¼Œä¸¦ç¢ºä¿ç•¶Activity è™•æ–¼ç•«ä¸­ç•«æ¨¡å¼æ™‚ï¼Œç•Œé¢å…ƒç´ è™•æ–¼éš±è—ç‹€æ…‹ä¸”è¦–é »èƒ½å¤ ç¹¼çºŒæ’­æ”¾ã€‚</p><p>ç•«ä¸­ç•«çª—å£æœƒé¡¯ç¤ºåœ¨å±å¹•çš„æœ€ä¸Šå±¤ï¼Œä½æ–¼ç³»çµ±é¸æ“‡çš„ä¸€è§’ã€‚æ‚¨å¯ä»¥å°‡ç•«ä¸­ç•«çª—å£æ‹–å‹•åˆ°å…¶ä»–ä½ç½®ã€‚ç•¶æ‚¨é»æŒ‰è©²çª—å£æ™‚ï¼Œæœƒçœ‹åˆ°å…©å€‹ç‰¹æ®Šçš„æ§ä»¶ï¼šå…¨å±åˆ‡æ›é–‹é—œï¼ˆä½æ–¼çª—å£çš„ä¸­å¿ƒï¼‰å’Œé—œé–‰æŒ‰éˆ•ï¼ˆå³ä¸Šè§’çš„â€œXâ€ï¼‰ã€‚</p>        <h4 id="è²æ˜å°ç•«ä¸­ç•«çš„æ”¯æŒ"   >          <a href="#è²æ˜å°ç•«ä¸­ç•«çš„æ”¯æŒ" class="heading-link"><i class="fas fa-link"></i></a><a href="#è²æ˜å°ç•«ä¸­ç•«çš„æ”¯æŒ" class="headerlink" title="è²æ˜å°ç•«ä¸­ç•«çš„æ”¯æŒ"></a>è²æ˜å°ç•«ä¸­ç•«çš„æ”¯æŒ</h4>      <figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;activity</span><br><span class="line">    android:name=&quot;.PlayerActivity&quot;</span><br><span class="line">    android:configChanges=&quot;screenSize|smallestScreenSize|screenLayout|orientation|uiMode&quot;</span><br><span class="line">    android:launchMode=&quot;singleTask&quot;</span><br><span class="line">    android:supportsPictureInPicture=&quot;true&quot;&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span>       </span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h4 id="å°‡æ‚¨çš„Activity-åˆ‡æ›åˆ°ç•«ä¸­ç•«æ¨¡å¼"   >          <a href="#å°‡æ‚¨çš„Activity-åˆ‡æ›åˆ°ç•«ä¸­ç•«æ¨¡å¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#å°‡æ‚¨çš„Activity-åˆ‡æ›åˆ°ç•«ä¸­ç•«æ¨¡å¼" class="headerlink" title="å°‡æ‚¨çš„Activity åˆ‡æ›åˆ°ç•«ä¸­ç•«æ¨¡å¼"></a>å°‡æ‚¨çš„Activity åˆ‡æ›åˆ°ç•«ä¸­ç•«æ¨¡å¼</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N</span><br><span class="line">    &amp;&amp; packageManager.hasSystemFeature(PackageManager.FEATURE_PICTURE_IN_PICTURE))  <span class="comment">//ç¢ºä¿è¨­å‚™ç­‰ç´šã€å…§å­˜å¤ ç”¨</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) </span><br><span class="line">        enterPictureInPictureMode(PictureInPictureParams.Builder().build())</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        enterPictureInPictureMode()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="è™•ç†ç•«ä¸­ç•«æ¨¡å¼ä¸‹çš„ç•Œé¢å…ƒç´ "   >          <a href="#è™•ç†ç•«ä¸­ç•«æ¨¡å¼ä¸‹çš„ç•Œé¢å…ƒç´ " class="heading-link"><i class="fas fa-link"></i></a><a href="#è™•ç†ç•«ä¸­ç•«æ¨¡å¼ä¸‹çš„ç•Œé¢å…ƒç´ " class="headerlink" title="è™•ç†ç•«ä¸­ç•«æ¨¡å¼ä¸‹çš„ç•Œé¢å…ƒç´ "></a>è™•ç†ç•«ä¸­ç•«æ¨¡å¼ä¸‹çš„ç•Œé¢å…ƒç´ </h3>      <ul><li>åŠ å…¥è‡ªå®šç¾©æ§ä»¶ï¼šsetActions(actions: RemoteAction)</li><li>è¨­å®šç•«é¢æ¯”ä¾‹ï¼ˆéç•«é¢å¤§å°ï¼‰ï¼šsetAspectRatio(aspectRatio: Rational)</li></ul><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> actions = arrayListOf&lt;RemoteAction&gt;()</span><br><span class="line"><span class="keyword">val</span> remoteAction = RemoteAction(</span><br><span class="line">    Icon.createWithResource(<span class="keyword">this</span><span class="symbol">@PlayerActivity</span>, R.drawable.control_1), <span class="string">&quot;title&quot;</span>, <span class="string">&quot;contentDescription&quot;</span>,</span><br><span class="line">    PendingIntent.getBroadcast(<span class="keyword">this</span><span class="symbol">@PlayerActivity</span>, <span class="number">0</span>, Intent(<span class="string">&quot;MY_PIP_ACTION&quot;</span>), <span class="number">0</span>))</span><br><span class="line">actions.add(remoteAction)</span><br><span class="line"></span><br><span class="line">setPictureInPictureParams(PictureInPictureParams.Builder().setActions(actions).build())</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>P.S. åªè¦åŠ ä¸Šè‡ªå®šç¾©æ§ä»¶çš„ç¨‹å¼ç¢¼ï¼ŒGoogle Pixelè¨­å‚™å°±æœƒæœ‰å­æ¯ç•«é¢ç‰¹åˆ¥å¤§æˆ–ç„¡æ³•æ§åˆ¶çš„bugï¼Œä¸çŸ¥æ˜¯ä¸æ˜¯å°‘è¨­å®šäº†ä»€éº¼æ±è¥¿å°è‡´çš„ã€‚</p>        <h3 id="onPictureInPictureModeChanged"   >          <a href="#onPictureInPictureModeChanged" class="heading-link"><i class="fas fa-link"></i></a><a href="#onPictureInPictureModeChanged" class="headerlink" title="onPictureInPictureModeChanged"></a>onPictureInPictureModeChanged</h3>      <p>åˆ©ç”¨onPictureInPictureModeChangedæ–¹æ³•å»é¡¯ç¤º/éš±è—controller</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPictureInPictureModeChanged</span><span class="params">(isInPictureInPictureMode: <span class="type">Boolean</span>, newConfig: <span class="type">Configuration</span>?)</span></span> &#123;</span><br><span class="line">    simpleExoPlayerView?.useController = !isInPictureInPictureMode</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="æ¸¬è©¦çµæœ"   >          <a href="#æ¸¬è©¦çµæœ" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ¸¬è©¦çµæœ" class="headerlink" title="æ¸¬è©¦çµæœ"></a>æ¸¬è©¦çµæœ</h3>      <video controls width="350">  <source type="video/mp4" src="https://i.imgur.com/fHu9vHb.mp4"></source></video><p><span class="exturl"><a class="exturl__link"   href="https://i.imgur.com/fHu9vHb.mp4" >https://i.imgur.com/fHu9vHb.mp4</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h2 id="ç™¼ç¾å•é¡Œ"   >          <a href="#ç™¼ç¾å•é¡Œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç™¼ç¾å•é¡Œ" class="headerlink" title="ç™¼ç¾å•é¡Œ"></a>ç™¼ç¾å•é¡Œ</h2>      <p>çœ‹éæ¸¬è©¦çµæœä¹‹å¾Œï¼Œå†è§€å¯ŸYouTube Premium ä¾ç…§ä½¿ç”¨è€…ç¿’æ…£/å–œå¥½ä»¥åŠPIPæ¨¡å¼æ‰€è¦åŠƒçš„ä¸€ç³»åˆ—ä½¿ç”¨æµç¨‹ï¼Œé»å‡ºå¹¾å€‹çš®å…‹é€™é‚Šä¸é †æš¢çš„åœ°æ–¹ã€‚</p><p>é¦–å…ˆå…ˆä¾†çœ‹çœ‹YouTube Premium ä»¥åŠ Chrome å°æ–¼å­æ¯ç•«é¢çš„ä½¿ç”¨æµç¨‹</p><p>ğŸ‘‡ğŸ» YouTube Premium</p><p>å½±ç‰‡æŒ‰ä½ä¸‹æ‹‰â¡ï¸å…§éƒ¨å­æ¯ç•«é¢â¡ï¸æŒ‰ä¸‹homeéµâ¡ï¸é€²å…¥å­æ¯ç•«é¢</p><p><img src="https://i.imgur.com/c43q0k4.png" alt="Imgur"></p><p>ğŸ‘‡ğŸ» Chromeç€è¦½å™¨</p><p>å½±ç‰‡åœ¨å…¨è¢å¹•çš„ç‹€æ…‹ä¸‹æŒ‰homeéµæ‰æœƒè®Šæˆå­æ¯ç•«é¢</p><video controls width="350">  <source type="video/mp4" src="https://imgur.com/6jYHXBW.mp4"></source></video><p><span class="exturl"><a class="exturl__link"   href="https://imgur.com/6jYHXBW.mp4" >https://imgur.com/6jYHXBW.mp4</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><video controls width="350">  <source type="video/mp4" src="https://i.imgur.com/fHu9vHb.mp4"></source></video><p><span class="exturl"><a class="exturl__link"   href="https://i.imgur.com/fHu9vHb.mp4" >https://i.imgur.com/fHu9vHb.mp4</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>ç›¸æ¯”Chromeç€è¦½å™¨ï¼Œåœ¨çš®å…‹é€™é‚Šï¼Œæˆ‘å€‘ç™¼ç¾æ’­æ”¾é å’ŒåŸæœ¬APPæœƒè¢«ç¨ç«‹åˆ‡é–‹ä¾†ã€‚åœ¨å­æ¯ç•«é¢/æ’­æ”¾é ä¸­ä¸ç®¡æ€éº¼æ“ä½œéƒ½å›ä¸äº†Appåˆ—è¡¨é ï¼Œåªèƒ½é€éèƒŒæ™¯åŸ·è¡Œç¨‹å¼å›å»ã€‚</p><p>è€Œé»æ“ŠChromeçš„å­æ¯ç•«é¢å¾Œï¼Œå­æ¯ç•«é¢æœƒå±•é–‹å›åˆ°å…¨è¢å¹•æ¨¡å¼ï¼ŒæŒ‰ä¸‹è¿”å›éµæ™‚æ˜¯é€€å‡ºå…¨è¢å¹•å›åˆ°ç¶²é æ¨¡å¼ï¼Œè€Œéå†æ¬¡è®Šæˆå­æ¯ç•«é¢ã€‚</p>        <h2 id="è§€å¯Ÿèˆ‡æ¯”è¼ƒChromeã€YouTube-Premiumçš„åšæ³•"   >          <a href="#è§€å¯Ÿèˆ‡æ¯”è¼ƒChromeã€YouTube-Premiumçš„åšæ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#è§€å¯Ÿèˆ‡æ¯”è¼ƒChromeã€YouTube-Premiumçš„åšæ³•" class="headerlink" title="è§€å¯Ÿèˆ‡æ¯”è¼ƒChromeã€YouTube Premiumçš„åšæ³•"></a>è§€å¯Ÿèˆ‡æ¯”è¼ƒChromeã€YouTube Premiumçš„åšæ³•</h2>      <p>åˆ—å‡ºå¹¾é»ç›¸ç•°çš„éƒ¨åˆ†ï¼Œä¸¦è©¦è‘—åˆ†æGoogleç”¢å“ä½¿ç”¨å­æ¯ç•«é¢æ™‚æ‰€æ‡‰ç”¨çš„ç³»çµ±æ¶æ§‹ã€‚</p>        <h3 id="æœ€è¿‘ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼-00-21-vs-00-20"   >          <a href="#æœ€è¿‘ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼-00-21-vs-00-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#æœ€è¿‘ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼-00-21-vs-00-20" class="headerlink" title="æœ€è¿‘ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼ 00:21 vs. 00:20"></a>æœ€è¿‘ä½¿ç”¨çš„æ‡‰ç”¨ç¨‹å¼ 00:21 vs. 00:20</h3>      <p>é–‹å•Ÿå­æ¯ç•«é¢å¾Œï¼ŒGoogleæ‡‰ç”¨ç¨‹å¼åœ¨èƒŒæ™¯åŸ·è¡Œç¨‹å¼æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œä½†çš®å…‹ä»ç„¶èƒ½åœ¨èƒŒæ™¯åŸ·è¡Œç¨‹å¼ä¸­çœ‹åˆ°ã€‚</p>        <h3 id="å†æ¬¡ç¸®å°æ™‚æ²’æœ‰è¿”å›app-00-28-vs-YouTube-Premium"   >          <a href="#å†æ¬¡ç¸®å°æ™‚æ²’æœ‰è¿”å›app-00-28-vs-YouTube-Premium" class="heading-link"><i class="fas fa-link"></i></a><a href="#å†æ¬¡ç¸®å°æ™‚æ²’æœ‰è¿”å›app-00-28-vs-YouTube-Premium" class="headerlink" title="å†æ¬¡ç¸®å°æ™‚æ²’æœ‰è¿”å›app 00:28 vs. YouTube Premium"></a>å†æ¬¡ç¸®å°æ™‚æ²’æœ‰è¿”å›app 00:28 vs. YouTube Premium</h3>      <p>ç•¶åœ¨æ¡Œé¢/å…¶ä»–æ‡‰ç”¨ç¨‹å¼ä¸­é»æ“Šå­æ¯ç•«é¢æ™‚ï¼Œå­æ¯ç•«é¢æœƒæ“´å±•æˆåŸå…ˆçš„æ’­æ”¾é ã€‚YouTubeå¯ä»¥é¸æ“‡å†æ¬¡å°‡å½±ç‰‡ä¸‹æ‹‰æˆå°æ’­æ”¾æ§åˆ¶å™¨ï¼Œæˆ–ç›´æ¥æŒ‰ä¸‹homeéµå›åˆ°æ¡Œé¢ä¸¦ç”Ÿæˆå­æ¯ç•«é¢ï¼Œä½†çš®å…‹å¾å­æ¯ç•«é¢å›ä¾†ä¹‹å¾Œï¼ŒæŒ‰è¿”å›éµç¸®å›å­æ¯ç•«é¢å¾Œå»æ˜¯å›åˆ°æ¡Œé¢ã€‚</p>        <h3 id="åˆ†æåŸå› "   >          <a href="#åˆ†æåŸå› " class="heading-link"><i class="fas fa-link"></i></a><a href="#åˆ†æåŸå› " class="headerlink" title="åˆ†æåŸå› "></a>åˆ†æåŸå› </h3>      <p>å…¶å¯¦æ—©å…ˆç‚ºäº†å¦å¤–ä¸€å€‹å•é¡Œåœ¨çˆ¬æ–‡çš„æ™‚å€™ï¼Œæœ‰çœ‹é stackflow è¨è«–ä¸²èªªæ˜ YouTube å°‡æ‰€æœ‰æ±è¥¿å¯«åœ¨ä¸€èµ·ã€‚ä¸¦ä¸”PIPæ¨¡å¼çš„æ¨™æº–è¡Œç‚ºï¼Œä¾¿æ˜¯å›æ¡Œé¢å¾Œé»é–‹å­æ¯ç•«é¢ï¼Œå†è¿”å›æœƒä»ç„¶æœƒå›åˆ°æ¡Œé¢ã€‚</p><p>ç¶œåˆä»¥ä¸Šå¹¾é»ï¼Œæˆ‘æ¨è«–å‡º Android ç«¯çš„å­æ¯ç•«é¢ï¼Œæ˜¯å°‡æ•´å€‹ Activity æ´»å‹•é çµ¦åŒ…è£é€²å­æ¯ç•«é¢çš„æ¡†æ¶ä¸­ï¼Œæœ‰åˆ¥æ–¼ iOS æ˜¯å°‡æ’­æ”¾å™¨ç•«é¢å«æ¥çµ¦ç³»çµ±çš„æ‡¸æµ®æ’­æ”¾å™¨ã€‚ iOS åœ¨ä½¿ç”¨å­æ¯ç•«é¢æ™‚ï¼ŒåŸå…ˆæ’­æ”¾é æœƒé¡¯ç¤ºï¼šã€Œæ­¤å½±ç‰‡æ­£åœ¨ä»¥å­æ¯ç•«é¢æ’­æ”¾ã€ï¼Œä½†å®‰å“ç«¯æœƒå°‡æ•´å€‹æ’­æ”¾é åƒé€²å­æ¯ç•«é¢ã€‚æœƒç™¼ç¾åƒé€²æ•´å€‹æ’­æ”¾é ï¼Œæ˜¯å› ç‚ºå‰æœŸåœ¨æ¸¬è©¦å­æ¯ç•«é¢æ™‚ï¼Œèª¤æ‰“èª¤æ’åœ¨å­æ¯ç•«é¢è£¡çœ‹è¦‹æ’­æ”¾é ä¸‹æ–¹çš„èŠå¤©å®¤ã€‚</p><p>è‹¥æ˜¯å°‡ <code>android:supportsPictureInPicture=&quot;true&quot;</code> å¯«åœ¨ Application çš„è²æ˜ä¸­æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚æ‰€ä»¥åœ¨åªæœ‰ä¸€å€‹ Activity èƒ½å¤ è¢«è£åˆ°å­æ¯ç•«é¢çš„æƒ…æ³ä¸‹ï¼Œè¡¨ç¤º é€™äº›æ‡‰ç”¨ç¨‹å¼çš„æ•´é«”æ¶æ§‹åªæœ‰ä¸€å€‹Activityä¾†è™•ç†å¤šå€‹ç•«é¢ã€‚</p><p><img src="https://i.imgur.com/NFKhBkA.png" alt="Imgur"></p><p><img src="https://i.imgur.com/3axAfm3.jpg" alt="Imgur"></p>        <h2 id="è§£æ±ºè¾¦æ³•"   >          <a href="#è§£æ±ºè¾¦æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#è§£æ±ºè¾¦æ³•" class="headerlink" title="è§£æ±ºè¾¦æ³•"></a>è§£æ±ºè¾¦æ³•</h2>              <h3 id="âŒ-1-å†å¯«ä¸€å€‹æ–°çš„Activityå°ˆé–€è™•ç†Picture-in-pictureç•«é¢"   >          <a href="#âŒ-1-å†å¯«ä¸€å€‹æ–°çš„Activityå°ˆé–€è™•ç†Picture-in-pictureç•«é¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#âŒ-1-å†å¯«ä¸€å€‹æ–°çš„Activityå°ˆé–€è™•ç†Picture-in-pictureç•«é¢" class="headerlink" title="âŒ 1. å†å¯«ä¸€å€‹æ–°çš„Activityå°ˆé–€è™•ç†Picture in pictureç•«é¢"></a>âŒ 1. å†å¯«ä¸€å€‹æ–°çš„Activityå°ˆé–€è™•ç†Picture in pictureç•«é¢</h3>      <p>è³‡æ–™å‚³éåˆ°æ–°çš„Activityå¾ŒæŠŠèˆŠplayerçµ¦ä»–Finishæ‰ï¼ˆæˆ–è—èµ·ä¾†ï¼‰ï¼Œç›´æ¥é€²å…¥å­æ¯ç•«é¢æ¨¡å¼ã€‚ä½†é‡è¤‡ä½œå½±ç‰‡loadingçš„å‹•ä½œï¼Œä¸”å°‡å­æ¯ç•«é¢é»é–‹ä¹‹å¾Œï¼Œé‚„è¦å†æŠŠåŸæœ¬åŒ…å«èŠå¤©å®¤ç­‰åŠŸèƒ½çš„Playerå‘¼å«æˆ–æ–°å¢å›ä¾†ã€‚</p>        <h3 id="âŒ-2-æ›´æ”¹æ¶æ§‹ï¼Œå°‡Playerå¾Activityè®Šæ›´ç‚ºFragmentï¼ŒåŒ…å«å…¶ä»–Activityå¦‚Searchã€Login"   >          <a href="#âŒ-2-æ›´æ”¹æ¶æ§‹ï¼Œå°‡Playerå¾Activityè®Šæ›´ç‚ºFragmentï¼ŒåŒ…å«å…¶ä»–Activityå¦‚Searchã€Login" class="heading-link"><i class="fas fa-link"></i></a><a href="#âŒ-2-æ›´æ”¹æ¶æ§‹ï¼Œå°‡Playerå¾Activityè®Šæ›´ç‚ºFragmentï¼ŒåŒ…å«å…¶ä»–Activityå¦‚Searchã€Login" class="headerlink" title="âŒ 2. æ›´æ”¹æ¶æ§‹ï¼Œå°‡Playerå¾Activityè®Šæ›´ç‚ºFragmentï¼ŒåŒ…å«å…¶ä»–Activityå¦‚Searchã€Login"></a>âŒ 2. æ›´æ”¹æ¶æ§‹ï¼Œå°‡Playerå¾Activityè®Šæ›´ç‚ºFragmentï¼ŒåŒ…å«å…¶ä»–Activityå¦‚Searchã€Login</h3>      <p>æ•ˆä»¿YouTubeæ¨¡å¼ï¼Œå°‡æ‰€æœ‰ç•«é¢å»ºç½®åœ¨ä¸€å€‹Activityçš„æ¶æ§‹ä¸Šï¼Œä½†è€ƒæ…®åˆ°è¦æ”¹çš„è©±éœ€è¦å‹•åˆ°ä¸€å †é é¢ï¼Œä¸”æœ‰è¨±å¤šåŠŸèƒ½æ˜¯ä»°ä»—èº«ç‚ºActivityè€ŒéFragmentçš„Playerï¼Œæ‰€ä»¥é²é²ä¸æ•¢å‹•å·¥ã€‚</p>        <h3 id="âŒ-3-åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡ä¸Šä¸€å€‹é é¢æŒ–å›ä¾†"   >          <a href="#âŒ-3-åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡ä¸Šä¸€å€‹é é¢æŒ–å›ä¾†" class="heading-link"><i class="fas fa-link"></i></a><a href="#âŒ-3-åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡ä¸Šä¸€å€‹é é¢æŒ–å›ä¾†" class="headerlink" title="âŒ 3. åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡ä¸Šä¸€å€‹é é¢æŒ–å›ä¾†"></a>âŒ 3. åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡ä¸Šä¸€å€‹é é¢æŒ–å›ä¾†</h3>      <p>å¦‚ï¼šå¾MainActivityä¾†å°±Intentå›å»ã€‚ä½†MainActivity/SearchActivity/CategoryActivityéƒ½è·ŸPlayeræœ‰ç›´æ¥é—œä¿‚ï¼Œéœ€è¦æ¯æ¬¡é€²ä¾†Playeræ™‚éƒ½å¸¶ä¸€å€‹å¯„ä»¶äººä½å€ï¼Œæ‰€ä»¥é€™å€‹æ–¹æ³•ä¹Ÿä¸å¥½ã€‚</p>        <h3 id="â­•ï¸-4-åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡Appæ•´ç–ŠæŠ±å›ä¾†"   >          <a href="#â­•ï¸-4-åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡Appæ•´ç–ŠæŠ±å›ä¾†" class="heading-link"><i class="fas fa-link"></i></a><a href="#â­•ï¸-4-åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡Appæ•´ç–ŠæŠ±å›ä¾†" class="headerlink" title="â­•ï¸ 4. åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡Appæ•´ç–ŠæŠ±å›ä¾†"></a>â­•ï¸ 4. åœ¨è¿”å›éµçš„functionä¸­ï¼Œå¼·åˆ¶å°‡Appæ•´ç–ŠæŠ±å›ä¾†</h3>      <p>é€™æ˜¯å¾Œä¾†åœ¨å¯«æ¨æ’­é€šçŸ¥é»æ“Šäº‹ä»¶çš„æ™‚å€™ï¼Œé™°éŒ¯é™½å·®æƒ³åˆ°å¯ä»¥åˆ©ç”¨åŒæ¨£çš„æ–¹æ³•ï¼Œåœ¨è¿”å›éµçš„functionä¸­ï¼Œç›´æ¥æŠŠApp callå›ä¾†ã€‚è€ŒAppæ•´ç–Šçš„æœ€ä¸Šé¢ï¼Œå°±æ˜¯ä¹‹å‰ä½¿ç”¨çš„æœ€å¾Œä¸€å€‹ç•«é¢ã€‚</p><p>åœ¨è§¸ç™¼äº‹ä»¶ä¹‹å¾Œå…ˆå•Ÿå‹•Appçš„ç¬¬ä¸€å€‹é é¢ï¼ˆLauncherActivityå•Ÿå‹•ç•«é¢ï¼‰ï¼Œé€™æ™‚Launcheræœƒå…ˆåˆ¤æ–·Launcheræœ¬äººæ˜¯ä¸æ˜¯æ•´å€‹Appå”¯ä¸€ä¸€å€‹Activityã€‚å¦‚æœæ˜¯çš„è©±ï¼Œå°±ç¹¼çºŒåšè©²åšçš„äº‹ï¼Œå¦‚ï¼šloadingã€get APIâ€¦ã€‚å¦‚æœä¸æ˜¯çš„è©±ï¼Œå°±æŠŠè‡ªå·±Finishæ‰ï¼ŒShowå‡ºå †ç–Šåœ¨Launcherä¸‹é¢çš„é‚£ä½åŒèƒã€‚</p><p><img src="https://i.imgur.com/QUOydKm.png" alt="å•Ÿå‹•æ¨¡å¼.png"></p>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-Picture-In-Picture-PIP-å­æ¯ç•«é¢"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-Picture-In-Picture-PIP-å­æ¯ç•«é¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-Picture-In-Picture-PIP-å­æ¯ç•«é¢" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ Picture In Picture PIP å­æ¯ç•«é¢"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>Picture In Picture</code> <code>PIP</code> <code>å­æ¯ç•«é¢</code></h6>      ]]></content>
      
      
      <categories>
          
          <category> æ‡‰ç”¨æŠ€è¡“, 123 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‡‰ç”¨æŠ€è¡“, Picture In Picture, PIP, å­æ¯ç•«é¢ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å ´æ™¯è½‰æ›å‹•ç•«SceneTransitionAnimation-åœ–å°åœ–</title>
      <link href="/tutu1023/2021/09/16/%E5%A0%B4%E6%99%AF%E8%BD%89%E6%8F%9B%E5%8B%95%E7%95%ABSceneTransitionAnimation-%E5%9C%96%E5%B0%8D%E5%9C%96/"/>
      <url>/tutu1023/2021/09/16/%E5%A0%B4%E6%99%AF%E8%BD%89%E6%8F%9B%E5%8B%95%E7%95%ABSceneTransitionAnimation-%E5%9C%96%E5%B0%8D%E5%9C%96/</url>
      
        <content type="html"><![CDATA[<p>  Createï¼š2021/08/30<br>  Updateï¼š2021/08/31<br>  Byï¼šAda<br>  Codeï¼šKotlin</p><p>åƒè€ƒä¾†æºï¼š<br><span class="exturl"><a class="exturl__link"   href="https://www.youtube.com/watch?v=DkSlk03-opA" >https://www.youtube.com/watch?v=DkSlk03-opA</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>é™„åŠ æ–¼startActivityçš„åœ–å°åœ–æ´»å‹•è½‰å ´å‹•ç•«ã€‚</p><iframe src="https://www.youtube.com/embed?video_id=DkSlk03-opA&eurl=http%3A%2F%2Fwww.youtube.com%2F" scrolling="no" frameborder="0" width="100%" height="430" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe><hr>        <h2 id="Theme-Topic-In-Style"   >          <a href="#Theme-Topic-In-Style" class="heading-link"><i class="fas fa-link"></i></a><a href="#Theme-Topic-In-Style" class="headerlink" title="Theme Topic In Style"></a>Theme Topic In Style</h2>      <p>åœ¨Activity 1 èˆ‡ Activity 2 æœƒç”¨åˆ°çš„themeä¸­åŠ å…¥<code>windowContentTransitions</code>ä¸¦è¨­ç½®ç‚ºtrueï¼Œä»¥é–‹å•Ÿçª—å£å…§å®¹è®Šæ›åŠŸèƒ½ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;style name=<span class="string">&quot;AppTheme&quot;</span> parent=<span class="string">&quot;Theme.MaterialComponents.DayNight.NoActionBar&quot;</span>&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;colorPrimary&quot;</span>&gt;<span class="meta">@color</span>/colorPrimary&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;colorPrimaryDark&quot;</span>&gt;<span class="meta">@color</span>/colorPrimaryDark&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;colorAccent&quot;</span>&gt;<span class="meta">@color</span>/colorAccent&lt;/item&gt;</span><br><span class="line">   </span><br><span class="line">    &lt;item name=<span class="string">&quot;android:windowContentTransitions&quot;</span>&gt;<span class="literal">true</span>&lt;/item&gt;  <span class="comment">//&lt;-----this</span></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h2 id="è¨­å®šåœ–ç‰‡å»¶å±•å€å¡Š"   >          <a href="#è¨­å®šåœ–ç‰‡å»¶å±•å€å¡Š" class="heading-link"><i class="fas fa-link"></i></a><a href="#è¨­å®šåœ–ç‰‡å»¶å±•å€å¡Š" class="headerlink" title="è¨­å®šåœ–ç‰‡å»¶å±•å€å¡Š"></a>è¨­å®šåœ–ç‰‡å»¶å±•å€å¡Š</h2>      <p>å°‡Activity 1è¦æ‹¿ä¾†è·³è½‰çš„åœ–ç‰‡xmlæª”åŠ ä¸Š<code>transitionName</code>ï¼ˆéš¨ä¾¿å–ï¼Œèˆ‡å¦ä¸€é‚Šå°çš„ä¸Šå°±å¥½ï¼‰ï¼Œè‹¥æ˜¯RecyclerViewå°±åŠ åœ¨itemçš„xmlæª”å…§ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;androidx.appcompat.widget.AppCompatImageView</span><br><span class="line">    android:id=<span class="string">&quot;@+id/imgThumbnail&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                  </span><br><span class="line">    android:transitionName=<span class="string">&quot;thumbnail_transition&quot;</span>   <span class="comment">//&lt;-----this</span></span><br><span class="line">/&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>å°‡Activity 2è¦éŠœæ¥çš„å€åŸŸä¹ŸåŠ ä¸Š<code>transitionName</code>ï¼ˆActivity 1å–ä»€éº¼é€™é‚Šå°±å–ä¸€æ¨£çš„ï¼‰</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;FrameLayout</span><br><span class="line">    android:id=<span class="string">&quot;@+id/playerLayout&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:orientation=<span class="string">&quot;horizontal&quot;</span></span><br><span class="line">    </span><br><span class="line">    android:transitionName=<span class="string">&quot;thumbnail_transition&quot;</span>&gt;    <span class="comment">//&lt;-----this</span></span><br><span class="line">    </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&lt;/FrameLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h2 id="é é¢è·³è½‰"   >          <a href="#é é¢è·³è½‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#é é¢è·³è½‰" class="headerlink" title="é é¢è·³è½‰"></a>é é¢è·³è½‰</h2>      <p>åœ¨Activity 1çš„startActivityä¸­çš„Bundleæ¬„ä½åŠ ä¸ŠActivityOptionsCompatçš„è¨­ç½®ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> view = fingViewById(R.id.thumbnail)</span><br><span class="line"></span><br><span class="line">...   <span class="comment">//set Intent()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> option = ActivityOptionsCompat.makeSceneTransitionAnimation(</span><br><span class="line">    <span class="keyword">this</span><span class="symbol">@Activity1</span>,</span><br><span class="line">    view,</span><br><span class="line">    ViewCompat.getTransitionName(view).toString()</span><br><span class="line">)</span><br><span class="line">startActivity(intent, option.toBundle())</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h2 id="å‹•ç•«é€Ÿåº¦è¨­å®š"   >          <a href="#å‹•ç•«é€Ÿåº¦è¨­å®š" class="heading-link"><i class="fas fa-link"></i></a><a href="#å‹•ç•«é€Ÿåº¦è¨­å®š" class="headerlink" title="å‹•ç•«é€Ÿåº¦è¨­å®š"></a>å‹•ç•«é€Ÿåº¦è¨­å®š</h2>      <p>åœ¨Activity 2è¨­å®šè©²é sharedElementEnterTransition/sharedElementExitTransitionçš„duration</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">window.sharedElementEnterTransition.duration = <span class="number">200</span></span><br><span class="line">window.sharedElementExitTransition.duration = <span class="number">200</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-View-è½‰å ´-StartIntent-åœ–å°åœ–"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-è½‰å ´-StartIntent-åœ–å°åœ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-è½‰å ´-StartIntent-åœ–å°åœ–" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ View è½‰å ´ StartIntent åœ–å°åœ–"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>View</code> <code>è½‰å ´</code> <code>StartIntent</code> <code>åœ–å°åœ–</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¨æ’­é€šçŸ¥FCM</title>
      <link href="/tutu1023/2021/09/16/%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5FCM/"/>
      <url>/tutu1023/2021/09/16/%E6%8E%A8%E6%92%AD%E9%80%9A%E7%9F%A5FCM/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2021/09/16<br>  Codeï¼šJavaã€Kotlin<br>  Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://fightwennote.blogspot.com/2019/03/android-firebase-fcm.html" >https://fightwennote.blogspot.com/2019/03/android-firebase-fcm.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://4.bp.blogspot.com/-RMUI_JC1kdQ/XIuWH7UC3uI/AAAAAAAABes/ZYKev-tQAJUC_9OQpRi05f6i1wWtedjHACLcBGAs/s640/19031502.jpg" alt="IMG_20191230_154939.jpg"></p><hr>        <h2 id="Firebaseè¨»å†ŠCloud-Message"   >          <a href="#Firebaseè¨»å†ŠCloud-Message" class="heading-link"><i class="fas fa-link"></i></a><a href="#Firebaseè¨»å†ŠCloud-Message" class="headerlink" title="Firebaseè¨»å†ŠCloud Message"></a>Firebaseè¨»å†ŠCloud Message</h2>      <p>åˆ°FireBaseé é¢ï¼Œé»é¸Cloud Messagingï¼Œä¸¦ä¾å¾ªæŒ‡ç¤ºå°‡FireBaseæ–°å¢åˆ°Appä¸­ã€‚</p><p><img src="https://i.imgur.com/yYgoWXl.png" alt="Imgur"></p><p>P.S. å°‹æ‰¾SHA-1æ†‘è­‰çš„æ–¹å¼ã€‚Andorid Studio å´é‚Šæœ‰ä¸€å€‹Gradleæ¬„ä½ï¼Œæ‰¾åˆ°Taskè³‡æ–™å¤¾ï¼Œæ‰¾åˆ° Tasks è³‡æ–™å¤¾ï¼Œandroid -&gt; signingReportï¼Œé»é–‹åŸ·è¡Œå°±å¯ä»¥åœ¨ä¸‹æ–¹Runæ‰¾åˆ°SHA1æ¬„ä½ã€‚</p><p>åƒè€ƒè³‡æ–™ï¼š<span class="exturl"><a class="exturl__link"   href="https://anson-site.blogspot.com/2018/02/sha1md5.html" >https://anson-site.blogspot.com/2018/02/sha1md5.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/66wpmjw.png" alt="Imgur"></p><hr>        <h2 id="Android-Studioæ¥æ‡‰"   >          <a href="#Android-Studioæ¥æ‡‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#Android-Studioæ¥æ‡‰" class="headerlink" title="Android Studioæ¥æ‡‰"></a>Android Studioæ¥æ‡‰</h2>      <p>åœ¨app/build.gradleçš„dependenciesåŠ å…¥ä¾è³´</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dependencies&#123;</span><br><span class="line">    implementation <span class="string">&#x27;com.google.firebase:firebase-messaging:20.1.0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>åœ¨build.gradleçš„dependenciesåŠ å…¥ä¾è³´</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dependencies&#123;</span><br><span class="line">    classpath <span class="string">&#x27;com.google.gms:google-services:4.3.3&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>æ–°å¢ä¸€å€‹ Class ç¹¼æ‰¿ FirebaseMessagingServiceï¼Œä¸¦ä¸” Override onMessageReceived è·Ÿ onNewTokenï¼Œä»¥åŠsendNotificationçš„Functionä¾†è™•ç†/é¡¯ç¤ºé€šçŸ¥ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirebaseService</span> <span class="keyword">extends</span> <span class="title">FirebaseMessagingService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageReceived</span><span class="params">(<span class="meta">@NotNull</span> RemoteMessage remoteMessage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onMessageReceived(remoteMessage);</span><br><span class="line">        <span class="keyword">if</span> (remoteMessage.getNotification() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Log.i(<span class="string">&quot;MyFirebaseService&quot;</span>,<span class="string">&quot;title &quot;</span>+remoteMessage.getNotification().getTitle());</span><br><span class="line">            Log.i(<span class="string">&quot;MyFirebaseService&quot;</span>,<span class="string">&quot;body &quot;</span>+remoteMessage.getNotification().getBody());</span><br><span class="line">            </span><br><span class="line">            sendNotification(remoteMessage.getNotification().getTitle(),</span><br><span class="line">                    remoteMessage.getNotification().getBody(),vid);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNewToken</span><span class="params">(<span class="meta">@NotNull</span> String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onNewToken(s);</span><br><span class="line">        Log.i(<span class="string">&quot;MyFirebaseService&quot;</span>,<span class="string">&quot;token &quot;</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendNotification</span><span class="params">(String messageTitle, String messageBody, <span class="keyword">int</span> vid)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, WelcomePage.class);</span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, intent,</span><br><span class="line">                PendingIntent.FLAG_ONE_SHOT);                                     <span class="comment">//è¨­å®šé»æ“Šé€šçŸ¥è¦è·³è½‰çš„è·¯å¾‘</span></span><br><span class="line"></span><br><span class="line">        String channelId = <span class="string">&quot;default_channel_id&quot;</span>;</span><br><span class="line">        Uri defaultSoundUri =RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);</span><br><span class="line">        NotificationCompat.Builder notificationBuilder = </span><br><span class="line">                <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>, channelId)                   </span><br><span class="line">                        .setContentTitle(messageTitle)                            <span class="comment">//æ¨™é¡Œ</span></span><br><span class="line">                        .setSmallIcon(R.drawable.ic_noti_58)                      <span class="comment">//icon</span></span><br><span class="line">                        .setColor(getResources().getColor(R.color.ThemeTiffany))  <span class="comment">//ä¸»é¡Œé¡è‰²</span></span><br><span class="line">                        .setContentText(messageBody)                              <span class="comment">//è¨Šæ¯å…§å®¹        </span></span><br><span class="line">                        .setAutoCancel(<span class="keyword">true</span>)                                      <span class="comment">//é»æ“Šå¾Œé€šçŸ¥è‡ªå‹•æ¶ˆå¤±</span></span><br><span class="line">                        .setPriority(NotificationCompat.PRIORITY_HIGH)            <span class="comment">//å„ªå…ˆç¨‹åº¦</span></span><br><span class="line">                        .setSound(defaultSoundUri)                                <span class="comment">//æç¤ºéŸ³</span></span><br><span class="line">                        .setContentIntent(pendingIntent);                         <span class="comment">//å¥—ç”¨è·¯å¾‘Intent</span></span><br><span class="line"></span><br><span class="line">        NotificationManager notificationManager =</span><br><span class="line">                (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Android Oreoå¾Œï¼Œè¦å®šéœ€è¦å‰µå»ºChannelæ‰èƒ½é¡¯ç¤ºé€šçŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">            NotificationChannel channel = <span class="keyword">new</span> NotificationChannel(channelId,</span><br><span class="line">                    <span class="string">&quot;default_channel_name&quot;</span>,</span><br><span class="line">                    NotificationManager.IMPORTANCE_HIGH);</span><br><span class="line">            channel.setLockscreenVisibility(Notification.VISIBILITY_PUBLIC);</span><br><span class="line">            <span class="keyword">assert</span> notificationManager != <span class="keyword">null</span>;</span><br><span class="line">            notificationManager.createNotificationChannel(channel);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> notificationManager != <span class="keyword">null</span>;</span><br><span class="line">        notificationManager.notify(<span class="number">0</span>, notificationBuilder.build()); <span class="comment">//ä¸Ÿå‡ºé€šçŸ¥</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>åœ¨ AndroidMenifest.xml çš„ application æ¨™ç±¤è£¡è²æ˜MyFirebaseService ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;service android:name=<span class="string">&quot;com.example.fcmdemoapp.MyFirebaseService&quot;</span>&gt;</span><br><span class="line">        &lt;intent-filter&gt;</span><br><span class="line">            &lt;action android:name=<span class="string">&quot;com.google.firebase.MESSAGING_EVENT&quot;</span> /&gt;</span><br><span class="line">        &lt;/intent-filter&gt;</span><br><span class="line">    &lt;/service&gt;</span><br><span class="line">&lt;/application&gt; </span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ç”±æ–¼åœ¨ç™¼é€æ­£å¼æ¨æ’­ä¹‹å‰è¦å…ˆåœ¨æ‰‹é‚Šçš„æ‰‹æ©Ÿè¨­å‚™ä¸Šä½œå¾®èª¿ä»¥åŠæ¸¬è©¦çš„å‹•ä½œï¼Œæ‰€ä»¥æˆ‘å€‘éœ€è¦åœ¨ç¨‹å¼ç¢¼ä¸­åŠ å…¥FirebaseInstanceId.getInstance().instanceIdæ–¹æ³•ä¾†æ‹¿å–æ‰‹æ©Ÿè¨­å‚™çš„token</p><p>tokené€šå¸¸æ–¼appç¬¬ä¸€æ¬¡å®‰è£æ™‚æœƒç”¢ç”Ÿä¸€çµ„æ–°çš„ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FirebaseInstanceId.getInstance().instanceId</span><br><span class="line">    .addOnCompleteListener &#123;</span><br><span class="line">        <span class="keyword">if</span> (!it.isSuccessful) &#123;</span><br><span class="line">            <span class="keyword">return</span><span class="meta">@addOnCompleteListener</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( it.result == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span><span class="meta">@addOnCompleteListener</span></span><br><span class="line">            <span class="comment">// Get new Instance ID token</span></span><br><span class="line">            val token = it.result!!.token</span><br><span class="line">            <span class="comment">// Log and toast</span></span><br><span class="line">            Log.i(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;token $token&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p><img src="https://4.bp.blogspot.com/-8HQuORNy-uQ/XI3h6ix4yHI/AAAAAAAABh0/dtizfbVjBS4J187MYgEK_yypM6xwmrLngCLcBGAs/s640/19031703.jpg" alt="Imgur"></p><p>æ‹¿åˆ°tokenå¾Œå°±å¯ä»¥åˆ°Firebaseçš„Cloud Messagingå‚³é€æ¸¬è©¦è¨Šæ¯å›‰ï¼<br>è¼¸å…¥å®Œè¨Šæ¯æ¨™é¡Œä»¥åŠå…§æ–‡å¾Œï¼Œå°±å¯ä»¥é»æ“Šæ—é‚Šçš„ã€Œå‚³é€æ¸¬è©¦è¨Šæ¯ã€ï¼Œè²¼ä¸Šä¸¦åŠ å…¥tokenï¼Œå°±å¯ä»¥å‚³é€å›‰ã€‚</p><p><img src="https://3.bp.blogspot.com/-iWLu6ng2hMI/XI3jNE8xFnI/AAAAAAAABiA/zDOOuUQ0oEwMqFWy602jVHlwDvPgNZ9xwCLcBGAs/s640/19031704.jpg" alt="Imgur"></p><p>é€™æ¨£å°±èƒ½æ”¶åˆ°è¨Šæ¯å›‰ï¼</p><hr>        <h2 id="éœ€æ³¨æ„çš„åœ°æ–¹"   >          <a href="#éœ€æ³¨æ„çš„åœ°æ–¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#éœ€æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="éœ€æ³¨æ„çš„åœ°æ–¹"></a>éœ€æ³¨æ„çš„åœ°æ–¹</h2>      <p>å› ç‚ºå‰è¿°onMessageRecieveåªæœ‰appåœ¨å‰å°çš„æ™‚å€™æœƒåŸ·è¡Œï¼Œå¦‚æœæˆ‘å€‘çš„ App æ”¾åˆ°èƒŒæ™¯ï¼Œç”šè‡³æ˜¯é—œé–‰ï¼Œæ¨æ’­çš„Notificationæœƒè®Šæˆç³»çµ±é è¨­æ¨£å¼ï¼Œ<br>ç„¶è€Œé è¨­ç³»çµ±æ¨£å¼èƒ½å¤ è®ŠåŒ–çš„åªæœ‰ small icon è·Ÿ æ–‡å­—é¡è‰²ã€‚</p><p>åœ¨ AndroidMenifest.xml çš„ application æ¨™ç±¤è£¡è²æ˜MetaDataï¼Œå°±å¯ä»¥åœ¨é è¨­æƒ…æ³ä¸‹æ”¹è®Šiconä»¥åŠé¡è‰²ã€‚</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;meta-data</span><br><span class="line">        android:name=<span class="string">&quot;com.google.firebase.messaging.default_notification_icon&quot;</span></span><br><span class="line">        android:resource=<span class="string">&quot;@drawable/ic_noti_58&quot;</span> /&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;meta-data</span><br><span class="line">        android:name=<span class="string">&quot;com.google.firebase.messaging.default_notification_color&quot;</span></span><br><span class="line">        android:resource=<span class="string">&quot;@color/ThemeTiffany&quot;</span> /&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/application&gt; </span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="2021-08-17è£œå……âŒ"   >          <a href="#2021-08-17è£œå……âŒ" class="heading-link"><i class="fas fa-link"></i></a><a href="#2021-08-17è£œå……âŒ" class="headerlink" title="2021/08/17è£œå……âŒ"></a>2021/08/17è£œå……âŒ</h3>      <p><code>default_notification_icon</code>è‹¥æ˜¯æ”¾åœ¨drawableæ™‚æ˜¯ç„¡æ³•è¢«<code>defalut_notification_color</code>æ”¹è®Šé¡è‰²çš„ï¼Œéœ€ä»¥mipmapæ–¹å¼ä¸”iconé¡è‰²ç‚ºç™½è‰²ï¼Œæ‰èƒ½åœ¨é€šçŸ¥æ¬„æ‹‰é–‹æ™‚é¡¯ç¤ºä¸»é¡Œè‰²æ¨™é¡Œï¼Œä¸”é€šçŸ¥æ¬„æœ€å°åŒ–æ™‚ä»æ˜¯ã€Œæ·ºè‰²åº•ç°iconã€/ã€Œæ·±è‰²åº•ç™½iconã€</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;meta-data</span><br><span class="line">        android:name=<span class="string">&quot;com.google.firebase.messaging.default_notification_icon&quot;</span></span><br><span class="line">        android:resource=<span class="string">&quot;@â­•ï¸mipmapâ­•ï¸/ic_noti_58&quot;</span> /&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;meta-data</span><br><span class="line">        android:name=<span class="string">&quot;com.google.firebase.messaging.default_notification_color&quot;</span></span><br><span class="line">        android:resource=<span class="string">&quot;@color/ThemeTiffany&quot;</span> /&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/application&gt; </span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p><img src="https://i.imgur.com/itK8sBX.png" alt="Imgur"></p><p>é€™æ¨£å®Œç¾ç¬¦åˆAndroidç³»çµ±ç”Ÿæ…‹äº†â¤ï¸</p><hr>        <h2 id="å‚³å€¼"   >          <a href="#å‚³å€¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#å‚³å€¼" class="headerlink" title="å‚³å€¼"></a>å‚³å€¼</h2>      <p>å¦‚æœéœ€è¦å‚³å€¼ä¸¦è™•ç†çš„è©±ï¼Œå¯ä»¥åœ¨å…¶ä»–é¸é …åŠ å…¥è‡ªè¨‚è³‡æ–™</p><p><img src="https://i.imgur.com/wlivxM1.png" alt="Imgur"></p><p>ç”±æ–¼appå‰å°çš„é€šçŸ¥è™•ç†ä»¥åŠå¾Œå°çš„é€šçŸ¥è™•ç†ä¸ä¸€æ¨£ï¼Œå…ˆä¾†èªªèªªè©²å¦‚ä½•è™•ç†å‰å°ï½</p>        <h3 id="å‰å°onMessageReceive"   >          <a href="#å‰å°onMessageReceive" class="heading-link"><i class="fas fa-link"></i></a><a href="#å‰å°onMessageReceive" class="headerlink" title="å‰å°onMessageReceive"></a>å‰å°onMessageReceive</h3>      <p>åˆ©ç”¨remoteMessage.getData().entrySet()</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry: remoteMessage.getData().entrySet()) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(entry.getKey().equals(<span class="string">&quot;key&quot;</span>))&#123;</span><br><span class="line">        key= Integer.parseInt(entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="é è¨­ç³»çµ±æ¨£å¼"   >          <a href="#é è¨­ç³»çµ±æ¨£å¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#é è¨­ç³»çµ±æ¨£å¼" class="headerlink" title="é è¨­ç³»çµ±æ¨£å¼"></a>é è¨­ç³»çµ±æ¨£å¼</h3>      <p>åœ¨é»é–‹é€šçŸ¥ç¬¬ä¸€å€‹å•Ÿå‹•çš„Activityä¸­ï¼Œæ¥å–è©²Activityçš„Intentã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">this</span>.intent.hasExtra(<span class="string">&quot;key&quot;</span>))&#123;    <span class="comment">//é–‹å•Ÿappæ™‚</span></span><br><span class="line">    <span class="keyword">val</span> fbVid = <span class="keyword">this</span>.intent.getStringExtra(<span class="string">&quot;key&quot;</span>).toInt()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><hr>        <h2 id="ç§»é™¤æ¨æ’­é€šçŸ¥"   >          <a href="#ç§»é™¤æ¨æ’­é€šçŸ¥" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç§»é™¤æ¨æ’­é€šçŸ¥" class="headerlink" title="ç§»é™¤æ¨æ’­é€šçŸ¥"></a>ç§»é™¤æ¨æ’­é€šçŸ¥</h2>              <h3 id="ç§»é™¤æ‰€æœ‰æ¨æ’­"   >          <a href="#ç§»é™¤æ‰€æœ‰æ¨æ’­" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç§»é™¤æ‰€æœ‰æ¨æ’­" class="headerlink" title="ç§»é™¤æ‰€æœ‰æ¨æ’­"></a>ç§»é™¤æ‰€æœ‰æ¨æ’­</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> notificationManager = context!!.getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">notificationManager.cancelAll()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="ç§»é™¤ç‰¹å®šæ¨æ’­"   >          <a href="#ç§»é™¤ç‰¹å®šæ¨æ’­" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç§»é™¤ç‰¹å®šæ¨æ’­" class="headerlink" title="ç§»é™¤ç‰¹å®šæ¨æ’­"></a>ç§»é™¤ç‰¹å®šæ¨æ’­</h3>      <p>è‹¥æƒ³è¦ç§»é™¤åŒé¡å‹æ¨æ’­é€šçŸ¥(å¦‚æŸç‰¹å®šå°è±¡å‚³ä¾†çš„å¤šå‰‡è¨Šæ¯)ï¼Œå‰‡å¯ä»¥ä½¿ç”¨notificationManager.cancel(id)ä¾†é€²è¡Œç§»é™¤ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> notificationManager = context!!.getSystemService(Context.NOTIFICATION_SERVICE) <span class="keyword">as</span> NotificationManager</span><br><span class="line">notificationManager.cancel(id)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>å‰ææ˜¯åœ¨ç™¼å‡ºæ¨æ’­è¨Šæ¯æ™‚çš„notificationManager.notify(id, notificationBuilder.build())ï¼Œidæ¬„ä½é ˆè¨­å®šå€¼ã€‚ä½†åœ¨ç³»çµ±é€šçŸ¥é è¨­çš„æƒ…æ³ä¸‹é‚„ä¸çŸ¥é“å¦‚ä½•æ”¹è®ŠNotification IDçš„å€¼ã€‚</p><p>Firebaseå¼„äº†ä¸€å€‹é€™éº¼é‡è¦çš„FCMåŠŸèƒ½ï¼Œå±…ç„¶ä¸èƒ½ç›´æ¥æ”¯æ´æ”¹è®Šç³»çµ±çš„é è¨­é€šçŸ¥ï¼Œå‚»çœ¼è²“å’ªã€‚</p><hr>        <h2 id="é‡åˆ°å•é¡Œ"   >          <a href="#é‡åˆ°å•é¡Œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#é‡åˆ°å•é¡Œ" class="headerlink" title="é‡åˆ°å•é¡Œ"></a>é‡åˆ°å•é¡Œ</h2>              <h4 id="é è¨­æƒ…æ³ä¸‹å¦‚ä½•æŒ‡å®šè·³è½‰é é¢"   >          <a href="#é è¨­æƒ…æ³ä¸‹å¦‚ä½•æŒ‡å®šè·³è½‰é é¢" class="heading-link"><i class="fas fa-link"></i></a><a href="#é è¨­æƒ…æ³ä¸‹å¦‚ä½•æŒ‡å®šè·³è½‰é é¢" class="headerlink" title="é è¨­æƒ…æ³ä¸‹å¦‚ä½•æŒ‡å®šè·³è½‰é é¢"></a>é è¨­æƒ…æ³ä¸‹å¦‚ä½•æŒ‡å®šè·³è½‰é é¢</h4>      <p>notificationMessage å¯å‚³å€¼ click_action ï¼Œç”¨æ–¼é»æ“Šé è¨­æ¨æ’­é€šçŸ¥æ™‚è¦è·³å¾€çš„é é¢ã€‚</p><figure class="highlight plain"><figcaption><span>".Main.WelcomePage" ```  åå­—å¯ä»¥è‡ªå·±å–ï¼Œåªè¦èˆ‡intent-filterå‘½åä¸€è‡´å°±è¡Œ</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;java</span><br><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;activity android:name&#x3D;&quot;your activity&quot;&gt;</span><br><span class="line">        ...</span><br><span class="line">        &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name&#x3D;&quot;.Main.WelcomePage&quot; &#x2F;&gt;   &#x2F;&#x2F;èˆ‡click_actionå‘½åä¸€è‡´</span><br><span class="line">                &lt;category android:name&#x3D;&quot;android.intent.category.DEFAULT&quot; &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;intent-filter&gt;</span><br><span class="line">    &lt;&#x2F;activity&gt;</span><br><span class="line">&lt;&#x2F;application</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-å·¥å…·æ•™å­¸-Firebase-æ¨æ’­é€šçŸ¥-Notification"   >          <a href="#tags-å·¥å…·æ•™å­¸-Firebase-æ¨æ’­é€šçŸ¥-Notification" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-å·¥å…·æ•™å­¸-Firebase-æ¨æ’­é€šçŸ¥-Notification" class="headerlink" title="tags: å·¥å…·æ•™å­¸ Firebase æ¨æ’­é€šçŸ¥ Notification"></a>tags: <code>å·¥å…·æ•™å­¸</code> <code>Firebase</code> <code>æ¨æ’­é€šçŸ¥</code> <code>Notification</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Detected problems with API compatibility</title>
      <link href="/tutu1023/2021/04/29/Detected%20problems%20with%20API%20compatibility/"/>
      <url>/tutu1023/2021/04/29/Detected%20problems%20with%20API%20compatibility/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2020/01/07<br>  Byï¼šAda</p><p>  <img src="https://i.imgur.com/K6V2qMA.png" alt="Imgur"></p><hr>        <h3 id="å¯èƒ½åŸå› "   >          <a href="#å¯èƒ½åŸå› " class="heading-link"><i class="fas fa-link"></i></a><a href="#å¯èƒ½åŸå› " class="headerlink" title="å¯èƒ½åŸå› "></a>å¯èƒ½åŸå› </h3>              <h5 id="åªåœ¨Andorid-9ã€10ä¸Šå‡ºç¾"   >          <a href="#åªåœ¨Andorid-9ã€10ä¸Šå‡ºç¾" class="heading-link"><i class="fas fa-link"></i></a><a href="#åªåœ¨Andorid-9ã€10ä¸Šå‡ºç¾" class="headerlink" title="åªåœ¨Andorid 9ã€10ä¸Šå‡ºç¾"></a>åªåœ¨Andorid 9ã€10ä¸Šå‡ºç¾</h5>      <ul><li>  ç•¶å‰ä¸€é æœ‰Dialogæœªé—œé–‰è€Œé€ æˆå…§å­˜å¤–æ´©æ™‚æœƒé¡¯ç¤º(11æœˆå‰)</li><li>  app/build.gradleçš„targetSDK &lt; 28 æ¯æ¬¡é–‹å•Ÿéƒ½æœƒé¡¯ç¤º(12æœˆé–‹å§‹)</li><li>  ä½¿ç”¨åˆ°éš±è—Apiä¹Ÿæœƒé¡¯ç¤º(Andorid 9 å¾Œé–‹å§‹æƒ³è¦è£œæ•‘é–‹æºçš„å®‰å“ç³»çµ±)</li></ul>        <h4 id="æš«æ™‚çš„è§£æ±ºæ–¹æ³•"   >          <a href="#æš«æ™‚çš„è§£æ±ºæ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#æš«æ™‚çš„è§£æ±ºæ–¹æ³•" class="headerlink" title="æš«æ™‚çš„è§£æ±ºæ–¹æ³•"></a>æš«æ™‚çš„è§£æ±ºæ–¹æ³•</h4>      <p>åœ¨æœ€ä¸€é–‹å§‹Activityçš„onCreateå‘¼å«è‡ªå®šç¾©disableAPIDialogæ–¹æ³•ï¼Œå¯å°‡è©²è¦–çª—éš±è—èµ·ä¾†ï¼ŒåŒæ™‚åˆèƒ½ä¿ç•™appå…§å»ºçš„dialogã€‚</p><p>åƒè€ƒæ–¹æ³•ï¼š<span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/zpjsmalltime/article/details/86577058" >https://blog.csdn.net/zpjsmalltime/article/details/86577058</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">        disableAPIDialog()</span><br><span class="line">    &#125; </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      * åå°„ ç¦æ­¢å¼¹çª—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">disableAPIDialog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; <span class="number">28</span>)<span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">val</span> clazz = Class.forName(<span class="string">&quot;android.app.ActivityThread&quot;</span>)</span><br><span class="line">            <span class="keyword">val</span> currentActivityThread = clazz.getDeclaredMethod(<span class="string">&quot;currentActivityThread&quot;</span>)</span><br><span class="line">            currentActivityThread.isAccessible = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">val</span> activityThread = currentActivityThread.invoke(<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">val</span> mHiddenApiWarningShown = clazz.getDeclaredField(<span class="string">&quot;mHiddenApiWarningShown&quot;</span>)</span><br><span class="line">            mHiddenApiWarningShown.isAccessible = <span class="literal">true</span></span><br><span class="line">            mHiddenApiWarningShown.setBoolean(activityThread, <span class="literal">true</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e:Exception ) &#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><hr>        <h3 id="ç›¸é—œè³‡æ–™"   >          <a href="#ç›¸é—œè³‡æ–™" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç›¸é—œè³‡æ–™" class="headerlink" title="ç›¸é—œè³‡æ–™"></a>ç›¸é—œè³‡æ–™</h3>      <p>  <span class="exturl"><a class="exturl__link"   href="https://www.520mwx.com/view/21227" >ç”±â€Detected problems with API compatibilityâ€å¼•å‘çš„ä¸€ç³»åˆ—é—®é¢˜</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>  <span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/u013718730/article/details/89316482" >ã€Androidã€‘ã€è®¾å¤‡é€‚é…ã€‘android9.0å»é™¤Detected problems with API compatibilityå¼¹çª—</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>  <span class="exturl"><a class="exturl__link"   href="https://juejin.im/post/5d406ea0f265da03aa25493d" >é€‚é…Android Pä¹‹éSDKæ¥å£é™åˆ¶çš„æ’æŸ¥æ–¹æ³•</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p> <span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/zpjsmalltime/article/details/86577058" >Detected problems with API å¼¹çª— å±è”½è§£å†³æ–¹æ¡ˆ android</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> (è§£æ±ºæ–¹æ³•)</p>        <h6 id="tags-å•é¡Œèªªæ˜-Android-9-Detected-è­¦å‘Šè¦–çª—"   >          <a href="#tags-å•é¡Œèªªæ˜-Android-9-Detected-è­¦å‘Šè¦–çª—" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-å•é¡Œèªªæ˜-Android-9-Detected-è­¦å‘Šè¦–çª—" class="headerlink" title="tags: å•é¡Œèªªæ˜ Android 9 Detected è­¦å‘Šè¦–çª—"></a>tags: <code>å•é¡Œèªªæ˜</code> <code>Android 9</code> <code>Detected</code> <code>è­¦å‘Šè¦–çª—</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é é¢åˆ·æ–°HeadView</title>
      <link href="/tutu1023/2021/04/29/%E9%A0%81%E9%9D%A2%E5%88%B7%E6%96%B0HeadView/"/>
      <url>/tutu1023/2021/04/29/%E9%A0%81%E9%9D%A2%E5%88%B7%E6%96%B0HeadView/</url>
      
        <content type="html"><![CDATA[<p>Updateï¼š2019/12/06  Codeï¼šKotlin<br>Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/xyxyLiu/SwipeRefreshLayout" >https://github.com/xyxyLiu/SwipeRefreshLayout</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/UZqmi6f.png" alt="Imgur"></p><p><img src="https://i.imgur.com/znkFoIS.gif" alt="Img!"></p><p>æ‹–æ›³æ™‚é¢¨æ‰‡æ‰‡è‘‰æœƒéš¨è‘—æ‹–æ›³å¹…åº¦è€Œå¢åŠ æ—‹è½‰è§’åº¦ï¼Œå› æ­¤é ˆå°‡ç¾å·¥åœ–åˆ†ç‚ºå…©å€‹éƒ¨åˆ†ã€‚   </p><ul><li>  é›»æ‰‡æ—‹è½‰åˆ‡å‰²åœ–(png*8)</li><li>  å³é‚Šå–®ç´”å‹•ç•«(gif*1)</li></ul><hr><p>1.å°å…¥ä¾è³´</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;com.reginald.swiperefresh:library:1.1.2&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>2.å°‡CustomSwipeRefreshLayoutåŒ…è£¹åœ¨æ¬²æ›´æ–°çš„RecyclerViewå¤–ï¼Œä¸¦è¨­å®šç›¸é—œswiperefreshæ™‚é–“(æ¯«ç§’)</p><figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;com.reginald.swiperefresh.CustomSwipeRefreshLayout</span><br><span class="line">    android:id=&quot;@+id/mSwipeRefresh&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    swiperefresh:refresh_mode=&quot;pull_mode&quot;</span><br><span class="line">    swiperefresh:time_out_refresh_complete=&quot;500&quot;</span><br><span class="line">    swiperefresh:time_out_return_to_top=&quot;500&quot;</span><br><span class="line">    swiperefresh:return_to_top_duration=&quot;500&quot;</span><br><span class="line">    swiperefresh:return_to_header_duration=&quot;500&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;androidx.recyclerview.widget.RecyclerView</span><br><span class="line">            ...</span><br><span class="line">            android:id=&quot;@+id/recyclerView&quot;&gt;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">androidx.recyclerview.widget.RecyclerView</span>&gt;</span>                </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">com.reginald.swiperefresh.CustomSwipeRefreshLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>3.åœ¨RecyclerViewæ‰€åœ¨çš„Activity/Fragmentä¸­ï¼Œå¼•ç”¨CustomSwipeRefreshLayout.OnRefreshListener</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FragmentTemplete</span>: <span class="type">Fragment</span></span>(),  BaseQuickAdapter.RequestLoadMoreListener, </span><br><span class="line">    CustomSwipeRefreshLayout.OnRefreshListener&#123;</span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></div></figure><p>4.ç³»çµ±æœƒè¦æ±‚ä¸€å€‹onRefreshä¾†åŸ·è¡Œæ›´æ–°æ™‚è¦åšçš„äº‹æƒ…</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onRefresh</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">data</span>.clear()</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></div></figure><p>5.éœ€è¦å…ˆç‚º2.æ”¾ç½®çš„CustomSwipeRefreshLayoutå®£å‘Šä¸€å€‹è®Šæ•¸(è¨˜å¾—æ˜¯ä¸èƒ½ç›´æ¥æ‹¿ä¾†ä½¿ç”¨)</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> mSwip: CustomSwipeRefreshLayout? =<span class="literal">null</span></span><br><span class="line"></span><br><span class="line">mSwip = findViewById(R.id.mSwipeRefresh)</span><br><span class="line">mSwip!!.setOnRefreshListener(<span class="keyword">this</span>)</span><br><span class="line">mSwip!!.setCustomHeadview(MyCustomHeadView(context) <span class="keyword">as</span> View)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>è¨˜å¾—è¦åœ¨æ›´æ–°å®Œå¾Œå‘¼å«ä¸€å€‹mSwip!!.refreshComplete()</p><p>6.åœ¨å‰µé€ MyCustomHeadViewå‰ï¼Œå…ˆç‚ºMyCustomHeadViewå¼„ä¸€å€‹layout<br>ç”±æ–¼å‹•åœ–å¸Œæœ›æ˜¯å›ºå®šåœ¨RecyclerViewåº•ä¸‹ï¼Œåœ¨æ‹‰çš„æ™‚å€™èƒ½å¤ å…ˆçœ‹è¦‹å‹•åœ–é ‚éƒ¨ï¼Œå› æ­¤å°‡å‹•åœ–è—æ–¼MainActivityã€‚</p><p><img src="https://i.imgur.com/UrULXMY.png" alt="Imgur"></p><p>è‹¥æ˜¯å¸Œæœ›å‹•åœ–ç”±RecyclerViewä¸Šæ–¹è·Ÿè‘—æ‹–æ›³ä¸€èµ·æ‹‰ä¸‹ä¾†çš„è©±ï¼Œå°±å¯ä»¥æŠŠå‹•åœ–è—åœ¨MyCustomHeadViewçš„Layoutä¸­</p><p>â†“åŸå§‹MyCustomHeadViewçš„ä½ç½®<br><img src="https://i.imgur.com/dlrIcwg.png" alt="Imgur"></p><p>7.å‰µå»ºä¸€å€‹MyCustomHeadViewä¸¦å¼•ç”¨CustomSwipeRefreshLayout.CustomSwipeRefreshHeadLayout</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCustomHeadView</span> <span class="title">extends</span> <span class="title">LinearLayout</span> </span></span><br><span class="line">        implements CustomSwipeRefreshLayout.CustomSwipeRefreshHeadLayout &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> SparseArray&lt;String&gt; STATE_MAP = new SparseArray&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> ViewGroup mContainer;</span><br><span class="line">    <span class="keyword">private</span> pl.droidsonroids.gif.GifImageView anim;</span><br><span class="line">    <span class="keyword">private</span> ConstraintLayout mConstrainLayout;</span><br><span class="line">    <span class="keyword">private</span> int mState = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        STATE_MAP.put(<span class="number">0</span>, <span class="string">&quot;STATE_NORMAL&quot;</span>);</span><br><span class="line">        STATE_MAP.put(<span class="number">1</span>, <span class="string">&quot;STATE_READY&quot;</span>);</span><br><span class="line">        STATE_MAP.put(<span class="number">2</span>, <span class="string">&quot;STATE_REFRESHING&quot;</span>);</span><br><span class="line">        STATE_MAP.put(<span class="number">3</span>, <span class="string">&quot;STATE_COMPLETE&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></div></figure><p>è¨­å®šå»ºæ§‹å­ä»¥åŠå»ºæ§‹æ™‚è¦åšçš„äº‹æƒ…</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> MyCustomHeadView(Context context) &#123;</span><br><span class="line">    <span class="keyword">super</span>(context);</span><br><span class="line">    setupLayout();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressLint(<span class="meta-string">&quot;InflateParams&quot;</span>)</span></span><br><span class="line"><span class="keyword">private</span> void setupLayout() &#123;</span><br><span class="line">    ViewGroup.LayoutParams lp = new LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);</span><br><span class="line">    mContainer = (ConstraintLayout) LayoutInflater.from(getContext()).inflate(R.layout.my_swiperefresh_head_layout, <span class="literal">null</span>);</span><br><span class="line">    addView(mContainer, lp);</span><br><span class="line">    setGravity(Gravity.BOTTOM);</span><br><span class="line">    setBackgroundColor(Color.TRANSPARENT);</span><br><span class="line">    mConstrainLayout = findViewById(com.reginald.swiperefresh.R.id.default_header_content);</span><br><span class="line">    anim = findViewById(R.id.headAnim);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>onStateChangeæ±ºå®šæ¯å€‹éšæ®µè¦åšçš„äº‹æƒ…</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@SuppressLint(<span class="meta-string">&quot;SetTextI18n&quot;</span>)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> void onStateChange(CustomSwipeRefreshLayout.State state, CustomSwipeRefreshLayout.State lastState) &#123;</span><br><span class="line">    <span class="keyword">if</span> (DEBUG)</span><br><span class="line">        Log.d(<span class="string">&quot;csrh&quot;</span>, <span class="string">&quot;onStateChange state = &quot;</span> + state + <span class="string">&quot;, lastState = &quot;</span> + lastState);</span><br><span class="line">    int stateCode = state.getRefreshState();</span><br><span class="line">    int lastStateCode = lastState.getRefreshState();</span><br><span class="line">    float percent = state.getPercent();</span><br><span class="line">    AnimationDrawable animationDrawable;    <span class="comment">//When Ready, è¦è®“é¢¨æ‰‡ä¸€ç›´è½‰åœˆçš„å‹•ç•«è¨­å®š</span></span><br><span class="line">    switch (stateCode) &#123;</span><br><span class="line">        case CustomSwipeRefreshLayout.State.STATE_NORMAL:</span><br><span class="line">            ConstraintLayout.LayoutParams layoutParams </span><br><span class="line">                = (ConstraintLayout.LayoutParams) mConstrainLayout.getLayoutParams();</span><br><span class="line">            layoutParams.topMargin = getTop() - (int)percent*<span class="number">100</span>;</span><br><span class="line">            mConstrainLayout.setLayoutParams(layoutParams);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (percent &gt; <span class="number">0.3f</span>) &#123;    <span class="comment">//percent&gt;0.3fæ™‚é–‹å§‹æ—‹è½‰</span></span><br><span class="line">                int current = (int) ((percent*<span class="number">100</span>-<span class="number">50</span>)/<span class="number">3</span>);</span><br><span class="line">                switch (current)&#123;</span><br><span class="line">                    case <span class="number">1</span> :</span><br><span class="line">                        MainActivity.fanImageView.setImageDrawable(fan2);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        ...</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br></pre></td></tr></table></div></figure><p>åœ–ç‰‡æ›¿æ›çš„æ–¹æ³•ï¼Œæ˜¯å…ˆå°‡åœ–ç‰‡è³‡æºloadåˆ°è®Šæ•¸ä¸­ï¼Œåœ¨å› æ‡‰æ™‚æ©Ÿæ›¿æ›è®Šæ•¸ä¸Šå»ï¼Œå¦å‰‡å‹•ç•«ç›´æ¥æ’ˆè³‡æºè€—æ•ˆèƒ½ï¼Œæ‰‹æ©Ÿæœƒå¡å¡çš„ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Drawable fan1= getResources().getDrawable(R.drawable.fan1);  <span class="comment">//é †æš¢</span></span><br><span class="line">    fanImageView.setImageDrawable(fan1)</span><br><span class="line">    </span><br><span class="line">```    </span><br><span class="line">    v.s.</span><br><span class="line"></span><br><span class="line">```kotlin</span><br><span class="line"></span><br><span class="line">    fanImageView.setImageDrawable(getResources().getDrawable(R.drawable.fan1))   <span class="comment">//å¡é “</span></span><br><span class="line">    </span><br></pre></td></tr></table></div></figure><p>Readyä¸”æ‰‹æŒ‡é‚„æ²’æ”¾é–‹çš„æ™‚å€™ï¼Œè¦è®“é¢¨æ‰‡ä¸æ–·è½‰å‹•ï¼Œæé†’ä½¿ç”¨è€…å·²ç¶“å¯ä»¥æ”¾é–‹æ›´æ–°äº†ã€‚æ‰€ä»¥ç”¨å¯«å¥½çš„Drawableä»£å…¥AnamationDrawableã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">            case CustomSwipeRefreshLayout.State.STATE_READY:</span><br><span class="line">                <span class="keyword">if</span> (stateCode != lastStateCode) &#123;</span><br><span class="line">                    fanImageView.setImageResource(R.drawable.rotate_fan);</span><br><span class="line">                    animationDrawable = (AnimationDrawable) MainActivity.fanImageView.getDrawable();</span><br><span class="line">                    animationDrawable.setOneShot(<span class="literal">false</span>);</span><br><span class="line">                    animationDrawable.start();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            case CustomSwipeRefreshLayout.State.STATE_REFRESHING:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            case CustomSwipeRefreshLayout.State.STATE_COMPLETE:</span><br><span class="line">                <span class="keyword">if</span> (stateCode != lastStateCode) &#123;</span><br><span class="line">                    Handler handler = new Handler();</span><br><span class="line">                    handler.postDelayed(() -&gt; fanImageView.setImageDrawable(fan1), <span class="number">1000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            default:</span><br><span class="line">        &#125;</span><br><span class="line">        mState = stateCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rotate_fan.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;animation-list xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">                android:oneshot=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan1&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan2&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan3&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan4&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan5&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan6&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan7&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">    &lt;item android:drawable=<span class="string">&quot;@drawable/fan8&quot;</span> android:duration=<span class="string">&quot;50&quot;</span> /&gt;</span><br><span class="line">&lt;/animation-list&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><hr>        <h2 id="å¾Œè¨˜"   >          <a href="#å¾Œè¨˜" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¾Œè¨˜" class="headerlink" title="å¾Œè¨˜"></a>å¾Œè¨˜</h2>      <p>ç•¶targetSdkVersion &gt;= 28ï¼Œåˆ·æ–°æ™‚æœƒé€ æˆAPPé–ƒé€€ã€‚é€™æ™‚åªè¦å°‡enableTopProgressBarè¨­å®šç‚ºfalseå°±èƒ½å¤ åœ¨targetSdkVersion &gt;= 28æ™‚æ­£å¸¸ä½¿ç”¨äº†ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> swipeRefreshLayout = findViewById(R.id.swipeRefreshLayout)</span><br><span class="line">swipeRefreshLayout.enableTopProgressBar(<span class="literal">false</span>)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-View-ä¸‹æ‹‰åˆ·æ–°-Refresh-SwipeRefresh"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-ä¸‹æ‹‰åˆ·æ–°-Refresh-SwipeRefresh" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-ä¸‹æ‹‰åˆ·æ–°-Refresh-SwipeRefresh" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ View ä¸‹æ‹‰åˆ·æ–° Refresh SwipeRefresh"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>View</code> <code>ä¸‹æ‹‰åˆ·æ–°</code> <code>Refresh</code> <code>SwipeRefresh</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æµ®å‹•ç›®éŒ„PopMenu(é™„æŒ‡å®šAPPåˆ†äº«è·¯å¾‘)</title>
      <link href="/tutu1023/2021/04/29/%E6%B5%AE%E5%8B%95%E7%9B%AE%E9%8C%84PopMenu(%E9%99%84%E6%8C%87%E5%AE%9AAPP%E5%88%86%E4%BA%AB%E8%B7%AF%E5%BE%91)/"/>
      <url>/tutu1023/2021/04/29/%E6%B5%AE%E5%8B%95%E7%9B%AE%E9%8C%84PopMenu(%E9%99%84%E6%8C%87%E5%AE%9AAPP%E5%88%86%E4%BA%AB%E8%B7%AF%E5%BE%91)/</url>
      
        <content type="html"><![CDATA[<p>Updateï¼š2020/04/15  Codeï¼šKotlin<br>Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/joelan/WeiboPopupMenu" >https://github.com/joelan/WeiboPopupMenu</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/KbMThEy.png" alt="Imgur"></p><hr>        <h3 id="1-å‰µå»ºä¸€å€‹PopMenuä¸”åŠ å…¥MenuItem"   >          <a href="#1-å‰µå»ºä¸€å€‹PopMenuä¸”åŠ å…¥MenuItem" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å‰µå»ºä¸€å€‹PopMenuä¸”åŠ å…¥MenuItem" class="headerlink" title="1.å‰µå»ºä¸€å€‹PopMenuä¸”åŠ å…¥MenuItem"></a>1.å‰µå»ºä¸€å€‹PopMenuä¸”åŠ å…¥MenuItem</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> message=<span class="string">&quot;your message&quot;</span></span><br><span class="line"><span class="keyword">val</span> mPopMenu = PopMenu.Builder().attachToActivity(<span class="keyword">this</span>)</span><br><span class="line">    .addMenuItem(PopMenuItem(<span class="string">&quot;LINE&quot;</span>, resources.getDrawable(R.drawable.line)))</span><br><span class="line">    .addMenuItem(PopMenuItem(<span class="string">&quot;å‹•æ…‹æ¶ˆæ¯&quot;</span>, resources.getDrawable(R.drawable.facebook)))</span><br><span class="line">    .addMenuItem(PopMenuItem(<span class="string">&quot;Telegram&quot;</span>, resources.getDrawable(R.drawable.telegram)))</span><br><span class="line">    .addMenuItem(PopMenuItem(<span class="string">&quot;è¨Šæ¯&quot;</span>, resources.getDrawable(R.drawable.message)))</span><br><span class="line">    .addMenuItem(PopMenuItem(<span class="string">&quot;è¤‡è£½éˆçµ&quot;</span>, resources.getDrawable(R.drawable.hyperlink)))</span><br><span class="line">    .addMenuItem(PopMenuItem(<span class="string">&quot;é¡¯ç¤ºæ›´å¤š&quot;</span>, resources.getDrawable(R.drawable.other)))</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="2-è¨­å®šItemçš„ClickListener"   >          <a href="#2-è¨­å®šItemçš„ClickListener" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-è¨­å®šItemçš„ClickListener" class="headerlink" title="2.è¨­å®šItemçš„ClickListener"></a>2.è¨­å®šItemçš„ClickListener</h3>      <p>åˆ©ç”¨mPopMenu.getMenuItem(position).textView.textä½œç‚ºæŒ‰éˆ•åˆ¤æ–·æŒ‡æ¨™</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.setOnItemClickListener &#123; popMenu, position -&gt;</span><br><span class="line">    <span class="keyword">when</span>(mPopMenu.getMenuItem(position).textView.text)&#123;</span><br><span class="line">        <span class="string">&quot;LINE&quot;</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> sendIntent = Intent()</span><br><span class="line">            sendIntent.flags=Intent.FLAG_ACTIVITY_SINGLE_TOP</span><br><span class="line">            sendIntent.action = Intent.ACTION_SEND</span><br><span class="line">            sendIntent.putExtra(Intent.EXTRA_TEXT, message)</span><br><span class="line">            sendIntent.type = <span class="string">&quot;text/plain&quot;</span></span><br><span class="line">            sendIntent.`<span class="keyword">package</span>`=<span class="string">&quot;jp.naver.line.android&quot;</span></span><br><span class="line">            startActivity(Intent.createChooser(sendIntent, <span class="string">&quot;åˆ†äº«å…§å®¹åˆ°...&quot;</span>))</span><br><span class="line">        &#125;            </span><br><span class="line">        <span class="string">&quot;å‹•æ…‹æ¶ˆæ¯&quot;</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> sendIntent = Intent()</span><br><span class="line">            sendIntent.flags=Intent.FLAG_ACTIVITY_SINGLE_TOP</span><br><span class="line">            sendIntent.action = Intent.ACTION_SEND</span><br><span class="line">            sendIntent.putExtra(Intent.EXTRA_TEXT, message)</span><br><span class="line">            sendIntent.type = <span class="string">&quot;text/plain&quot;</span></span><br><span class="line">            sendIntent.`<span class="keyword">package</span>`=<span class="string">&quot;com.facebook.katana&quot;</span></span><br><span class="line">            startActivity(Intent.createChooser(sendIntent, <span class="string">&quot;åˆ†äº«å…§å®¹åˆ°...&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;Telegram&quot;</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> myIntent = Intent(Intent.ACTION_SEND)</span><br><span class="line">            myIntent.type = <span class="string">&quot;text/plain&quot;</span></span><br><span class="line">            myIntent.setPackage(<span class="string">&quot;org.telegram.messenger&quot;</span>)</span><br><span class="line">            myIntent.putExtra(Intent.EXTRA_TEXT, message)</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                startActivity(myIntent)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> ( ex:android.content.ActivityNotFoundException) &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;Telegram Not Install&quot;</span>, Toast.LENGTH_LONG).show()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;è¨Šæ¯&quot;</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> sendIntent = Intent( Intent.ACTION_VIEW, Uri.parse( <span class="string">&quot;sms:&quot;</span> + <span class="string">&quot;&quot;</span> ) )</span><br><span class="line">            sendIntent.putExtra( <span class="string">&quot;sms_body&quot;</span>, message )</span><br><span class="line">            startActivity(sendIntent)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;è¤‡è£½éˆçµ&quot;</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> clipboard = getSystemService(Context.CLIPBOARD_SERVICE) <span class="keyword">as</span> ClipboardManager</span><br><span class="line">            <span class="keyword">val</span> clip = ClipData.newPlainText(<span class="string">&quot;58_share&quot;</span>, message)</span><br><span class="line">            clipboard.setPrimaryClip(clip)</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;éˆçµå·²è¤‡è£½&quot;</span>,Toast.LENGTH_LONG).show()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">&quot;é¡¯ç¤ºæ›´å¤š&quot;</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> sendIntent = Intent()</span><br><span class="line">            sendIntent.flags=Intent.FLAG_ACTIVITY_SINGLE_TOP</span><br><span class="line">            sendIntent.action = Intent.ACTION_SEND</span><br><span class="line">            sendIntent.putExtra(Intent.EXTRA_TEXT, message)</span><br><span class="line">            sendIntent.type = <span class="string">&quot;text/plain&quot;</span></span><br><span class="line">            startActivity(Intent.createChooser(sendIntent, <span class="string">&quot;åˆ†äº«å…§å®¹åˆ°...&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="3-è¨­å®šæ¬„ä½æ•¸ä»¥åŠå»ºç«‹"   >          <a href="#3-è¨­å®šæ¬„ä½æ•¸ä»¥åŠå»ºç«‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è¨­å®šæ¬„ä½æ•¸ä»¥åŠå»ºç«‹" class="headerlink" title="3.è¨­å®šæ¬„ä½æ•¸ä»¥åŠå»ºç«‹"></a>3.è¨­å®šæ¬„ä½æ•¸ä»¥åŠå»ºç«‹</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.columnCount(<span class="number">6</span>)</span><br><span class="line">.build()            </span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="4-è¨­å®šå…¶ä»–å®¢è£½åŒ–é¸é …ä»¥åŠé¡¯ç¤º"   >          <a href="#4-è¨­å®šå…¶ä»–å®¢è£½åŒ–é¸é …ä»¥åŠé¡¯ç¤º" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-è¨­å®šå…¶ä»–å®¢è£½åŒ–é¸é …ä»¥åŠé¡¯ç¤º" class="headerlink" title="4.è¨­å®šå…¶ä»–å®¢è£½åŒ–é¸é …ä»¥åŠé¡¯ç¤º"></a>4.è¨­å®šå…¶ä»–å®¢è£½åŒ–é¸é …ä»¥åŠé¡¯ç¤º</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mPopMenu.setmBackGroundColor(resources.getColor(R.color.TransBlackDeep))</span><br><span class="line">mPopMenu.setmCloseButtomResourceid(R.drawable.baseline_clear_24)<span class="comment">//Xåœ–ç¤ºï¼Œé¡è‰²éœ€æ–¼XMLå…ˆè¡Œè¨­å®š</span></span><br><span class="line">mPopMenu.setmMarginTopRemainSpace(<span class="number">3.0f</span>)<span class="comment">//è¨­å®šï¼­arginTopçš„æ•¸å€¼ï¼¦</span></span><br><span class="line">mPopMenu.textcolor=R.color.TextWhiteGray<span class="comment">//Itemæ¨™é¡Œé¡è‰²</span></span><br><span class="line">mPopMenu.show()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-View-Menu-PopMenu-Share"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-Menu-PopMenu-Share" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-Menu-PopMenu-Share" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ View Menu PopMenu Share"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>View</code> <code>Menu</code> <code>PopMenu</code> <code>Share</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æµ®å‹•åœ–ç¤ºFloatingView</title>
      <link href="/tutu1023/2021/04/29/%E6%B5%AE%E5%8B%95%E5%9C%96%E7%A4%BAFloatingView/"/>
      <url>/tutu1023/2021/04/29/%E6%B5%AE%E5%8B%95%E5%9C%96%E7%A4%BAFloatingView/</url>
      
        <content type="html"><![CDATA[<p>Updateï¼š2019/12/11  Codeï¼šJavaã€Kotlin<br>Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/recruit-lifestyle/FloatingView" >https://github.com/recruit-lifestyle/FloatingView</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/FPjviHU.png" alt="Imgur"></p><p>åœ–ç¤ºéœ€è¦æ¼‚æµ®åœ¨æ¡Œé¢ä»¥åŠå…¶ä»–æ‡‰ç”¨ç¨‹å¼ä¸Šæ–¹ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å¿«é€Ÿå›åˆ°APPã€‚</p><hr><p>1.åŠ å…¥ä¾è³´åˆ°build.gradle(Module:app)</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url <span class="string">&quot;https://jitpack.io&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;com.github.recruit-lifestyle:FloatingView:2.4.4&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>2.å‰µå»ºä¸€å€‹ä¼ºæœå™¨</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatHeadService</span> <span class="keyword">extends</span> <span class="title">Service</span> <span class="keyword">implements</span> <span class="title">FloatingViewListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;ChatHeadService&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXTRA_CUTOUT_SAFE_AREA = <span class="string">&quot;cutout_safe_area&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NOTIFICATION_ID = <span class="number">9083150</span>;</span><br><span class="line">    <span class="keyword">private</span> FloatingViewManager mFloatingViewManager;</span><br><span class="line">    <span class="keyword">private</span> ImageView iconView;</span><br><span class="line">    <span class="meta">@TargetApi(Build.VERSION_CODES.Q)</span></span><br><span class="line">    <span class="meta">@RequiresApi(api = Build.VERSION_CODES.M)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mFloatingViewManager != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> START_STICKY;   <span class="comment">//å¦‚æœå·²ç¶“å­˜åœ¨å°±ç›´æ¥è¿”å›</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> DisplayMetrics metrics = <span class="keyword">new</span> DisplayMetrics();</span><br><span class="line">        <span class="keyword">final</span> WindowManager windowManager = (WindowManager) getSystemService(Context.WINDOW_SERVICE);</span><br><span class="line">        <span class="keyword">assert</span> windowManager != <span class="keyword">null</span>;</span><br><span class="line">        windowManager.getDefaultDisplay().getMetrics(metrics);</span><br><span class="line">        <span class="keyword">final</span> LayoutInflater inflater = LayoutInflater.from(<span class="keyword">this</span>);</span><br><span class="line">        iconView = (ImageView) inflater.inflate(R.layout.widget_chathead, <span class="keyword">null</span>, <span class="keyword">false</span>);  </span><br><span class="line">        Bitmap bmp;    <span class="comment">//è¨­å®šåœ–ç¤º</span></span><br><span class="line">        <span class="keyword">int</span> width=<span class="number">300</span>;</span><br><span class="line">        <span class="keyword">int</span> height=<span class="number">300</span>;</span><br><span class="line">        bmp = BitmapFactory.decodeResource(getResources(),R.drawable.rd);<span class="comment">//image is your image</span></span><br><span class="line">        bmp = Bitmap.createScaledBitmap(bmp, width,height, <span class="keyword">true</span>);</span><br><span class="line">        iconView.setImageBitmap(bmp);</span><br><span class="line">        iconView.setOnClickListener(view -&gt; &#123;</span><br><span class="line">            <span class="comment">//é»æ“Šåœ–ç¤ºå¾Œè¦åšçš„äº‹æƒ…</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        mFloatingViewManager = <span class="keyword">new</span> FloatingViewManager(<span class="keyword">this</span>, <span class="keyword">this</span>);</span><br><span class="line">        mFloatingViewManager.setFixedTrashIconImage(R.drawable.ic_trash_fixed);</span><br><span class="line">        mFloatingViewManager.setActionTrashIconImage(R.drawable.ic_trash_action);</span><br><span class="line">        mFloatingViewManager.setSafeInsetRect((Rect) intent.getParcelableExtra(EXTRA_CUTOUT_SAFE_AREA));</span><br><span class="line">        <span class="keyword">final</span> FloatingViewManager.Options options = <span class="keyword">new</span> FloatingViewManager.Options();</span><br><span class="line">        options.overMargin = (<span class="keyword">int</span>) (<span class="number">16</span> * metrics.density);</span><br><span class="line">        mFloatingViewManager.addViewToWindow(iconView, options);</span><br><span class="line">        <span class="comment">// å¸¸é§èµ·å‹•</span></span><br><span class="line">        startForeground(NOTIFICATION_ID, createNotification(<span class="keyword">this</span>));</span><br><span class="line">        YoYo.with(Techniques.Shake)   <span class="comment">//YoYoç‚ºå‹•ç•«å¥—ä»¶ ä¸»è¦ä½œç”¨ç‚ºç”¢ç”Ÿåœ–ç¤ºæ™‚åšå–ä½¿ç”¨è€…æ³¨æ„çš„éœ‡å‹•</span></span><br><span class="line">                .duration(<span class="number">500</span>)</span><br><span class="line">                .repeat(<span class="number">1</span>)</span><br><span class="line">                .playOn(iconView);</span><br><span class="line">        <span class="keyword">return</span> START_REDELIVER_INTENT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        destroy();</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinishFloatingView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stopSelf();</span><br><span class="line">        Log.d(TAG, getString(R.string.finish_deleted));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTouchFinished</span><span class="params">(<span class="keyword">boolean</span> isFinishing, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isFinishing) &#123;</span><br><span class="line">            Log.d(TAG, getString(R.string.deleted_soon));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Log.d(TAG, getString(R.string.touch_finished_position, x, y));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mFloatingViewManager != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mFloatingViewManager.removeAllViewToWindow();</span><br><span class="line">            mFloatingViewManager = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Notification <span class="title">createNotification</span><span class="params">(Context context)</span> </span>&#123;   <span class="comment">//è¨­ç½®é€šçŸ¥</span></span><br><span class="line">        <span class="keyword">final</span> NotificationCompat.Builder builder = <span class="keyword">new</span> NotificationCompat.Builder(context, context.getString(R.string.default_floatingview_channel_id));</span><br><span class="line">        builder.setWhen(System.currentTimeMillis());</span><br><span class="line">        builder.setSmallIcon(R.mipmap.ic_noti_58);</span><br><span class="line">        builder.setContentTitle(context.getString(R.string.chathead_content_title));</span><br><span class="line">        builder.setContentText(context.getString(R.string.content_text));</span><br><span class="line">        builder.setOngoing(<span class="keyword">true</span>);</span><br><span class="line">        builder.setPriority(NotificationCompat.PRIORITY_MIN);</span><br><span class="line">        builder.setCategory(NotificationCompat.CATEGORY_SERVICE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>3.åœ¨AndroidManifestä¸­é–‹å•Ÿæ¬Šé™</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span>/&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.FOREGROUND_SERVICE&quot;</span> /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>4.åœ¨AndroidManifestä¸­å®šç¾©Service</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">    &lt;service android:name=<span class="string">&quot;.FloatingController.ChatHeadService&quot;</span></span><br><span class="line">        android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">        ...</span><br><span class="line">    /&gt;</span><br><span class="line">&lt;/application&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>5.å‘¼å«æ–¹æ³•</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showFloatingView(applicationContext, isShowOverlayPermission &#x3D; true, isCustomFloatingView &#x3D; false)</span><br></pre></td></tr></table></div></figure><p>é€™æ™‚æœƒé‡åˆ°ä¸€å€‹ç‰¹æ®Šæ¬Šé™ï¼Œå«åšã€Œåœ¨å…¶ä»–æ‡‰ç”¨ç¨‹å¼ä¸Šå±¤ç¹ªè£½å…§å®¹ã€ï¼Œç¶“ç”±google playèªè­‰çš„appæ˜¯é è¨­é–‹å•Ÿçš„</p><p>åœ¨å®‰å“6(API22)ä»¥ä¸Šæ‰æœ‰å€åˆ†æ˜¯è·Ÿå¦!!!!sdkéœ€å¤§æ–¼å®‰å“6ä»¥ä¸Š(å«)æ‰èƒ½è©¢å•ï¼Œä¸ç„¶æœƒå ±éŒ¯</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Settings.canDrawOverlays(this)   &#x2F;&#x2F;åˆ¤æ–·æ˜¯å¦å¯åœ¨å…¶ä»–ç¨‹å¼ä¸Šç¹ªè£½æ±è¥¿</span><br></pre></td></tr></table></div></figure><p>è‹¥å¾—åˆ°falseï¼Œéœ€è·³è½‰åˆ°è¨­å®šé è®“ä½¿ç”¨è€…æ‰‹å‹•è¨­å®š</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION, Uri.parse(&quot;package:$packageName&quot;))</span><br></pre></td></tr></table></div></figure><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@SuppressLint(<span class="meta-string">&quot;NewApi&quot;</span>)</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showFloatingView</span><span class="params">(context: <span class="type">Context</span>, isShowOverlayPermission: <span class="type">Boolean</span>, isCustomFloatingView: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// API22ä»¥ä¸‹ä¸éœ€è¦è©¢å•Settings.canDrawOverlays(context)ï¼Œè©¢å•æœƒé–ƒé€€</span></span><br><span class="line">    <span class="comment">//  --&gt;ç›´æ¥é–‹å•Ÿä¸‹ä¸€æ­¥</span></span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.LOLLIPOP_MR1) &#123;</span><br><span class="line">        startFloatingViewService(<span class="keyword">this</span>, isCustomFloatingView)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// API22ä»¥ä¸Šå…ˆè©¢å•Settings.canDrawOverlays(context)</span></span><br><span class="line">    <span class="keyword">if</span> (Settings.canDrawOverlays(context)) &#123;</span><br><span class="line">        startFloatingViewService(<span class="keyword">this</span>, isCustomFloatingView)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ²’æœ‰é–‹å•ŸcanDrawOverlays è·³è½‰åˆ°è¨­å®šè®“ä½¿ç”¨è€…æ‰‹å‹•é–‹å•Ÿ</span></span><br><span class="line">    <span class="keyword">if</span> (isShowOverlayPermission) &#123;</span><br><span class="line">        <span class="keyword">val</span> intent = Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION, Uri.parse(<span class="string">&quot;package:&quot;</span> + context.packageName))</span><br><span class="line">        startActivityForResult(</span><br><span class="line">            intent,</span><br><span class="line">            <span class="keyword">if</span> (isCustomFloatingView) CUSTOM_OVERLAY_PERMISSION_REQUEST_CODE <span class="keyword">else</span> CHATHEAD_OVERLAY_PERMISSION_REQUEST_CODE</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">startFloatingViewService</span><span class="params">(activity: <span class="type">Activity</span>, isCustomFloatingView: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// *** You must follow these rules when obtain the cutout(FloatingViewManager.findCutoutSafeArea) ***</span></span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) &#123;</span><br><span class="line">        <span class="comment">// 1. &#x27;windowLayoutInDisplayCutoutMode&#x27; do not be set to &#x27;never&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> (activity.window.attributes.layoutInDisplayCutoutMode == WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_NEVER) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;&#x27;windowLayoutInDisplayCutoutMode&#x27; do not be set to &#x27;never&#x27;&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. Do not set Activity to landscape</span></span><br><span class="line">        <span class="keyword">if</span> (activity.resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE) &#123;</span><br><span class="line">            <span class="keyword">throw</span> RuntimeException(<span class="string">&quot;Do not set Activity to landscape&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// launch service</span></span><br><span class="line">    <span class="keyword">val</span> service: Class&lt;<span class="keyword">out</span> Service&gt;</span><br><span class="line">    <span class="keyword">val</span> key: String</span><br><span class="line">    <span class="keyword">if</span> (isCustomFloatingView) &#123;</span><br><span class="line">        service = CustomFloatingViewService::<span class="keyword">class</span>.java</span><br><span class="line">        key = CustomFloatingViewService.EXTRA_CUTOUT_SAFE_AREA</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        service = ChatHeadService::<span class="keyword">class</span>.java</span><br><span class="line">        key = ChatHeadService.EXTRA_CUTOUT_SAFE_AREA</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> intent = Intent(activity, service)</span><br><span class="line">    intent.putExtra(key, FloatingViewManager.findCutoutSafeArea(activity))</span><br><span class="line">    ContextCompat.startForegroundService(activity, intent)</span><br><span class="line">&#125;         </span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-View-Floating-æµ®å‹•-Server"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-Floating-æµ®å‹•-Server" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-View-Floating-æµ®å‹•-Server" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ View Floating æµ®å‹• Server"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>View</code> <code>Floating</code> <code>æµ®å‹•</code> <code>Server</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ—¥å¤œé–“æ¨¡å¼DayNight</title>
      <link href="/tutu1023/2021/04/29/%E6%97%A5%E5%A4%9C%E9%96%93%E6%A8%A1%E5%BC%8FDayNight/"/>
      <url>/tutu1023/2021/04/29/%E6%97%A5%E5%A4%9C%E9%96%93%E6%A8%A1%E5%BC%8FDayNight/</url>
      
        <content type="html"><![CDATA[<p>Updateï¼š2020/04/15  Codeï¼šKotlin<br>Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<br><span class="exturl"><a class="exturl__link"   href="https://www.journaldev.com/19352/android-daynight-theme-night-mode" >https://www.journaldev.com/19352/android-daynight-theme-night-mode</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br><span class="exturl"><a class="exturl__link"   href="https://www.twblogs.net/a/5b8afe592b71773b27ca3b4a" >https://www.twblogs.net/a/5b8afe592b71773b27ca3b4a</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/85ccWBP.png" alt="Imgur"></p><p>å¯¦ç¾Appå…§æ—¥å¤œé–“æ¨¡å¼åˆ‡æ›ï¼Œåˆåˆ†ç‚ºæ‰‹å‹•ä»¥åŠä¾ç…§è£ç½®ç³»çµ±NightModeåˆ‡æ›</p><hr>        <h3 id="1-æ›´æ”¹AppTheme"   >          <a href="#1-æ›´æ”¹AppTheme" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-æ›´æ”¹AppTheme" class="headerlink" title="1.æ›´æ”¹AppTheme"></a>1.æ›´æ”¹AppTheme</h3>      <p>å°‡value-&gt;styleä¸­Appéœ€å¥—ç”¨AppThemeçš„parentæ”¹ç‚ºâ€Theme.AppCompat.DayNightâ€æˆ–â€Theme.AppCompat.DayNight.NoActionBarâ€</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;style name=<span class="string">&quot;AppTheme&quot;</span> parent=<span class="string">&quot;Theme.AppCompat.DayNight.NoActionBar&quot;</span>&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;colorPrimary&quot;</span>&gt;<span class="meta">@color</span>/colorPrimary&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;colorPrimaryDark&quot;</span>&gt;<span class="meta">@color</span>/colorPrimaryDark&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;colorAccent&quot;</span>&gt;<span class="meta">@color</span>/colorAccent&lt;/item&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="2-å¢åŠ value-nightè³‡æ–™å¤¾"   >          <a href="#2-å¢åŠ value-nightè³‡æ–™å¤¾" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å¢åŠ value-nightè³‡æ–™å¤¾" class="headerlink" title="2.å¢åŠ value-nightè³‡æ–™å¤¾"></a>2.å¢åŠ value-nightè³‡æ–™å¤¾</h3>      <p>è¤‡è£½ä¸€valueè³‡æ–™å¤¾ä¸¦å‘½åç‚ºvalue-nightï¼Œæ›´æ”¹value-nightä¸­å°æ‡‰æ•¸å€¼ä»¥åŠè³‡æº</p><p>â¬‡ä»¥colorsç‚ºä¾‹ï¼Œæ›´æ”¹(night)è³‡æ–™å¤¾ä¸­çš„æ•¸å€¼ï¼ŒåŒnameä¸åŒvalue</p><p><img src="https://i.imgur.com/2J7eiRF.png" alt="Imgur"></p><p>â¬‡ä»¥drawableç‚ºä¾‹ï¼Œè¦†è“‹ç›¸åŒåç¨±çš„åœ–ç‰‡</p><p><img src="https://i.imgur.com/qQ1FGZs.png" alt="Imgur"></p>        <h3 id="3-å»ºç«‹åˆ‡æ›æ–¹å¼"   >          <a href="#3-å»ºç«‹åˆ‡æ›æ–¹å¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å»ºç«‹åˆ‡æ›æ–¹å¼" class="headerlink" title="3.å»ºç«‹åˆ‡æ›æ–¹å¼"></a>3.å»ºç«‹åˆ‡æ›æ–¹å¼</h3>              <h4 id="ä¾ç…§è£ç½®ç³»çµ±NightModeåˆ‡æ›-googleä¾†çš„è«‹å°å¿ƒæœç”¨"   >          <a href="#ä¾ç…§è£ç½®ç³»çµ±NightModeåˆ‡æ›-googleä¾†çš„è«‹å°å¿ƒæœç”¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¾ç…§è£ç½®ç³»çµ±NightModeåˆ‡æ›-googleä¾†çš„è«‹å°å¿ƒæœç”¨" class="headerlink" title="ä¾ç…§è£ç½®ç³»çµ±NightModeåˆ‡æ›(googleä¾†çš„è«‹å°å¿ƒæœç”¨)"></a>ä¾ç…§è£ç½®ç³»çµ±NightModeåˆ‡æ›(googleä¾†çš„è«‹å°å¿ƒæœç”¨)</h4>      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (getResources().getConfiguration().uiMode &amp; Configuration.UI_MODE_NIGHT_MASK) &#123;</span><br><span class="line">    <span class="keyword">case</span> Configuration.UI_MODE_NIGHT_YES:</span><br><span class="line">        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_YES);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Configuration.UI_MODE_NIGHT_NO:</span><br><span class="line">        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO);</span><br><span class="line">        <span class="keyword">break</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h4 id="æ‰‹å‹•åˆ‡æ›"   >          <a href="#æ‰‹å‹•åˆ‡æ›" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ‰‹å‹•åˆ‡æ›" class="headerlink" title="æ‰‹å‹•åˆ‡æ›"></a>æ‰‹å‹•åˆ‡æ›</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//switch button</span></span><br><span class="line">mineDayNightSwitch.setOnCheckedChangeListener &#123; _, isChecked -&gt;</span><br><span class="line">    saveNightMode(isChecked)<span class="comment">//å„²å­˜NightModeä»¥ä¾¿ä¸‹æ¬¡é–‹å•Ÿæ™‚ç›´æ¥å¥—ç”¨</span></span><br><span class="line">    <span class="keyword">if</span>(isChecked)&#123;</span><br><span class="line">        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_YES)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-æ—¥å¤œé–“-DayNight"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-æ—¥å¤œé–“-DayNight" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-æ—¥å¤œé–“-DayNight" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ æ—¥å¤œé–“ DayNight"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>æ—¥å¤œé–“</code> <code>DayNight</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å½±ç‰‡å»£å‘ŠImaAdsLoader</title>
      <link href="/tutu1023/2021/04/29/%E5%BD%B1%E7%89%87%E5%BB%A3%E5%91%8AImaAdsLoader/"/>
      <url>/tutu1023/2021/04/29/%E5%BD%B1%E7%89%87%E5%BB%A3%E5%91%8AImaAdsLoader/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2020/08/17<br>  Byï¼šAda<br>  Codeï¼šKotlin</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://developers.google.com/interactive-media-ads/docs/sdks/android/client-side" >https://developers.google.com/interactive-media-ads/docs/sdks/android/client-side</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/EmdMLPg.png" alt="Imgur"></p><p>æ”¾ç½®åœ¨å½±ç‰‡å‰çš„å½±ç‰‡å»£å‘ŠImaAdsLoaderï¼ˆæœ¬ç¯‡é©ç”¨æ–¼Androidç³»çµ±ä¹‹åŠå®˜æ–¹æ‰¿èªæ’­æ”¾å™¨ExoPlayerï¼‰</p><hr>        <h4 id="1-build-gradle-appå¢åŠ ä¾è³´"   >          <a href="#1-build-gradle-appå¢åŠ ä¾è³´" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-build-gradle-appå¢åŠ ä¾è³´" class="headerlink" title="1.build.gradle/appå¢åŠ ä¾è³´"></a>1.build.gradle/appå¢åŠ ä¾è³´</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">29</span></span><br><span class="line">    buildToolsVersion <span class="string">&quot;29.0.2&quot;</span></span><br><span class="line"></span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;com.google.android.exoplayer:exoplayer:2.11.1&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;com.google.android.exoplayer:exoplayer-hls:2.11.1&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;com.google.android.exoplayer:extension-ima:2.11.1&#x27;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h4 id="2-AndroidMenifestå¢åŠ æ¬Šé™"   >          <a href="#2-AndroidMenifestå¢åŠ æ¬Šé™" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-AndroidMenifestå¢åŠ æ¬Šé™" class="headerlink" title="2.AndroidMenifestå¢åŠ æ¬Šé™"></a>2.AndroidMenifestå¢åŠ æ¬Šé™</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span>/&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h4 id="3-æ”¾ç½®player-view"   >          <a href="#3-æ”¾ç½®player-view" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-æ”¾ç½®player-view" class="headerlink" title="3.æ”¾ç½®player_view"></a>3.æ”¾ç½®player_view</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;com.google.android.exoplayer2.ui.PlayerView</span><br><span class="line">    android:id=<span class="string">&quot;@+id/player_view&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h4 id="4-åœ¨valueçš„stringä¸­åŠ å…¥æ¸¬è©¦ç”¨å½±ç‰‡åŠå»£å‘Šç¶²å€"   >          <a href="#4-åœ¨valueçš„stringä¸­åŠ å…¥æ¸¬è©¦ç”¨å½±ç‰‡åŠå»£å‘Šç¶²å€" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-åœ¨valueçš„stringä¸­åŠ å…¥æ¸¬è©¦ç”¨å½±ç‰‡åŠå»£å‘Šç¶²å€" class="headerlink" title="4.åœ¨valueçš„stringä¸­åŠ å…¥æ¸¬è©¦ç”¨å½±ç‰‡åŠå»£å‘Šç¶²å€"></a>4.åœ¨valueçš„stringä¸­åŠ å…¥æ¸¬è©¦ç”¨å½±ç‰‡åŠå»£å‘Šç¶²å€</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;string name=<span class="string">&quot;content_url&quot;</span>&gt;&lt;![CDATA[https:<span class="comment">//storage.googleapis.com/gvabox/media/samples/stock.mp4]]&gt;&lt;/string&gt;</span></span><br><span class="line">&lt;string name=<span class="string">&quot;ad_tag_url&quot;</span>&gt;&lt;![CDATA[https:<span class="comment">//pubads.g.doubleclick.net/gampad/ads?sz=640x480&amp;iu=/124319096/external/single_ad_samples&amp;ciu_szs=300x250&amp;impl=s&amp;gdfp_req=1&amp;env=vp&amp;output=vast&amp;unviewed_position_start=1&amp;cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&amp;correlator=]]&gt;&lt;/string&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h4 id="5-åˆå§‹åŒ–æ’­æ”¾å™¨"   >          <a href="#5-åˆå§‹åŒ–æ’­æ”¾å™¨" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-åˆå§‹åŒ–æ’­æ”¾å™¨" class="headerlink" title="5.åˆå§‹åŒ–æ’­æ”¾å™¨"></a>5.åˆå§‹åŒ–æ’­æ”¾å™¨</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">simpleExoplayer = SimpleExoPlayer.Builder(<span class="keyword">this</span>).build()</span><br><span class="line">simpleExoplayerView.setPlayer(simpleExoplayer)</span><br><span class="line"></span><br><span class="line">imaAdsLoader = ImaAdsLoader(<span class="keyword">this</span>,Uri.parse(getString(R.string.ad_tag_url)))<span class="comment">//é è¨­å»£å‘Šç¶²å€</span></span><br><span class="line">imaAdsLoader.setPlayer(simpleExoplayer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> defaultDataSourceFactory= DefaultHttpDataSourceFactory(Util.getUserAgent(<span class="keyword">this</span>, <span class="string">&quot;app-name&quot;</span>))</span><br><span class="line"><span class="keyword">val</span> mediaSource = HlsMediaSource.Factory(defaultDataSourceFactory).createMediaSource(Uri.parse(R.string.content_url)) <span class="comment">//é è¨­å½±ç‰‡ç¶²å€</span></span><br><span class="line"><span class="keyword">val</span> adsMediaSource = AdsMediaSource(mediaSource, defaultDataSourceFactory, imaAdsLoader, simpleExoPlayerView)</span><br><span class="line">simpleExoplayer.prepare(adsMediaSource)</span><br><span class="line">simpleExoplayer.seekTo(<span class="number">0L</span>)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h4 id="6-è¨˜å¾—åœ¨onDestroyæŠŠå»£å‘Šé‡‹æ”¾æ‰"   >          <a href="#6-è¨˜å¾—åœ¨onDestroyæŠŠå»£å‘Šé‡‹æ”¾æ‰" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-è¨˜å¾—åœ¨onDestroyæŠŠå»£å‘Šé‡‹æ”¾æ‰" class="headerlink" title="6.è¨˜å¾—åœ¨onDestroyæŠŠå»£å‘Šé‡‹æ”¾æ‰"></a>6.è¨˜å¾—åœ¨onDestroyæŠŠå»£å‘Šé‡‹æ”¾æ‰</h4>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//æ¸…é™¤å»£å‘Šçš„å¿«å–</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    imaAdsLoader.release()</span><br><span class="line">&#125;<span class="keyword">catch</span> (e:Exception)&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>Do Re Mi So ~ ~ é€™æ¨£å°±å¤§åŠŸå‘Šæˆäº†<br>è‡³æ–¼æ€éº¼æ¨£å°‡å»£å‘Šå¹³å‡åˆ†é…åœ¨å½±ç‰‡ä¸­ï¼Œé‚„æ²’æœ‰ç ”ç©¶å‡ºä¾†ğŸ˜‚</p>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-Video-ImaAdsLoader-ExoPlayer-å»£å‘Š"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-ImaAdsLoader-ExoPlayer-å»£å‘Š" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-ImaAdsLoader-ExoPlayer-å»£å‘Š" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ Video ImaAdsLoader ExoPlayer å»£å‘Š"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>Video</code> <code>ImaAdsLoader</code> <code>ExoPlayer</code> <code>å»£å‘Š</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è³‡æ–™åº«Room</title>
      <link href="/tutu1023/2021/04/29/%E8%B3%87%E6%96%99%E5%BA%ABRoom/"/>
      <url>/tutu1023/2021/04/29/%E8%B3%87%E6%96%99%E5%BA%ABRoom/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2019/12/12<br>  Codeï¼šKotlin<br>  Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://medium.com/jastzeonic/kotlin-room-%E4%BD%BF%E7%94%A8%E5%88%9D%E9%AB%94%E9%A9%97-f3af4f8ddc80" >https://medium.com/jastzeonic/kotlin-room-%E4%BD%BF%E7%94%A8%E5%88%9D%E9%AB%94%E9%A9%97-f3af4f8ddc80</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>1.å°å…¥ä¾è³´</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;androidx.room:room-runtime:2.2.2&#x27;</span></span><br><span class="line">    kapt <span class="string">&#x27;androidx.room:room-compiler:2.2.2&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>2.å»ºç«‹ Room çš„ Entities(keyå€¼ã€æ¬„ä½çš„éƒ¨åˆ†)ï¼Œè¨­å®štableåç¨±</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity(tableName = FavoModel.TABLE_NAME)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FavoModel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TABLE_NAME = <span class="string">&quot;favorite&quot;</span>    <span class="comment">//è¨­å®šTableåç¨±</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PrimaryKey(autoGenerate = true)</span>    <span class="comment">//æ¬„ä½</span></span><br><span class="line">    <span class="keyword">var</span> id: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&quot;&quot;</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@ColumnInfo(name = <span class="meta-string">&quot;timestamp&quot;</span>, typeAffinity = ColumnInfo.TEXT)</span></span><br><span class="line">    <span class="keyword">var</span> time = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    <span class="keyword">var</span> ignoreText = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>3.å»ºç«‹ Dao interfaceï¼ŒåŒ…å«</p><ul><li>  <a href="#GetAll">GetAll</a></li><li>  <a href="#QueryById">QueryById</a></li><li>  <a href="#Insert">Insert</a></li><li>  <a href="#Update">Update</a></li><li>  <a href="#Delete">Delete</a></li></ul><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FavoDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(<span class="meta-string">&quot;select * from &quot;</span> + FavoModel.TABLE_NAME + <span class="meta-string">&quot; order by timestamp DESC&quot;</span>)</span>   </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getAll</span><span class="params">()</span></span>: List&lt;FavoModel&gt;                                               ã€€ </span><br><span class="line">                                            <span class="comment">//timestamp from 2.Entities @ColumnInfo(æ–°å¢/æ›´æ–°æ™‚ä»¥item.timeä¾†è¨˜éŒ„)</span></span><br><span class="line">                                            <span class="comment">//ASCå°åˆ°å¤§æ’åº DESCå¤§åˆ°å°æ’åº</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(<span class="meta-string">&quot;select * from &quot;</span> + FavoModel.TABLE_NAME + <span class="meta-string">&quot; where id LIKE :id LIMIT 1&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">queryById</span><span class="params">(id: <span class="type">Int</span>)</span></span>: FavoModel</span><br><span class="line">                                            <span class="comment">//ç•¶id = æ‰€éœ€ id ä¸”é™åˆ¶å–ä¸€ç­†</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">insert</span><span class="params">(item: <span class="type">FavoModel</span>)</span></span>:<span class="built_in">Long</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(item: <span class="type">FavoModel</span>)</span></span>:<span class="built_in">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(item: <span class="type">FavoModel</span>)</span></span>:<span class="built_in">Int</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>4.éœ€è¦å»ºç«‹ä¸€å€‹æ¨™ç¤º Database ä»¥åŠç¹¼æ‰¿ RoomDatabase çš„æŠ½è±¡å‹åˆ¥</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Database(entities = [(FavoModel::class)</span>], version = <span class="number">1</span>)</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoDatabase</span> : <span class="type">RoomDatabase</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_NAME = <span class="string">&quot;database&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getTodoDao</span><span class="params">()</span></span>: FavoDao</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>5.å¦‚æœ‰å¤šå¼µTableï¼Œå‰µå»ºå°ˆå±¬çš„Modelèˆ‡Daoï¼Œä¸¦åœ¨DataBaseä¸­ï¼ŒåŠ å…¥entitiesæ¬„ä½ä»¥åŠgetDaoæ–¹æ³•</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Database(entities = [(FavoModel::class)</span>,(FollowModel::<span class="class"><span class="keyword">class</span>),<span class="type"></span></span>(RecordModel::<span class="class"><span class="keyword">class</span>)], <span class="type">version = 1)</span></span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoDatabase</span> : <span class="type">RoomDatabase</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_NAME = <span class="string">&quot;database&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getFavoDao</span><span class="params">()</span></span>: FavoDao</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getFollowDao</span><span class="params">()</span></span>: FollowDao</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getRecordDao</span><span class="params">()</span></span>: RecordDao</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>6.è‹¥æ–°ç‰ˆæœ¬éœ€è¦æ–°å¢tableæˆ–æ›´æ”¹è¡¨å–®æ¬„ä½ï¼ŒDataBaseä¸­çš„versionéœ€åŠ 1ï¼Œä¸¦æ·»åŠ migrationæ–¹æ³•ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Database(entities = [(FavoModel::class)</span>,(FollowModel::<span class="class"><span class="keyword">class</span>),<span class="type"></span></span>(RecordModel::<span class="class"><span class="keyword">class</span>)], <span class="type">version = 2)</span></span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoDatabase</span> : <span class="type">RoomDatabase</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_NAME = <span class="string">&quot;database&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">val</span> MIGRATION_1_2 = <span class="keyword">object</span> : Migration(<span class="number">1</span>, <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">migrate</span><span class="params">(database: <span class="type">SupportSQLiteDatabase</span>)</span></span> &#123;</span><br><span class="line">                <span class="keyword">val</span> tableName = TodoModel.TABLE_NAME</span><br><span class="line">                database.execSQL(<span class="string">&quot;ALTER TABLE <span class="variable">$tableName</span> ADD COLUMN imageUrl TEXT NOT NULL DEFAULT &#x27;&#x27;&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getFavoDao</span><span class="params">()</span></span>: FavoDao</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getFollowDao</span><span class="params">()</span></span>: FollowDao</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getRecordDao</span><span class="params">()</span></span>: RecordDao</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>åœ¨å‘¼å«æ™‚ä¹Ÿéœ€è¦ä¸€å€‹addMigrationçš„æ–¹æ³•ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">AsyncTask.execute(&#123;</span><br><span class="line">    todoDatabase = Room.databaseBuilder(applicationContext, TodoDatabase::<span class="keyword">class</span>.java, TodoDatabase.DATABASE_NAME)</span><br><span class="line">        .addMigrations(TodoDatabase.MIGRATION_1_2)</span><br><span class="line">        .build()</span><br><span class="line">    todoDao = todoDatabase.getTodoDao()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><hr>        <h1 id="æ–¹æ³•"   >          <a href="#æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h1>      <p>è³‡æ–™åº«ç„¡æ³•åœ¨UI Threadä¸ŠåŸ·è¡Œï¼Œæ‰€ä»¥éœ€è¦ç”¨AsyncTask.executeåŒ…èµ·ä¾†ã€‚ç”¨å®Œè¨˜å¾—è¦æŠŠè³‡æ–™åº«é—œé–‰ï¼Œæœ‰äº›æ©Ÿå‹å°æ–¼è³‡æ–™åº«é‡è¤‡é–‹å•Ÿæœªé—œé–‰æœƒé€ æˆç³»çµ±åƒä¸æ¶ˆã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AsyncTask.execute(&#123;</span><br><span class="line">    <span class="keyword">val</span> todoDatabase = Room.databaseBuilder(applicationContext, TodoDatabase::<span class="keyword">class</span>.java, TodoDatabase.DATABASE_NAME)</span><br><span class="line">        .allowMainThreadQueries()</span><br><span class="line">        .build()</span><br><span class="line">    <span class="keyword">val</span> todoDao = todoDatabase.getTodoDao()</span><br><span class="line">    <span class="keyword">val</span> allTodoList = todoDao.getAll()</span><br><span class="line">    <span class="comment">//getAll()æ–¹æ³•åªèƒ½æŠ“åˆ°ä½ç½®</span></span><br><span class="line">    </span><br><span class="line">    todoDatabase.close()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>        <h3 id="GetAll"   >          <a href="#GetAll" class="heading-link"><i class="fas fa-link"></i></a>GetAll_ç²å–åˆ—è¡¨</h3>      <p><strong>getåˆ—è¡¨size</strong>ï¼štodoDatabase.getTodoDao().getAll().size<br><strong>getåˆ—è¡¨[0]çš„idå€¼</strong>ï¼štodoDatabase.getTodoDao().getAll()[0].id</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">AsyncTask.execute &#123;</span><br><span class="line">    <span class="keyword">val</span> todoDatabase = Room.databaseBuilder(applicationContext, TodoDatabase::<span class="keyword">class</span>.java, TodoDatabase.DATABASE_NAME)</span><br><span class="line">        .build()</span><br><span class="line">    <span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">0</span> until todoDatabase.getTodoDao().getAll().size)&#123;</span><br><span class="line">        <span class="keyword">val</span> tempArray:MutableMap&lt;String,String&gt; = mutableMapOf()</span><br><span class="line">        tempArray[<span class="string">&quot;vid&quot;</span>] = todoDatabase.getTodoDao().getAll()[i].id.toString()</span><br><span class="line">        tempArray[<span class="string">&quot;name&quot;</span>] = todoDatabase.getTodoDao().getAll()[i].name</span><br><span class="line">        ...</span><br><span class="line">        collect.add(tempArray)</span><br><span class="line">    &#125;</span><br><span class="line">    activity!!.runOnUiThread &#123;</span><br><span class="line">        mAdapter.setNewData(collect)</span><br><span class="line">        mAdapter.notifyDataSetChanged()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h3 id="QueryById"   >          <a href="#QueryById" class="heading-link"><i class="fas fa-link"></i></a>QueryById_æœå°‹é …ç›®</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span>(todoDatabase.getTodoDao().queryById(id)!=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//è³‡æ–™å­˜åœ¨</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//è³‡æ–™ä¸å­˜åœ¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="Insert"   >          <a href="#Insert" class="heading-link"><i class="fas fa-link"></i></a>Insert_æ’å…¥é …ç›®</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> item = FavoModel()</span><br><span class="line">item.id=vid</span><br><span class="line">item.name=name</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">todoDatabase.getTodoDao().insert(item)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="Update"   >          <a href="#Update" class="heading-link"><i class="fas fa-link"></i></a>Update_æ›´æ–°é …ç›®</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">AsyncTask.execute &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> todoDatabase = Room.databaseBuilder(applicationContext, TodoDatabase::<span class="keyword">class</span>.java, TodoDatabase.DATABASE_NAME)</span><br><span class="line">        .build()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span>(todoDatabase.getTodoDao().queryById(id)!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">val</span> item = todoDatabase.getTodoDao().queryById(id)</span><br><span class="line">        item.name = newName</span><br><span class="line">        item.imageUrl = newImageUrl</span><br><span class="line">        todoDatabase.getTodoDao().update(item)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="Delete"   >          <a href="#Delete" class="heading-link"><i class="fas fa-link"></i></a>Delete_åˆªé™¤é …ç›®</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">AsyncTask.execute &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> todoDatabase = Room.databaseBuilder(applicationContext, TodoDatabase::<span class="keyword">class</span>.java, TodoDatabase.DATABASE_NAME)</span><br><span class="line">        .build()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span>(todoDatabase.getTodoDao().queryById(id)!=<span class="literal">null</span>)&#123;</span><br><span class="line">        todoDatabase.getTodoDao().delete(todoDatabase.getTodoDao().queryById(id))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆªåˆ°ä¸å­˜åœ¨çš„è³‡æ–™æœƒé–ƒé€€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><hr>        <h1 id="é‡åˆ°å•é¡Œ"   >          <a href="#é‡åˆ°å•é¡Œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#é‡åˆ°å•é¡Œ" class="headerlink" title="é‡åˆ°å•é¡Œ"></a>é‡åˆ°å•é¡Œ</h1>      <p><img src="https://i.imgur.com/xcBo8Yx.png" alt="Imgur"></p><p>ä»¥ä¸ŠåŸå› å‡æ˜¯å› ç‚ºè³‡æ–™åº«åœ¨ä½¿ç”¨ä¹‹å¾Œæ²’æœ‰åš.close()çš„å‹•ä½œï¼Œå¤šæ¬¡é–‹å•Ÿé€ æˆå…§å­˜ä¸è¶³</p>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-Database-Room-è³‡æ–™åº«"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-Database-Room-è³‡æ–™åº«" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-Database-Room-è³‡æ–™åº«" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ Database Room è³‡æ–™åº«"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>Database</code> <code>Room</code> <code>è³‡æ–™åº«</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é ç¨‹é…ç½®RemoteConfig(Firebase)</title>
      <link href="/tutu1023/2021/04/29/%E9%81%A0%E7%A8%8B%E9%85%8D%E7%BD%AERemoteConfig(Firebase)/"/>
      <url>/tutu1023/2021/04/29/%E9%81%A0%E7%A8%8B%E9%85%8D%E7%BD%AERemoteConfig(Firebase)/</url>
      
        <content type="html"><![CDATA[<p>Updateï¼š2020/04/15  Codeï¼šKotlin<br>Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://firebase.google.com/docs/remote-config/use-config-android" >https://firebase.google.com/docs/remote-config/use-config-android</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/3oUZ37n.png" alt="Imgur"></p><p>åˆ©ç”¨Firebaseçš„ConfigåŠŸèƒ½ï¼Œå¹«åŠ©æˆ‘å€‘åœ¨æœªæ›´æ–°æ–°ç‰ˆæœ¬çš„æƒ…æ³ä¸‹æ›´æ”¹Appä¸­çš„é…ç½®ã€‚</p><hr>        <h3 id="1-å°å…¥ä¾è³´"   >          <a href="#1-å°å…¥ä¾è³´" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å°å…¥ä¾è³´" class="headerlink" title="1.å°å…¥ä¾è³´"></a>1.å°å…¥ä¾è³´</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">implementation <span class="string">&#x27;com.google.firebase:firebase-config-ktx:19.1.3&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="2-å»ºç«‹RemoteConfigä»¥åŠè¨­å®šConfigSetting"   >          <a href="#2-å»ºç«‹RemoteConfigä»¥åŠè¨­å®šConfigSetting" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-å»ºç«‹RemoteConfigä»¥åŠè¨­å®šConfigSetting" class="headerlink" title="2.å»ºç«‹RemoteConfigä»¥åŠè¨­å®šConfigSetting"></a>2.å»ºç«‹RemoteConfigä»¥åŠè¨­å®šConfigSetting</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> remoteConfig = FirebaseRemoteConfig.getInstance()</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> firebaseRemoteConfigSettings =</span><br><span class="line">    FirebaseRemoteConfigSettings.Builder().apply &#123;</span><br><span class="line">        setDeveloperModeEnabled(<span class="literal">true</span>)</span><br><span class="line">    &#125;.build()</span><br><span class="line">    </span><br><span class="line">remoteConfig.setConfigSettings(firebaseRemoteConfigSettings)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="3-è¨­å®šé è¨­å€¼-ä»¥é˜²æ²’æœ‰æˆåŠŸæŠ“å–Configå€¼"   >          <a href="#3-è¨­å®šé è¨­å€¼-ä»¥é˜²æ²’æœ‰æˆåŠŸæŠ“å–Configå€¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-è¨­å®šé è¨­å€¼-ä»¥é˜²æ²’æœ‰æˆåŠŸæŠ“å–Configå€¼" class="headerlink" title="3.è¨­å®šé è¨­å€¼(ä»¥é˜²æ²’æœ‰æˆåŠŸæŠ“å–Configå€¼)"></a>3.è¨­å®šé è¨­å€¼(ä»¥é˜²æ²’æœ‰æˆåŠŸæŠ“å–Configå€¼)</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">remoteConfig.setDefaults(R.xml.remote_config_default)<span class="comment">//é è¨­çµæœ</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//remote_config_default.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;defaultsMap&gt;</span><br><span class="line">    &lt;entry&gt;</span><br><span class="line">        &lt;key&gt;hello_text&lt;/key&gt;</span><br><span class="line">        &lt;value&gt;Hello default&lt;/value&gt;</span><br><span class="line">    &lt;/entry&gt;</span><br><span class="line">    &lt;entry&gt;</span><br><span class="line">        &lt;key&gt;...&lt;/key&gt;</span><br><span class="line">        &lt;value&gt;...&lt;/value&gt;</span><br><span class="line">    &lt;/entry&gt;</span><br><span class="line">&lt;/defaultsMap&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="4-è¨­å®šåˆ·æ–°æ™‚é–“ä¸¦ä¸”é€å‡ºè«‹æ±‚"   >          <a href="#4-è¨­å®šåˆ·æ–°æ™‚é–“ä¸¦ä¸”é€å‡ºè«‹æ±‚" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-è¨­å®šåˆ·æ–°æ™‚é–“ä¸¦ä¸”é€å‡ºè«‹æ±‚" class="headerlink" title="4.è¨­å®šåˆ·æ–°æ™‚é–“ä¸¦ä¸”é€å‡ºè«‹æ±‚"></a>4.è¨­å®šåˆ·æ–°æ™‚é–“ä¸¦ä¸”é€å‡ºè«‹æ±‚</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// cacheåˆ·æ–°æ™‚é–“ï¼Œå–®ä½æ˜¯ç§’</span></span><br><span class="line"><span class="keyword">var</span> cacheExpiration = <span class="number">3600L</span></span><br><span class="line"><span class="keyword">if</span> (remoteConfig.info.configSettings.isDeveloperModeEnabled) &#123;</span><br><span class="line">    cacheExpiration = <span class="number">0L</span></span><br><span class="line">&#125;</span><br><span class="line">remoteConfig.fetch(cacheExpiration)</span><br><span class="line">    .addOnCompleteListener(<span class="keyword">this</span>) &#123; task -&gt;</span><br><span class="line">        <span class="keyword">if</span> (task.isSuccessful) &#123;</span><br><span class="line">            <span class="keyword">val</span> updated = remoteConfig.activate()</span><br><span class="line">            Log.d(<span class="string">&quot;remoteConfigResponse&quot;</span>,<span class="string">&quot;update -&gt; <span class="variable">$update</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        displayWelcomeMessage()<span class="comment">//è¦åŸ·è¡Œçš„æ±è¥¿</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-å·¥å…·æ•™å­¸-Firebase-Remote"   >          <a href="#tags-å·¥å…·æ•™å­¸-Firebase-Remote" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-å·¥å…·æ•™å­¸-Firebase-Remote" class="headerlink" title="tags: å·¥å…·æ•™å­¸ Firebase Remote"></a>tags: <code>å·¥å…·æ•™å­¸</code> <code>Firebase</code> <code>Remote</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Exoæ’­æ”¾å™¨ExoPlayer</title>
      <link href="/tutu1023/2021/04/29/Exo%E6%92%AD%E6%94%BE%E5%99%A8ExoPlayer/"/>
      <url>/tutu1023/2021/04/29/Exo%E6%92%AD%E6%94%BE%E5%99%A8ExoPlayer/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2020/11/16<br>  Byï¼šAda<br>  Codeï¼šKotlin</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://medium.com/@tabacowang/%E4%BD%BF%E7%94%A8exoplayer%E6%92%AD%E6%94%BE%E5%99%A8%E6%92%AD%E6%94%BE%E5%BD%B1%E7%89%87-e8cdd27e24e2" >https://medium.com/@tabacowang/%E4%BD%BF%E7%94%A8exoplayer%E6%92%AD%E6%94%BE%E5%99%A8%E6%92%AD%E6%94%BE%E5%BD%B1%E7%89%87-e8cdd27e24e2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://www.jazzcoding.com/wp-content/uploads/2020/05/exoplayer.png" alt="æˆªåœ– 2020-11-16 ä¸‹åˆ5.40.01.png"></p><p>ä½¿ç”¨Androidç³»çµ±ä¹‹åŠå®˜æ–¹æ‰¿èªæ’­æ”¾å™¨ExoPlayer</p><p><a href="#Activity">Activity</a></p><p><a href="#Fragment">Fragment</a></p><hr>        <h2 id="Activity"   >          <a href="#Activity" class="heading-link"><i class="fas fa-link"></i></a>Activityæ–¹æ³•</h2>      <hr>        <h2 id="Fragment"   >          <a href="#Fragment" class="heading-link"><i class="fas fa-link"></i></a>Fragmentæ–¹æ³•</h2>      <hr>        <h3 id="Android-11é©é…èˆ‡FragmentXè§£æ±ºè¾¦æ³•"   >          <a href="#Android-11é©é…èˆ‡FragmentXè§£æ±ºè¾¦æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#Android-11é©é…èˆ‡FragmentXè§£æ±ºè¾¦æ³•" class="headerlink" title="Android 11é©é…èˆ‡FragmentXè§£æ±ºè¾¦æ³•"></a>Android 11é©é…èˆ‡FragmentXè§£æ±ºè¾¦æ³•</h3>      <p><span class="exturl"><a class="exturl__link"   href="https://qiita.com/iKimishima/items/36ed4cc3595fa1cf1fb9" >https://qiita.com/iKimishima/items/36ed4cc3595fa1cf1fb9</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-Video-ExoPlayer"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-ExoPlayer" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-ExoPlayer" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ Video ExoPlayer"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>Video</code> <code>ExoPlayer</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç›´æ’­ä¸²æµM3U8</title>
      <link href="/tutu1023/2021/04/29/%E7%9B%B4%E6%92%AD%E4%B8%B2%E6%B5%81/"/>
      <url>/tutu1023/2021/04/29/%E7%9B%B4%E6%92%AD%E4%B8%B2%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2021/01/21<br>  Byï¼šAda</p><p>è³‡æ–™ä¾†æºï¼š</p><ul><li><span class="exturl"><a class="exturl__link"   href="https://www.itread01.com/content/1550627461.html" >ç›´æ’­åŸç†â€”-å”è­°</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>   </li><li><span class="exturl"><a class="exturl__link"   href="https://www.cnblogs.com/rsapaper/p/9807816.html" >è§†é¢‘æµåè®®HLSä¸RTMP ç›´æ’­åŸç† ç‚¹æ’­åŸç†</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>    </li><li><span class="exturl"><a class="exturl__link"   href="https://cloud.tencent.com/developer/news/122941" >ç§‘æ™®ï¼ç›´æ’­ä¸­å¸¸èªªçš„æ¨æµæ‹‰æµç©¶ç«Ÿæ˜¯ä»€éº¼æ±æ±ï¼Ÿ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ul><p>ç›®éŒ„ï¼š</p><p>[TOC]</p><hr>        <h2 id="ç›´æ’­æµç¨‹åœ–"   >          <a href="#ç›´æ’­æµç¨‹åœ–" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç›´æ’­æµç¨‹åœ–" class="headerlink" title="ç›´æ’­æµç¨‹åœ–"></a>ç›´æ’­æµç¨‹åœ–</h2>      <p><img src="https://i.imgur.com/Uwhqp94.png" alt="Imgur"></p>        <h2 id="æ¨æµã€æ‹‰æµèˆ‡CDN"   >          <a href="#æ¨æµã€æ‹‰æµèˆ‡CDN" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ¨æµã€æ‹‰æµèˆ‡CDN" class="headerlink" title="æ¨æµã€æ‹‰æµèˆ‡CDN"></a>æ¨æµã€æ‹‰æµèˆ‡CDN</h2>      <ul><li><p>æ¨æµï¼šæŠŠæ¡é›†éšæ®µå°åŒ…å¥½çš„å†…å®¹å‚³è¼¸åˆ°æœå‹™å™¨çš„éç¨‹ã€‚å…¶å¯¦å°±æ˜¯å°‡ç¾å ´çš„è¦–é »ä¿¡è™Ÿå‚³åˆ°ç¶²è·¯çš„éç¨‹ã€‚â€œæ¨æµâ€å°ç¶²è·¯è¦æ±‚æ¯”è¼ƒé«˜ï¼Œå¦‚æœç¶²è·¯ä¸ç©©å®šï¼Œç›´æ’­æ•ˆæœå°±æœƒå¾ˆå·®ï¼Œè§€çœ¾è§€çœ‹ç›´æ’­æ™‚å°±æœƒç™¼ç”Ÿå¡é “ç­‰ç¾è±¡ï¼Œè§€çœ‹é«”é©—å¾ˆæ˜¯ç³Ÿç³•ã€‚</p></li><li><p>æ‹‰æµï¼šæŒ‡æœå‹™å™¨å·²æœ‰ç›´æ’­å…§å®¹ï¼Œæ ¹æ“šå”è­°é¡å‹ï¼ˆå¦‚RTMPã€RTPã€RTSPã€HTTPç­‰ï¼‰ï¼Œèˆ‡æœå‹™å™¨å»ºç«‹é€£æ¥ä¸¦æ¥æ”¶æ•¸æ“šï¼Œé€²è¡Œæ‹‰å–çš„éç¨‹ã€‚æ‹‰æµç«¯çš„æ ¸å¿ƒè™•ç†åœ¨æ’­æ”¾å™¨ç«¯çš„è§£ç¢¼å’Œæ¸²æŸ“ï¼Œåœ¨äº’å‹•ç›´æ’­ä¸­é‚„éœ€é›†æˆèŠå¤©å®¤ã€é»è´Šå’Œç¦®ç‰©ç³»çµ±ç­‰åŠŸèƒ½ã€‚</p></li><li><p>CDNï¼šå…¨ç¨±ç‚ºContent Delivery Networkï¼Œæ˜¯ä¸€å€‹ç­–ç•¥æ€§éƒ¨ç½²çš„æ•´é«”ç³»çµ±ï¼Œä¸»è¦ç”¨ä¾†è§£æ±ºç”±æ–¼ç¶²çµ¡å¸¶å¯¬å°ã€ç”¨æˆ¶è¨ªå•é‡å¤§ã€ç¶²é»åˆ†å¸ƒä¸å‡å‹»ç­‰å°è‡´ç”¨æˆ¶è¨ªå•ç¶²ç«™é€Ÿåº¦æ…¢çš„å•é¡Œã€‚</p></li></ul><p><img src="https://i.imgur.com/X3D1btY.png" alt="Imgur"></p><hr>        <h1 id="å”è­°"   >          <a href="#å”è­°" class="heading-link"><i class="fas fa-link"></i></a><a href="#å”è­°" class="headerlink" title="å”è­°"></a>å”è­°</h1>              <h2 id="HLS"   >          <a href="#HLS" class="heading-link"><i class="fas fa-link"></i></a><a href="#HLS" class="headerlink" title="HLS"></a>HLS</h2>      <p>HTTP Live Streamingï¼ˆç°¡ç¨± HLSï¼‰æ˜¯ä¸€å€‹åŸºæ–¼ HTTP çš„è¦–é »å”è­°ï¼Œç”± Apple å…¬å¸å¯¦ç¾ï¼ŒMac OS ä¸Šçš„ QuickTimeã€Safari ä»¥åŠ iOS ä¸Šçš„ Safari éƒ½èƒ½å¾ˆå¥½çš„æ”¯æŒ HLSï¼Œé«˜ç‰ˆæœ¬ Android ä¹Ÿå¢åŠ äº†å° HLS çš„æ”¯æŒã€‚</p><p>HLS å”è­°åŸºæ–¼ HTTPï¼Œè€Œä¸€å€‹æä¾› HLS çš„æœå‹™å™¨éœ€è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li>ç·¨ç¢¼ï¼šä»¥ H.263 æ ¼å¼å°åœ–åƒé€²è¡Œç·¨ç¢¼ï¼Œä»¥ MP3 æˆ–è€… HE-AAC å°è²éŸ³é€²è¡Œç·¨ç¢¼ï¼Œæœ€çµ‚æ‰“åŒ…åˆ° MPEG-2 TSï¼ˆTransport Streamï¼‰å®¹å™¨ä¹‹ä¸­ï¼›</li><li>åˆ†å‰²ï¼šæŠŠç·¨ç¢¼å¥½çš„ TS æ–‡ä»¶ç­‰é•·åˆ‡åˆ†æˆ .ts çš„å°æ–‡ä»¶ä¾†å°æ‡‰hlsæ ¼å¼ï¼Œä¸¦ç”Ÿæˆä¸€å€‹ .m3u8 çš„ç´”æ–‡æœ¬ç´¢å¼•æ–‡ä»¶ï¼›</li></ul><p>å·¥ä½œåŸç†åœ–å¦‚ä¸‹ï¼š</p><p><img src="https://i.imgur.com/H8qpsSY.png" alt="Imgur"></p><p>HLS å”è­°æœ¬è³ªé‚„æ˜¯ä¸€å€‹å€‹ HTTP è«‹æ±‚ï¼Œæ‰€ä»¥é©æ‡‰æ€§å¾ˆå¥½ï¼Œä¸æœƒå—åˆ°é˜²ç«å¢™å½±éŸ¿ã€‚ä½†å®ƒä¹Ÿæœ‰ä¸€å€‹è‡´å‘½çš„å¼±é»ï¼šå»¶é²ç¾è±¡éå¸¸æ˜é¡¯ã€‚</p><p>å¦‚æœæ¯å€‹ ts æŒ‰ç…§ 5 ç§’ä¾†åˆ‡åˆ†ï¼Œä¸€å€‹ m3u8 æ”¾ 4 å€‹ .ts ç´¢å¼• ï¼Œé‚£éº½è‡³å°‘å°±ä¼šå¸¶ä¾† 20 ç§’çš„å»¶é²ã€‚å¦‚æœæ¸›å°‘æ¯å€‹ .ts çš„é•·åº¦ï¼Œæ¸›å°‘ m3u8 ä¸­çš„ç´¢å¼•æ•°ï¼Œå»¶é²ç¢ºå¯¦æœƒæ¸›å°‘ï¼Œä½†æœƒå¸¶æ¥æ›´é »ç¹çš„ç·©è¡ï¼Œå°æœå‹™ç«¯çš„è«‹æ±‚å£“åŠ›ä¹Ÿæœƒæˆå€å¢åŠ ã€‚æ‰€ä»¥åªèƒ½æ ¹æ“šå¯¦éš›æƒ…æ³æ‰¾åˆ°ä¸€å€‹æŠ˜è¡·çš„é»ã€‚</p><p>ä»¥åœ–å¥‡ç‚ºä¾‹ï¼šä¸€å€‹.tsçš„æ™‚é•·ç‚º2ç§’ï¼Œä¸€M3U8æª”å…§å«æœ‰8å€‹.tsæª”ï¼Œå»¶é²æ™‚é–“å¤§ç´„å°±æ˜¯16ç§’ã€‚</p>        <h2 id="RTMP"   >          <a href="#RTMP" class="heading-link"><i class="fas fa-link"></i></a><a href="#RTMP" class="headerlink" title="RTMP"></a>RTMP</h2>      <p>Real Time Messaging Protocolï¼ˆç°¡ç¨± RTMPï¼‰æ˜¯ Macromedia é–‹ç™¼çš„ä¸€å¥—è¦–é »ç›´æ’­å”è­°ï¼Œç¾åœ¨å±¬æ–¼ Adobeã€‚é€™å¥—æ–¹æ¡ˆéœ€è¦æ­å»ºå°ˆé–€çš„ RTMP æµåª’é«”æœå‹™å¦‚ Adobe Media Serverï¼Œä¸¦ä¸”åœ¨ç€è¦½å™¨ä¸­åªèƒ½ä½¿ç”¨ Flash å¯¦ç¾æ’­æ”¾å™¨ã€‚å®ƒçš„å¯¦æ™‚æ€§éå¸¸å¥½ï¼Œå»¶é²å¾ˆå°ï¼Œä½†ç„¡æ³•æ”¯æŒç§»å‹•ç«¯ WEB æ’­æ”¾æ˜¯å®ƒçš„ç¡¬å‚·ã€‚ä¸»è¦ç”¨ä¾†åœ¨Flashã€AIRå¹³è‡ºå’Œæ”¯æ´RTMPå”è­°çš„æµåª’é«”/äº’å‹•ä¼ºæœå™¨ä¹‹é–“é€²è¡ŒéŸ³è¨Šå’Œè³‡æ–™é€šè¨Šã€‚å‚³çµ±çš„è»Ÿé«”è·Ÿä¼ºæœå™¨ä¹‹é–“çš„äº’å‹•ï¼Œé‚„æ˜¯ç”¨rtmpå”è­°ç‚ºä¸»ã€‚å‚³è¼¸çš„è¦–è¨Šæ ¼å¼ç‚ºflvï¼Œå³ç‚ºâ€œ.flvâ€å½¢å¼ã€‚</p><p>ç€è¦½å™¨ç«¯ï¼ŒHTML5 videoæ¨™ç±¤ç„¡æ³•æ’­æ”¾ RTMP å”è­°çš„è¦–é »ï¼Œå¯ä»¥é€šé video.js ä¾†å¯¦ç¾ã€‚</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;link href&#x3D;&quot;http:&#x2F;&#x2F;vjs.zencdn.net&#x2F;5.8.8&#x2F;video-js.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line"> </span><br><span class="line">&lt;video id&#x3D;&quot;example_video_1&quot; class&#x3D;&quot;video-js vjs-default-skin&quot; controls preload&#x3D;&quot;auto&quot; width&#x3D;&quot;640&quot; height&#x3D;&quot;264&quot; loop&#x3D;&quot;loop&quot; webkit-playsinline&gt;</span><br><span class="line">&lt;source src&#x3D;&quot;rtmp:&#x2F;&#x2F;10.14.221.17:1935&#x2F;rtmplive&#x2F;home&quot; type&#x3D;&#39;rtmp&#x2F;flv&#39;&gt;</span><br><span class="line">&lt;&#x2F;video&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;vjs.zencdn.net&#x2F;5.8.8&#x2F;video.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">videojs.options.flash.swf &#x3D; &#39;video.swf&#39;;</span><br><span class="line">videojs(&#39;example_video_1&#39;).ready(function() &#123;</span><br><span class="line">this.play();</span><br><span class="line">&#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></div></figure><link href="http://vjs.zencdn.net/5.8.8/video-js.css" rel="stylesheet"> <video id="example_video_1" class="video-js vjs-default-skin" controls preload="auto" width="640" height="264" loop="loop" webkit-playsinline><source src="rtmp://10.14.221.17:1935/rtmplive/home" type='rtmp/flv'></video> <script src="http://vjs.zencdn.net/5.8.8/video.js"></script><script>videojs.options.flash.swf = 'video.swf';videojs('example_video_1').ready(function() {this.play();});</script>        <h2 id="HLS-V-S-RTMP"   >          <a href="#HLS-V-S-RTMP" class="heading-link"><i class="fas fa-link"></i></a><a href="#HLS-V-S-RTMP" class="headerlink" title="HLS V.S. RTMP"></a>HLS V.S. RTMP</h2>      <p><img src="https://i.imgur.com/157KKNb.png" alt="Imgur"></p>        <h2 id="HTTP-FLV"   >          <a href="#HTTP-FLV" class="heading-link"><i class="fas fa-link"></i></a><a href="#HTTP-FLV" class="headerlink" title="HTTP-FLV"></a>HTTP-FLV</h2>      <p>HTTP-FLVå¯ç†è§£ç‚ºRTMPçš„å‡ç´šç‰ˆæœ¬ï¼Œå‚³è¼¸çš„è¦–è¨Šæ ¼å¼åŒrtmpä¸€æ¨£ç‚ºflvæ ¼å¼ã€‚</p><p>HTTP-FLVçµåˆäº†HLSçš„å„ªé»ï¼Œæ¡ç”¨HTTPè«‹æ±‚ï¼Œåˆçµåˆäº†RTMPä½å»¶æ™‚çš„ç‰¹æ€§ï¼Œå› ç‚ºä¸­é–“å»ºç«‹äº†FLVçš„é•·é€£ç·šï¼Œä¸­é–“é€šè¨Šéç¨‹ç›¸å°RTMPå”è­°å°±ä¸å†è¤‡é›œã€‚ç›¸å°RTMPå”è­°ä¾†èªªï¼Œå…¶å„ªé»å¯ç¸½çµç‚ºï¼š</p><ol><li><p>å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…é˜²ç«ç‰†çš„å¹²æ“¾ï¼ˆä¾‹å¦‚ï¼Œæœ‰çš„æ©Ÿæˆ¿åªå…è¨±80åŸ é€šéï¼‰</p></li><li><p>å¯ä»¥å¾ˆå¥½çš„ç›¸å®¹HTTP302è·³è½‰ï¼Œåšåˆ°éˆæ´»æ’ç¨‹</p></li><li><p>å¯ä»¥ä½¿ç”¨HTTPSåšåŠ å¯†é€šé“</p></li><li><p>å¾ˆå¥½çš„æ”¯æ´ç§»å‹•ç«¯</p></li></ol>        <h1 id="M3U8ä»‹ç´¹"   >          <a href="#M3U8ä»‹ç´¹" class="heading-link"><i class="fas fa-link"></i></a><a href="#M3U8ä»‹ç´¹" class="headerlink" title="M3U8ä»‹ç´¹"></a>M3U8ä»‹ç´¹</h1>      <p>ä»¥hlså”è­°ä¾†èªªï¼Œå®ƒæœƒé¦–å…ˆç™¼æ”¾ä¸€å€‹m3u8ç´¢å¼•æª”æ¡ˆï¼Œvideoåœ¨ä¸€èˆ¬ç€è¦½å™¨ä¸­ä¸æ”¯æ´m3u8æª”æ¡ˆçš„è­˜åˆ¥ï¼Œsafariä¸­å¯ä»¥ã€‚videoæ‹¿åˆ°m3u8æª”æ¡ˆï¼Œå®ƒæœƒå°å…¶é€²è¡Œè§£æï¼Œè§£æçš„å…§å®¹å°±ç‚ºåœ–ä¸­æ‰€ç¤ºçš„m3u8ä¸­çš„segment.tsæª”æ¡ˆï¼Œæ¯ä¸€å€‹ç‰‡æ®µå³ç‚ºç›´æ’­æµçš„åˆ†æ®µã€‚</p><p><img src="https://i.imgur.com/H8qpsSY.png" alt="Imgur"></p><p>ç›´æ’­æ˜¯å¯¦æ™‚çš„ï¼Œæ‰€ä»¥m3u8æª”æ¡ˆè‚¯å®šä¸æœƒæ˜¯å›ºå®šçš„ï¼Œçµ¦çš„m3u8æª”æ¡ˆåªæ˜¯ç•¶å‰æ™‚é–“æ®µçš„ç´¢å¼•ï¼Œsegment.tséƒ½æœƒæœ‰å€‹æ™‚é•·ï¼Œåœ¨segmentç¸½æ™‚é•·ä¹‹å‰ï¼Œvideoæœƒé‡æ–°å‘ä¼ºæœå™¨è«‹æ±‚m3u8æª”æ¡ˆï¼Œé€™æ˜¯ç€è¦½å™¨è‡ªèº«çš„è¡Œç‚ºï¼Œæ­¤æ™‚ï¼Œä¼ºæœå™¨æœƒè¿”å›æ–°çš„m3u8æª”æ¡ˆï¼Œæ›´æ–°å¾Œçš„segment.tsæª”æ¡ˆå°‡æœƒæ”¹è®Šï¼Œå¯èƒ½æ˜¯2345æˆ–è€…34567ç­‰ç­‰ã€‚</p><p><img src="https://i.imgur.com/1gML9lL.png" alt="Imgur"></p><p>å¦å¤–ï¼Œm3u8æª”æ¡ˆçµæ§‹ä¸¦ä¸ä¸€å®šå…¨æ˜¯ç”±tsæª”æ¡ˆçµ„æˆï¼Œæœ‰å¯èƒ½æœƒå·¢ç‹€ä¸€å±¤m3u8æª”æ¡ˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://i.imgur.com/Y88cGhA.png" alt="Imgur"></p><p>å¦‚æœm3u8æª”æ¡ˆä¸­åŒ…å«m3u8æª”æ¡ˆï¼Œå°±å°æ‡‰çš„æ˜¯master playlistï¼Œå¦‚æœæ‹¿åˆ°çš„m3u8æª”æ¡ˆè£¡åªåŒ…å«tsæª”æ¡ˆï¼Œé‚£å°±å°æ‡‰çš„æ˜¯media playlistsã€‚</p><p>ä¸€å€‹å…¸å‹çš„ master playlist æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#EXTM3U</span><br><span class="line">#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=200000</span><br><span class="line">gear1/prog_index.m3u8</span><br><span class="line">#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=311111</span><br><span class="line">gear2/prog_index.m3u8</span><br><span class="line">#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=484444</span><br><span class="line">gear3/prog_index.m3u8</span><br><span class="line">#EXT-X-STREAM-INF:PROGRAM-ID=1, BANDWIDTH=737777</span><br><span class="line">gear4/prog_index.m3u8</span><br></pre></td></tr></table></div></figure><p>media playlistsï¼š</p><figure class="highlight xml"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ï¼ƒEXTM3U</span><br><span class="line">ï¼ƒEXT-X-VERSIONï¼š3</span><br><span class="line">ï¼ƒEXT-X-MEDIA-SEQUENCEï¼š30508</span><br><span class="line">ï¼ƒEXT-X-TARGETDURATIONï¼š5 </span><br><span class="line">#EXTINFï¼š4.972ï¼Œ</span><br><span class="line">https://6.mms.vlog.xuite.net/hls/ftvtv/30508.ts </span><br><span class="line">#EXTINFï¼š4.437ï¼Œ</span><br><span class="line">httpsï¼š//6.mms .vlog.xuite.net / hls / ftvtv / 30509.ts </span><br><span class="line">#EXTINFï¼š4.306ï¼Œ</span><br><span class="line">https://6.mms.vlog.xuite.net/hls/ftvtv/30510.ts</span><br></pre></td></tr></table></div></figure><hr>        <h1 id="å¯¦ä½œ"   >          <a href="#å¯¦ä½œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#å¯¦ä½œ" class="headerlink" title="å¯¦ä½œ"></a>å¯¦ä½œ</h1>              <h2 id="M3U8è§£æ"   >          <a href="#M3U8è§£æ" class="heading-link"><i class="fas fa-link"></i></a><a href="#M3U8è§£æ" class="headerlink" title="M3U8è§£æ"></a>M3U8è§£æ</h2>      <p>æ‰€æ¥æ”¶çš„æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#EXTM3U</span><br><span class="line">#EXT-X-TWITCH-INFO:NODE=<span class="string">&quot;video-edge-d59628...(ä»¥ä¸‹çœç•¥)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID=&quot;</span>chunked<span class="string">&quot;,NAME=&quot;</span>1080p60 (source)<span class="string">&quot;,AUTOSELECT=YES,DEFAULT=YES</span></span><br><span class="line"><span class="string">#EXT-X-STREAM-INF:BANDWIDTH=9007387,RESOLUTION=1920x1080,CODECS=&quot;</span>avc1.64002A,mp4a<span class="number">.40</span><span class="number">.2</span><span class="string">&quot;,VIDEO=&quot;</span>chunked<span class="string">&quot;</span></span><br><span class="line"><span class="string">https://video-...g0fYI.m3u8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID=&quot;</span>720p60<span class="string">&quot;,NAME=&quot;</span>720p60<span class="string">&quot;,AUTOSELECT=YES,DEFAULT=YES</span></span><br><span class="line"><span class="string">#EXT-X-STREAM-INF:BANDWIDTH=3425658,RESOLUTION=1280x720,CODECS=&quot;</span>avc1.4D401F,mp4a<span class="number">.40</span><span class="number">.2</span><span class="string">&quot;,VIDEO=&quot;</span>720p60<span class="string">&quot;</span></span><br><span class="line"><span class="string">https://video-...UVodQ.m3u8</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID=&quot;</span>720p30<span class="string">&quot;,NAME=&quot;</span>720p<span class="string">&quot;,AUTOSELECT=YES,DEFAULT=YES</span></span><br><span class="line"><span class="string">#EXT-X-STREAM-INF:BANDWIDTH=2375658,RESOLUTION=1280x720,CODECS=&quot;</span>avc1.4D401F,mp4a<span class="number">.40</span><span class="number">.2</span><span class="string">&quot;,VIDEO=&quot;</span>720p30<span class="string">&quot;</span></span><br><span class="line"><span class="string">https://video-...bTobg.m3u8</span></span><br></pre></td></tr></table></div></figure><p>æ±‚å–æ¯å€‹ç•«è³ªçš„M3U8æª”ä»¥åŠæ‰€å°æ‡‰çš„ç•«è³ªåç¨±ã€fpsï¼ˆç¦æ•¸ï¼‰</p><ul><li>1080p 60fps <span class="exturl"><a class="exturl__link"   href="https://video-...g0fyi.m3u8/" >https://video-...g0fYI.m3u8</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>720p  60fps <span class="exturl"><a class="exturl__link"   href="https://video-...uvodq.m3u8/" >https://video-...UVodQ.m3u8</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li>720p  30fps <span class="exturl"><a class="exturl__link"   href="https://video-...btobg.m3u8/" >https://video-...bTobg.m3u8</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ul><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bufferedReader = BufferedReader(InputStreamReader(URL(path).openStream()))</span><br><span class="line">                        </span><br><span class="line"><span class="keyword">while</span> (bufferedReader.readLine().also &#123; eachLine = it &#125; != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (eachLine!!.contains(<span class="string">&quot;EXT&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (eachLine!!.contains(<span class="string">&quot;NAME&quot;</span>)) &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="comment">//å°‡MEDIA-INFOä»¥ , å€éš”æˆä¸€é™£åˆ—</span></span><br><span class="line">            <span class="keyword">val</span> tempLines =eachLine!!.split(<span class="string">&quot;,&quot;</span>).toTypedArray() </span><br><span class="line">            <span class="keyword">for</span> (tempLine <span class="keyword">in</span> tempLines) &#123;</span><br><span class="line">                <span class="comment">//æ‰¾åˆ°NAME=&quot;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> (tempLine.contains(<span class="string">&quot;NAME&quot;</span>)) &#123;  </span><br><span class="line">                </span><br><span class="line">                    <span class="comment">//æå–NAME=&quot;&quot;ä¸­çš„è³‡æ–™</span></span><br><span class="line">                    <span class="keyword">val</span> regexCode = Regex(pattern = <span class="string">&quot;\&quot;(.*?)\&quot;&quot;</span>).find(input = tempLine)?.value  </span><br><span class="line">                    <span class="comment">//å»æ‰â€œâ€</span></span><br><span class="line">                    <span class="keyword">val</span> result = regexCode?.let &#123; Regex(<span class="string">&quot;\&quot;&quot;</span>).replace(it, <span class="string">&quot;&quot;</span>) &#125;     </span><br><span class="line">                    <span class="comment">//720p30 ä»¥pä¾†å€åˆ†ç•«è³ªåŠç¦æ•¸</span></span><br><span class="line">                    <span class="keyword">val</span> tempRESOLUTIONs = result!!.split(<span class="string">&quot;p&quot;</span>).toTypedArray()       </span><br><span class="line">                    qualityNames.add(tempRESOLUTIONs[<span class="number">0</span>] + <span class="string">&quot;p&quot;</span>)            </span><br><span class="line">                    qualityFps.add(tempRESOLUTIONs[<span class="number">1</span>])</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//éEXTé–‹é ­â¡ï¸ç¶²å€https</span></span><br><span class="line">        qualityUrls.add(eachLine!!)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bufferedReader.close()</span><br></pre></td></tr></table></div></figure><p>å°æ–¼M3U8çš„è§£æï¼Œé€™å€‹è§£æ³•æ˜¯åƒç…§å‰äººæ‰€ç•™ä¸‹çš„codeï¼Œå°‡è³‡æ–™åˆ†æˆä¸‰å€‹é™£åˆ—ã€‚</p><p>åˆ†åˆ¥ç‚ºqualityNamesç•«è³ªåç¨±ã€qualityFpsç•«è³ªç¦æ•¸ã€qualityUrlsç•«è³ªç¶²å€ï¼Œä»¥æŒ‰ç…§é †åºçš„æ–¹å¼é€æ­¥å­˜å–ã€‚åˆ©ç”¨ç›¸åŒä½ç½®çš„ç‰¹æ€§å»ç›¸äº’å°ç…§ä»¥å–å¾—è³‡æ–™ã€‚</p><figure class="highlight q"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qualityNamesï¼š<span class="number">1080</span>pã€<span class="number">720</span>pã€<span class="number">720</span>p</span><br><span class="line">qualityFpsï¼š<span class="number">60</span>ã€<span class="number">60</span>ã€<span class="number">30</span></span><br><span class="line">qualityUrlsï¼šhttps:<span class="comment">//video-...g0fYI.m3u8ã€https://video-...UVodQ.m3u8ã€https://video-...bTobg.m3u8</span></span><br></pre></td></tr></table></div></figure>        <h2 id="ä¸‹ä¸€æ­¥ç›®æ¨™"   >          <a href="#ä¸‹ä¸€æ­¥ç›®æ¨™" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä¸‹ä¸€æ­¥ç›®æ¨™" class="headerlink" title="ä¸‹ä¸€æ­¥ç›®æ¨™"></a>ä¸‹ä¸€æ­¥ç›®æ¨™</h2>      <p>å°‡M3U8è§£ææµç¨‹å¦å¤–æ‹‰å‡ºä¸€é¡åˆ¥é€²è¡Œé‹ç®—ï¼Œå†è¿”å›ä¸€è³‡æ–™é¡åˆ¥Quality</p><figure class="highlight q"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data class Quality(</span><br><span class="line">    val name: String,</span><br><span class="line">    val fps: String,</span><br><span class="line">    val url: String,</span><br><span class="line">)</span><br></pre></td></tr></table></div></figure><p>ç›®çš„æ˜¯ç‚ºäº†åˆ†å·¥åˆä½œæ¸›å°‘æ´»å‹•é é‹ç®—è² æ“”ï¼Œä»¥åŠè³‡æ–™æå–ä¾¿åˆ©æ€§ã€‚</p>        <h2 id="å›é¥‹"   >          <a href="#å›é¥‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#å›é¥‹" class="headerlink" title="å›é¥‹"></a>å›é¥‹</h2>      <ol><li>M3U8æ‡‰æœ‰parserå¯ä»¥ä½¿ç”¨</li><li>æ•¸æ“šé¡Qualityæ‡‰æ›´åç‚ºSource</li><li>MP4èˆ‡M3U8çš„å·®åˆ¥ä»¥åŠM3U8è¢«å»£æ³›ä½¿ç”¨çš„åŸå› </li><li>Network Profileræª¢æŸ¥ç¶²çµ¡æµé‡ï¼š<span class="exturl"><a class="exturl__link"   href="https://developer.android.com/studio/profile/network-profiler" >https://developer.android.com/studio/profile/network-profiler</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>        <h6 id="tags-æŠ€è¡“åˆ†äº«-ç›´æ’­ä¸²æµ-Video-M3U8"   >          <a href="#tags-æŠ€è¡“åˆ†äº«-ç›´æ’­ä¸²æµ-Video-M3U8" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æŠ€è¡“åˆ†äº«-ç›´æ’­ä¸²æµ-Video-M3U8" class="headerlink" title="tags: æŠ€è¡“åˆ†äº« ç›´æ’­ä¸²æµ Video M3U8"></a>tags: <code>æŠ€è¡“åˆ†äº«</code> <code>ç›´æ’­ä¸²æµ</code> <code>Video</code> <code>M3U8</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ChromecaståŸç†</title>
      <link href="/tutu1023/2021/04/29/Chromecast/"/>
      <url>/tutu1023/2021/04/29/Chromecast/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2021/04/07<br>  Byï¼šAda</p><p>è³‡æ–™ä¾†æºï¼š</p><ul><li><span class="exturl"><a class="exturl__link"   href="https://medium.com/@givemepass/chromecast-%E5%9F%BA%E7%A4%8E%E6%95%99%E5%AD%B8-c1dc0be94af2" >Chromecast åŸºç¤æ•™å­¸</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>   </li><li><span class="exturl"><a class="exturl__link"   href="http://cappella-twilightzone.blogspot.com/2018/06/google-cast.html" >Google Cast å¤§è‡´å·¥ä½œåŸç†</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>    </li><li><span class="exturl"><a class="exturl__link"   href="https://www.pigo.idv.tw/archives/2487" >è«‡è«‡ GoogleCast (ChromeCast)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://medium.com/@quentin7b/make-your-android-app-compatible-with-your-chromecast-ca751294c4e2" >Make your Android app compatible with your Chromecast</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ul><p>ç›®éŒ„ï¼š</p><p>[TOC]</p><hr>        <h2 id="ChromeCastæ·ºè«‡"   >          <a href="#ChromeCastæ·ºè«‡" class="heading-link"><i class="fas fa-link"></i></a><a href="#ChromeCastæ·ºè«‡" class="headerlink" title="ChromeCastæ·ºè«‡"></a>ChromeCastæ·ºè«‡</h2>      <p>Chromecast çš„é‹ä½œåŸç†èˆ‡ Miracast é€™ç¨®é¡åƒç•«é¢ä¸å¤ªä¸€æ¨£ï¼Œå®ƒæ˜¯é€éä¸‹æŒ‡ä»¤çš„æ–¹å¼ã€ŒæŠ•æ”¾ã€å½±éŸ³å…§å®¹åˆ°ä½ çš„é›»è¦–å¤§è¢å¹•ä¸Šï¼Œè®“ Chromecast è‡ªè¡Œé€éç¶²è·¯å»ä¸²æµå½±éŸ³ï¼Œä¸‹å®ŒæŒ‡ä»¤å¾Œï¼Œä½ çš„è¡Œå‹•è£ç½®åŠé›»è…¦ä¾¿å¯ä»¥è‡ªç”±é›¢é–‹å»åšåˆ¥çš„å·¥ä½œã€‚</p><p><img src="https://i.imgur.com/w7x45q5.jpg" alt="Imgur"></p>        <h2 id="Sender-App-amp-Receiver-App"   >          <a href="#Sender-App-amp-Receiver-App" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sender-App-amp-Receiver-App" class="headerlink" title="Sender App &amp; Receiver App"></a>Sender App &amp; Receiver App</h2>              <h3 id="Sender-App"   >          <a href="#Sender-App" class="heading-link"><i class="fas fa-link"></i></a><a href="#Sender-App" class="headerlink" title="Sender App"></a>Sender App</h3>      <p>ç™¼é€ç«¯ appï¼ˆsender appï¼‰ä½¿ç”¨ SDKï¼Œå°‡éœ€è¦æ’­æ”¾çš„åª’é«”çš„ä¿¡æ¯ç™¼é€åˆ° Google çš„æœå‹™å™¨ï¼Œæœå‹™å™¨å†é€šçŸ¥æ¥æ”¶ç«¯æ’­æ”¾ï¼ˆæ‰€ä»¥ç™¼é€ç«¯å’Œæ¥æ”¶ç«¯å¿…é ˆéƒ½å¯ä»¥è¨ªå• Google çš„æœå‹™å™¨æ‰è¡Œï¼‰ã€‚ </p>        <h3 id="Receiver-App"   >          <a href="#Receiver-App" class="heading-link"><i class="fas fa-link"></i></a><a href="#Receiver-App" class="headerlink" title="Receiver App"></a>Receiver App</h3>      <p>æ¥æ”¶ç«¯é‹è¡Œçš„æ˜¯ä¸€å€‹ç€è¦½å™¨ï¼Œå®ƒæœƒæ ¹æ“šç™¼é€ç«¯çš„app IDå’Œåª’é«”ä¿¡æ¯ï¼Œå»è¼‰å…¥å°æ‡‰çš„ä¸€å€‹ç¶²é ï¼Œé€™å€‹ç¶²é ï¼ˆreceiver appï¼‰ä¹Ÿæ˜¯ç”±ç™¼é€ç«¯ app çš„é–‹ç™¼è€…æä¾›çš„ï¼Œçš„å°‡æœƒè² è²¬æ’­æ”¾ç›¸æ‡‰çš„åª’é«”å…§å®¹ã€‚å³ä½¿æ¥æ”¶ç«¯æ˜¯ Chromecast Audio ä¹‹é¡åªèƒ½æ’­æ”¾éŸ³é »çš„ç¡¬ä»¶ï¼Œé€™å€‹ç¶²é ä¹Ÿæ˜¯æœƒè¼‰å…¥ä¸¦æ¸²æŸ“çš„ã€‚</p><p><img src="https://i.imgur.com/RdK4lLb.png" alt="Imgur"></p><p>ä»¥ Youtube æˆ– Google Music é€™å…©å€‹ App ç‚ºä¾‹å­ï¼Œæ‰‹æ©Ÿä¸Šæ‰€çœ‹åˆ°çš„é€™å…©å€‹ Appï¼Œè¢«å®šç¾©ç‚º Sender Appï¼Œè€Œå«æœ‰Chromecastçš„å¤§å‹é¡¯ç¤ºè£ç½®ç®—æ˜¯ Receiverã€‚</p><p>Receiver App ä¸¦ä¸æ˜¯åŸ·è¡Œåœ¨ Android æ¡†æ¶ä¸Šçš„æ‡‰ç”¨ç¨‹å¼ï¼Œè€Œæ˜¯åŸ·è¡Œåœ¨ Chrome ä¸Šçš„ Web Applicationï¼Œå¿…é ˆä½¿ç”¨ HTML + JavaScript é–‹ç™¼ï¼ŒYoutube æœ‰ Youtube Receiver Appï¼ŒGoogle Music æœ‰ Google Music Receiver Appï¼Œåœ¨ Recever è£ç½®ä¸Šæ”¶åˆ° Sender ç«¯è¦æ±‚è¦å•Ÿå‹•(Launch)æŸå€‹ Reciver App æ™‚ï¼Œå°±æœƒé€éç¶²è·¯è¼‰å…¥å°æ‡‰çš„ HTML5 Webã€‚</p><p>æ‰€ä»¥åœ¨é›»è¦–ä¸Šæœƒçœ‹åˆ°ï¼Œå„ç¨®ä¸åŒçš„ GoogleCast æ‡‰ç”¨æœ‰ä¸åŒçš„å±•ç¤ºé¢¨æ ¼èˆ‡ä½ˆå±€ï¼Œä¸”é€™äº›ç•«é¢å£“æ ¹å’Œä½ æ‰‹æ©Ÿæˆ–å¹³æ¿ä¸Šçœ‹åˆ°çš„å®Œå…¨ä¸åŒï¼Œä¹Ÿä¸æ˜¯ç”±æ‰‹æ©Ÿæ‰€æä¾›çš„ã€‚</p><p>ä»¥ Youtube ä¾†èªªSender ç«¯å¯èƒ½åªè² è²¬å°‡è¦æ’­æ”¾çš„å½±ç‰‡ä»£ç¢¼å‚³éçµ¦ Youtube Receiver Appï¼Œç„¶å¾Œ Youtube  Receiver  App å‰‡é€éç¶²è·¯ä¸‹è¼‰ Youtube å½±ç‰‡ä¾†æ’­æ”¾ï¼Œå› æ­¤é »å¯¬å®Œå…¨æ˜¯ Receiver åœ¨åƒçš„ï¼Œç›¸å°çš„æ‰‹æŒè¨­å‚™ç«¯å°±çœé›»ï¼Œä¹Ÿå¯ä»¥å»åšè‡ªå·±çš„äº‹æƒ…ï¼Œå› ç‚º Sender ç«¯ä¸è² è²¬ä¸‹è¼‰å½±ç‰‡æˆ–æ’­æ”¾ã€‚</p><p>åœ¨é–‹ç™¼æ’°å¯« Receiver App ä¹‹å‰ï¼Œé¢è‡¨åˆ°çš„ç¬¬ä¸€å€‹å•é¡Œæ˜¯è©•ä¼°è©²é¸æ“‡å“ªä¸€ç¨® Receiver App çš„é¡å‹ï¼Œæ–‡ä»¶ä¸Šåˆ—å‡º 3 ç¨®ã€‚</p><ol><li>Default Media Receiver</li><li>Styled Media Receiver</li><li>Custom Receiver</li></ol><p>ç¬¬ä¸€ç¨®èˆ‡ç¬¬äºŒç¨®åœ¨è¡Œç‚ºä¸Šæ˜¯ä¸€æ¨¡ä¸€æ¨£çš„ï¼Œåªæ˜¯ Styled Media Receiver æ¯” Default å¤šäº†å®¢åˆ¶ Backgroundã€Logoã€Splashã€Watermark ç­‰é¸é …ï¼Œé€™äº›å…§å®¹å¿…é ˆä½¿ç”¨ä¸€å€‹ css æª”æ¡ˆä¾†ç®¡ç†ï¼Œä¸¦ä¸”ç”³è«‹ä¸€å€‹ Receiver Application Id å¾Œï¼Œå°‡é€™å€‹ css æª”æ¡ˆçš„é€£çµæä¾›çµ¦ Google èˆ‡é€™å€‹ Application Id ç›¸å°æ‡‰ï¼ŒChromecast å³å¯åœ¨ Sender é€£ä¸Šä¸¦å‚³é€ Application Id å¾Œï¼ŒçŸ¥é“è©²é–‹å•Ÿå“ªä¸€ç¨® App èˆ‡è¼‰å…¥å“ªä¸€å€‹ css æª”æ¡ˆï¼Œç¬¬ä¸‰ç¨® Custom Receiver æŒ‡çš„æ˜¯è‡ªå·±è£½ä½œ Web App æ‰€ä»¥å®¢è£½ç¨‹åº¦æ˜¯æ²’æœ‰é™åˆ¶çš„ï¼Œæ¯”è¼ƒéœ€è¦æ³¨æ„çš„æ˜¯ç¬¬äºŒç¨®ã€ç¬¬ä¸‰ç¨®æ‰€è¦æä¾›çš„ css èˆ‡ web URL å¿…é ˆæ˜¯ https çš„é€£çµã€‚</p><p><img src="https://i.imgur.com/PFD0Elk.jpg" alt="Imgur"></p><p>Receiver App é›–ç„¶ä¸ç”¨ä¸Šæ¶ï¼Œä½†å»æœ‰ä¸€å€‹è¨»å†Šçš„æµç¨‹ï¼Œå‰›æ‰èªªéï¼ŒSender é€£æ¥ä¸Š Receiver æ™‚å¿…é ˆå‚³é€ä¸€å€‹ Application Id å‘ŠçŸ¥ Chromecast é–‹å•Ÿå“ªä¸€å€‹æ‡‰ç”¨ç¨‹å¼ï¼Œç¬¬äºŒã€ä¸‰ç¨® Receiver App å¿…é ˆç”±é–‹ç™¼è€…è‡ªå·±ç”³è«‹åŠè¨»å†Š Application Idï¼Œç”³è«‹æ™‚æ¯å€‹é–‹ç™¼è€…å¸³è™Ÿéœ€ä»˜ç¾é‡‘ 5 å…ƒï¼Œä¸€å€‹å¸³è™Ÿåº•ä¸‹å¯ä»¥å»ºç«‹æ•¸å€‹æ‡‰ç”¨ç¨‹å¼ï¼Œç•¶ç„¶ä¸€å€‹ Receiver App å°æ‡‰å¤šå€‹ Sender App ä¹Ÿæ˜¯å¯ä»¥è¾¦å¾—åˆ°çš„ã€‚ç¬¬ä¸€ç¨® Default Media Receiver å› ç‚ºä¸éœ€è¦é–‹å•Ÿä»»ä½•å®¢åˆ¶çš„é …ç›®ï¼Œæ‰€ä»¥ä¸å¿…ç”³è«‹ Application Idï¼Œä½† Sender ä»éœ€é€ä¸€å€‹ Application Id çµ¦ Chromecastï¼Œé€™æ˜¯ä¸€å€‹å›ºå®šçš„å€¼ï¼Œå¸¸æ•¸åç¨±ç‚º DEFAULT_MEDIA_RECEIVER_APPLICATION_ID</p><hr>        <h2 id="Senderå»ºæ§‹åŠä¸²æ¥æµç¨‹"   >          <a href="#Senderå»ºæ§‹åŠä¸²æ¥æµç¨‹" class="heading-link"><i class="fas fa-link"></i></a><a href="#Senderå»ºæ§‹åŠä¸²æ¥æµç¨‹" class="headerlink" title="Senderå»ºæ§‹åŠä¸²æ¥æµç¨‹"></a>Senderå»ºæ§‹åŠä¸²æ¥æµç¨‹</h2>      <p>åœ¨å»ºç½®ChromecastæŒ‰éˆ•æ™‚ï¼Œå°‡ç‰©ä»¶æŒ‡å‘MediaRouteActionProviderï¼ŒåŒæ™‚Chromecastçš„SDKæœƒå»å°‹æ‰¾æˆ‘å€‘æä¾›çš„Option Provider Classï¼Œä»¥åŠè©²Classåˆ©ç”¨Receiver Application Idå»ºæ§‹å‡ºä¾†çš„CastOptionsï¼Œä»¥åˆ©Chromecasté€²è¡Œä¸‹ä¸€æ­¥çš„å°è©±ã€‚</p><p>ç•¶ChromecastæŒ‰éˆ•è¢«é»æ“Šæ™‚ï¼Œé¦–å…ˆæœƒè·³å‡ºé™„è¿‘è¨­å‚™çš„é¸å–®ã€‚å¾…ä½¿ç”¨è€…é¸æ“‡å¾Œï¼Œç™¼é€ç«¯ï¼ˆæ‰‹æŒè¨­å‚™ï¼‰æœƒç™¼é€è«‹æ±‚çµ¦æ¥æ”¶ç«¯ï¼ˆå¤§å‹é¡¯ç¤ºå™¨ï¼‰ï¼Œä¸¦ä¸”å•Ÿç”¨SessionManagerListenerä¾†ç›£è½è©²å°è©±ã€‚</p><p>ç¢ºå®šå°è©±é€£æ¥æˆåŠŸä¸¦é–‹å§‹å¾Œï¼ˆonSessionStartedï¼‰ï¼Œæœƒå°‡å½±ç‰‡è³‡è¨Šæ‰“åŒ…æˆMediaInfoçš„æ ¼å¼ï¼Œå‚³é€çµ¦ç•¶å‰çš„CastSessionã€‚å¯ç”±Callbacksç¢ºèªå½±ç‰‡æ’­æ”¾å¤±æ•—èˆ‡å¦ã€‚</p><p><img src="https://i.imgur.com/xC1PM91.png" alt="Imgur"></p>        <h3 id="å»ºç½®æŒ‰éˆ•"   >          <a href="#å»ºç½®æŒ‰éˆ•" class="heading-link"><i class="fas fa-link"></i></a><a href="#å»ºç½®æŒ‰éˆ•" class="headerlink" title="å»ºç½®æŒ‰éˆ•"></a>å»ºç½®æŒ‰éˆ•</h3>      <p>å»ºç½®ChromecastæŒ‰éˆ•ä¸¦å°‡ç‰©ä»¶æŒ‡å‘MediaRouteActionProvider</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;menu&gt;</span><br><span class="line">    &lt;item</span><br><span class="line">        android:id=<span class="string">&quot;@+id/media_route_menu_item&quot;</span></span><br><span class="line">        app:actionProviderClass=<span class="string">&quot;androidx.mediarouter.app.MediaRouteActionProvider&quot;</span></span><br><span class="line">        app:showAsAction=<span class="string">&quot;always&quot;</span> android:title=<span class="string">&quot;&quot;</span>/&gt;</span><br><span class="line">&lt;/menu&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="æä¾›Option-Provider-Classçµ¦SDK"   >          <a href="#æä¾›Option-Provider-Classçµ¦SDK" class="heading-link"><i class="fas fa-link"></i></a><a href="#æä¾›Option-Provider-Classçµ¦SDK" class="headerlink" title="æä¾›Option Provider Classçµ¦SDK"></a>æä¾›Option Provider Classçµ¦SDK</h3>      <p>å°‡Option Provider Classç”¨meta-dataçš„æ–¹å¼æä¾›çµ¦Chromecast SDK</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;meta-<span class="keyword">data</span>   <span class="comment">//çµ¦ç¬¬ä¸‰æ–¹SDKçš„è³‡æ–™</span></span><br><span class="line">        android:name=<span class="string">&quot;com.google.android.gms.cast.framework.OPTIONS_PROVIDER_CLASS_NAME&quot;</span></span><br><span class="line">        android:value=<span class="string">&quot;com.example.app.CastOptionsProvider&quot;</span> /&gt;  <span class="comment">//&lt;---è¨˜å¾—æ›´æ”¹</span></span><br><span class="line">&lt;/application&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="CastOptions-Builder"   >          <a href="#CastOptions-Builder" class="heading-link"><i class="fas fa-link"></i></a><a href="#CastOptions-Builder" class="headerlink" title="CastOptions.Builder()"></a>CastOptions.Builder()</h3>      <p>Chromecast SDKåˆ©ç”¨Option Provider Classä¸­çš„å…§å®¹ï¼ˆåŒ…å«æ‰€æä¾›çš„Receiver Application Idï¼‰ï¼Œç‚ºChromecastæŒ‰éˆ•Buildä¸€å€‹CastOptionsçš„å¯¦ä¾‹ã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">CastOptionsProvider</span> : <span class="type">OptionsProvider &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCastOptions</span><span class="params">(context: <span class="type">Context</span>)</span></span>: CastOptions &#123;</span><br><span class="line">        <span class="keyword">return</span> CastOptions.Builder()</span><br><span class="line">            .setReceiverApplicationId(DEFAULT_MEDIA_RECEIVER_APPLICATION_ID)</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getAdditionalSessionProviders</span><span class="params">(context: <span class="type">Context</span>)</span></span>: List&lt;SessionProvider&gt;? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="Session-Started"   >          <a href="#Session-Started" class="heading-link"><i class="fas fa-link"></i></a><a href="#Session-Started" class="headerlink" title="Session Started"></a>Session Started</h3>      <p>å°è©±ç¢ºå®šé€£æ¥å¾Œï¼Œå°‡CastSessionæ‰€éœ€è¦çš„MediaInfoåŒ…è£ä¸¦é€å‡ºè®“Receiver Applicationå»ä½œloadingçš„å‹•ä½œã€‚</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionStarted</span><span class="params">(castSession: <span class="type">CastSession</span>, s:<span class="type">String</span> )</span></span> &#123;</span><br><span class="line">    mRemoteData?.let &#123;   <span class="comment">//è¨­ç½®è©³ç´°è³‡æ–™</span></span><br><span class="line">        <span class="keyword">val</span> movieMetadata = MediaMetadata(MediaMetadata.MEDIA_TYPE_MOVIE).apply &#123;</span><br><span class="line">            putString(MediaMetadata.KEY_SUBTITLE, it.videoName)</span><br><span class="line">            putString(MediaMetadata.KEY_TITLE, it.videoTitle)</span><br><span class="line">            addImage(WebImage(Uri.parse(it.videoPicture)))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> mediaInfo = MediaInfo.Builder(it.videoUrl)  <span class="comment">//è¨­ç½®å½±éŸ³è³‡è¨Š</span></span><br><span class="line">            .setStreamType(MediaInfo.STREAM_TYPE_BUFFERED)</span><br><span class="line">            .setContentType(<span class="string">&quot;videos/mp4&quot;</span>)</span><br><span class="line">            .setMetadata(movieMetadata)</span><br><span class="line">            .build()</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é–‹å§‹è¨­å®šé ç«¯æŠ•å±ä»¥åŠç‹€æ…‹ç›£è½</span></span><br><span class="line">        castSession.remoteMediaClient.apply &#123;</span><br><span class="line">            load(mediaInfo, <span class="literal">true</span>, <span class="number">0</span>).setResultCallback(<span class="keyword">object</span> :</span><br><span class="line">                ResultCallbacks&lt;RemoteMediaClient.MediaChannelResult&gt;() &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSuccess</span><span class="params">(mediaChannelResult: <span class="type">RemoteMediaClient</span>.<span class="type">MediaChannelResult</span>)</span></span> &#123;</span><br><span class="line">                    <span class="comment">//TODO()</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailure</span><span class="params">(status: <span class="type">Status</span>)</span></span> &#123;</span><br><span class="line">                    stop()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><hr>        <h2 id="Receiveræ•™å­¸ç¶²å€"   >          <a href="#Receiveræ•™å­¸ç¶²å€" class="heading-link"><i class="fas fa-link"></i></a><a href="#Receiveræ•™å­¸ç¶²å€" class="headerlink" title="Receiveræ•™å­¸ç¶²å€"></a>Receiveræ•™å­¸ç¶²å€</h2>      <p><span class="exturl"><a class="exturl__link"   href="https://codelabs.developers.google.com/codelabs/cast-receiver#0" >https://codelabs.developers.google.com/codelabs/cast-receiver#0</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="https://i.imgur.com/mPhc6B0.png" alt="Imgur"></p>        <h3 id="ç¯„ä¾‹æª”"   >          <a href="#ç¯„ä¾‹æª”" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¯„ä¾‹æª”" class="headerlink" title="ç¯„ä¾‹æª”"></a>ç¯„ä¾‹æª”</h3>      <ul><li><a href="/file/da740470f4af94a289424160beed16fc">index.html</a>   ï¼šä¸»è¦–åœ–  </li><li><a href="/file/d74e7a16668e8c911dffdcb84ee57af9">receiver.js</a>  ï¼šåŒ…å«æ‰€æœ‰ä½¿Receiveré‹ä½œçš„ç¨‹å¼ç¢¼</li></ul>        <h3 id="åŸºæœ¬çš„Cast-Receiver"   >          <a href="#åŸºæœ¬çš„Cast-Receiver" class="heading-link"><i class="fas fa-link"></i></a><a href="#åŸºæœ¬çš„Cast-Receiver" class="headerlink" title="åŸºæœ¬çš„Cast Receiver"></a>åŸºæœ¬çš„Cast Receiver</h3>      <p>â­ï¸ <font color=Peru>index.html</font> åˆå§‹åŒ–ï¼šåˆä½µAPI ( CastDebugLoggerç­‰ç­‰ )<br>â­ï¸ <font color=Peru>index.html</font> å¼•ç”¨script <font color=Turquoise>receiver.js</font>     </p><figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Cast CAF Receiver<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Cast Debug Logger --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//www.gstatic.com/cast/sdk/libs/devtools/debug_layer/caf_receiver_logger.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cast-media-player</span>&gt;</span><span class="tag">&lt;/<span class="name">cast-media-player</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/receiver.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>â­ï¸ <font color=Turquoise>receiver.js</font> åˆå§‹åŒ–ï¼šå–å¾—CastReceiverContextã€CastDebugLoggerç­‰ç­‰</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> context = cast.framework.CastReceiverContext.getInstance();</span><br><span class="line"><span class="keyword">const</span> playerManager = context.getPlayerManager();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Media Sample API Values</span></span><br><span class="line"><span class="keyword">const</span> SAMPLE_URL = <span class="string">&quot;https://storage.googleapis.com/cpe-sample-media/content.json&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> StreamType = &#123;</span><br><span class="line">   DASH: <span class="string">&#x27;application/dash+xml&#x27;</span>,</span><br><span class="line">   HLS: <span class="string">&#x27;application/x-mpegurl&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> TEST_STREAM_TYPE = StreamType.DASH</span><br><span class="line"></span><br><span class="line"><span class="comment">// Debug Logger</span></span><br><span class="line"><span class="keyword">const</span> castDebugLogger = cast.debug.CastDebugLogger.getInstance();</span><br><span class="line"><span class="keyword">const</span> LOG_TAG = <span class="string">&#x27;MyAPP.LOG&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>â­ï¸ <font color=Turquoise>receiver.js</font> LOAD è¨Šæ¯æ””æˆªï¼šå–å¾—å½±ç‰‡è³‡è¨Š  </p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">playerManager.setMessageInterceptor(   <span class="comment">//è¨Šæ¯æ””æˆªå™¨</span></span><br><span class="line">   cast.framework.messages.MessageType.LOAD,    <span class="comment">//Type -&gt; LOAD</span></span><br><span class="line">   request =&gt; &#123;</span><br><span class="line">      castDebugLogger.info(LOG_TAG, <span class="string">&#x27;Intercepting LOAD request&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// Map contentId to entity</span></span><br><span class="line">      <span class="keyword">if</span> (request.media &amp;&amp; request.media.entity) &#123;</span><br><span class="line">         request.media.contentId = request.media.entity;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="comment">// Fetch content repository by requested contentId</span></span><br><span class="line">         makeRequest(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;https://storage.googleapis.com/cpe-sample-media/content.json&#x27;</span>)</span><br><span class="line">           .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">let</span> item = data[request.media.contentId];</span><br><span class="line">              <span class="keyword">if</span>(!item) &#123;</span><br><span class="line">                 <span class="comment">// Content could not be found in repository</span></span><br><span class="line">                 castDebugLogger.error(LOG_TAG, <span class="string">&#x27;Content not found&#x27;</span>);</span><br><span class="line">                 reject();</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 <span class="comment">// Adjusting request to make requested content playable</span></span><br><span class="line">                 request.media.contentUrl = item.stream.dash;</span><br><span class="line">                 request.media.contentType = <span class="string">&#x27;application/dash+xml&#x27;</span>;</span><br><span class="line">                 castDebugLogger.warn(LOG_TAG, <span class="string">&#x27;Playable URL:&#x27;</span>, request.media.contentUrl);</span><br><span class="line"></span><br><span class="line">                 <span class="comment">// Add metadata</span></span><br><span class="line">                 <span class="keyword">let</span> metadata = <span class="keyword">new</span> cast.framework.messages.MovieMediaMetadata();</span><br><span class="line">                 metadata.metadataType = cast.framework.messages.MetadataType.MOVIE;</span><br><span class="line">                 metadata.title = item.title;</span><br><span class="line">                 metadata.subtitle = item.author;</span><br><span class="line"></span><br><span class="line">                 request.media.metadata = metadata;</span><br><span class="line"></span><br><span class="line">                 <span class="comment">// Resolve request</span></span><br><span class="line">                 resolve(request);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">       &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>â­ï¸ <font color=Turquoise>receiver.js</font> å°ç•«é¢é€²è¡Œè™•ç†</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Optimizing for smart displays</span></span><br><span class="line"><span class="keyword">const</span> touchControls = cast.framework.ui.Controls.getInstance();</span><br><span class="line"><span class="keyword">const</span> playerData = <span class="keyword">new</span> cast.framework.ui.PlayerData();</span><br><span class="line"><span class="keyword">const</span> playerDataBinder = <span class="keyword">new</span> cast.framework.ui.PlayerDataBinder(playerData);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> browseItems = getBrowseItems();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBrowseItems</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> browseItems = [];</span><br><span class="line">   makeRequest(<span class="string">&#x27;GET&#x27;</span>, SAMPLE_URL)</span><br><span class="line">   .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">         <span class="keyword">let</span> item = <span class="keyword">new</span> cast.framework.ui.BrowseItem();</span><br><span class="line">         item.entity = key;</span><br><span class="line">         item.title = data[key].title;</span><br><span class="line">         item.subtitle = data[key].description;</span><br><span class="line">         item.image = <span class="keyword">new</span> cast.framework.messages.Image(data[key].poster);</span><br><span class="line">         item.imageType = cast.framework.ui.BrowseImageType.MOVIE;</span><br><span class="line">         browseItems.push(item);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="keyword">return</span> browseItems;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> browseContent = <span class="keyword">new</span> cast.framework.ui.BrowseContent();</span><br><span class="line">browseContent.title = <span class="string">&#x27;Up Next&#x27;</span>;</span><br><span class="line">browseContent.items = browseItems;</span><br><span class="line">browseContent.targetAspectRatio =</span><br><span class="line">   cast.framework.ui.BrowseImageAspectRatio.LANDSCAPE_16_TO_9;</span><br><span class="line"></span><br><span class="line">playerDataBinder.addEventListener(</span><br><span class="line">   cast.framework.ui.PlayerDataEventType.MEDIA_CHANGED,</span><br><span class="line">   (e) =&gt; &#123;</span><br><span class="line">       <span class="keyword">if</span> (!e.value) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Media browse</span></span><br><span class="line">       touchControls.setBrowseContent(browseContent);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Clear default buttons and re-assign</span></span><br><span class="line">       touchControls.clearDefaultSlotAssignments();</span><br><span class="line">       touchControls.assignButton(</span><br><span class="line">          cast.framework.ui.ControlsSlot.SLOT_PRIMARY_1,</span><br><span class="line">          cast.framework.ui.ControlsButton.SEEK_BACKWARD_30</span><br><span class="line">       );</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>â­ï¸ <font color=Turquoise>receiver.js</font> APPå•Ÿç”¨</p><figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> context = cast.framework.CastReceiverContext.getInstance();</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">context.start();</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>â­ï¸ æ­å–œ</p><p><img src="https://i.imgur.com/WqAuzu4.png" alt="Imgur"></p>        <h6 id="tags-æŠ€è¡“åˆ†äº«-Chromecast"   >          <a href="#tags-æŠ€è¡“åˆ†äº«-Chromecast" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æŠ€è¡“åˆ†äº«-Chromecast" class="headerlink" title="tags: æŠ€è¡“åˆ†äº« Chromecast"></a>tags: <code>æŠ€è¡“åˆ†äº«</code> <code>Chromecast</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ­£è¦è¡¨ç¤ºæ³•Regex</title>
      <link href="/tutu1023/2021/04/29/%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%A4%BA%E6%B3%95Regex/"/>
      <url>/tutu1023/2021/04/29/%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%A4%BA%E6%B3%95Regex/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2020/03/03<br>  Codeï¼šKotlin<br>  Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://riptutorial.com/zh-TW/kotlin/example/32686/kotlin%E4%B8%AD%E6%AD%A3%E5%89%87%E8%A1%A8%E9%81%94%E5%BC%8F%E7%B0%A1%E4%BB%8B" >https://riptutorial.com/zh-TW/kotlin/example/32686/kotlin%E4%B8%AD%E6%AD%A3%E5%89%87%E8%A1%A8%E9%81%94%E5%BC%8F%E7%B0%A1%E4%BB%8B</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>ç›®çš„ï¼šå–å¾—ç‰¹æ®Šæ¢ä»¶ä¸‹çš„å­—ä¸²</p><hr>        <h2 id="ä½¿ç”¨æ•™å­¸"   >          <a href="#ä½¿ç”¨æ•™å­¸" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä½¿ç”¨æ•™å­¸" class="headerlink" title="ä½¿ç”¨æ•™å­¸"></a>ä½¿ç”¨æ•™å­¸</h2>              <h3 id="è©²å­—ä¸²æ˜¯å¦å…·å‚™ç‰¹å®šå€¼containsMatchIn"   >          <a href="#è©²å­—ä¸²æ˜¯å¦å…·å‚™ç‰¹å®šå€¼containsMatchIn" class="heading-link"><i class="fas fa-link"></i></a><a href="#è©²å­—ä¸²æ˜¯å¦å…·å‚™ç‰¹å®šå€¼containsMatchIn" class="headerlink" title="è©²å­—ä¸²æ˜¯å¦å…·å‚™ç‰¹å®šå€¼containsMatchIn"></a>è©²å­—ä¸²æ˜¯å¦å…·å‚™ç‰¹å®šå€¼containsMatchIn</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> regex = Regex(pattern = <span class="string">&quot;c|d&quot;</span>)     <span class="comment">//æ¢ä»¶ï¼šå­—ä¸²å…§å«cæˆ–d</span></span><br><span class="line"><span class="keyword">val</span> matched = regex.containsMatchIn(input = <span class="string">&quot;abc&quot;</span>)   <span class="comment">//å­—ä¸²abcå…§æ˜¯å¦å«cæˆ–d(return ture)</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="å°‹æ‰¾find"   >          <a href="#å°‹æ‰¾find" class="heading-link"><i class="fas fa-link"></i></a><a href="#å°‹æ‰¾find" class="headerlink" title="å°‹æ‰¾find"></a>å°‹æ‰¾find</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> phoneNumber :String? = Regex(pattern = <span class="string">&quot;&quot;&quot;\d&#123;3&#125;-\d&#123;3&#125;-\d&#123;4&#125;&quot;&quot;&quot;</span>)  <span class="comment">//æ¢ä»¶ï¼š(ä¸‰ä½æ•¸)-(ä¸‰ä½æ•¸)-(å››ä½æ•¸)</span></span><br><span class="line">    .find(input = <span class="string">&quot;phone: 123-456-7890, e..&quot;</span>)?.value <span class="comment">// phoneNumber = &quot;123-456-7890&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="å–å›å®‰å…¨ç©ºå€¼â€â€è€Œä¸æ˜¯null-orEmpty"   >          <a href="#å–å›å®‰å…¨ç©ºå€¼â€â€è€Œä¸æ˜¯null-orEmpty" class="heading-link"><i class="fas fa-link"></i></a><a href="#å–å›å®‰å…¨ç©ºå€¼â€â€è€Œä¸æ˜¯null-orEmpty" class="headerlink" title="å–å›å®‰å…¨ç©ºå€¼â€â€è€Œä¸æ˜¯null : orEmpty()"></a>å–å›å®‰å…¨ç©ºå€¼â€â€è€Œä¸æ˜¯null : orEmpty()</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> matchResult = </span><br><span class="line">    Regex(<span class="string">&quot;c|d&quot;</span>).find(<span class="string">&quot;efg&quot;</span>)           <span class="comment">//matchResult = null</span></span><br><span class="line"><span class="keyword">val</span> a = matchResult?.value             <span class="comment">//a = null</span></span><br><span class="line"><span class="keyword">val</span> b = matchResult?.value.orEmpty()   <span class="comment">//b = &quot;&quot;  if null å‰‡ return &quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="ç‰¹æ®Šç¯„åœå°‹æ‰¾pattern-â€œplayer-amp-â€"   >          <a href="#ç‰¹æ®Šç¯„åœå°‹æ‰¾pattern-â€œplayer-amp-â€" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç‰¹æ®Šç¯„åœå°‹æ‰¾pattern-â€œplayer-amp-â€" class="headerlink" title="ç‰¹æ®Šç¯„åœå°‹æ‰¾pattern = â€œplayer=(.*?)&amp;â€"></a>ç‰¹æ®Šç¯„åœå°‹æ‰¾pattern = â€œplayer=<font color = INDIANRED>(.*?)</font>&amp;â€</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> regex = Regex(pattern = <span class="string">&quot;player=(.*?)&amp;&quot;</span>)   <span class="comment">//å–å¾—&quot;player=&quot;åˆ°&quot;&amp;&quot;çš„å­—ä¸² (.*?)åŒ…å«ä»»æ„ç¬¦è™Ÿ</span></span><br><span class="line">    .find(input = <span class="string">&quot;player=m3u8&amp;playId=9487&quot;</span>)?.value <span class="comment">//regex = &quot;player=m3u8&amp;&quot;</span></span><br><span class="line"><span class="keyword">val</span> result =</span><br><span class="line">    regex?.let &#123; </span><br><span class="line">        Regex(<span class="string">&quot;player=&quot;</span>).replace(it, <span class="string">&quot;&quot;</span>) </span><br><span class="line">        Regex(<span class="string">&quot;&amp;&quot;</span>).replace(it, <span class="string">&quot;&quot;</span>)    <span class="comment">//result = &quot;m3u8&quot;</span></span><br><span class="line">    &#125;                                           </span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-ç‰¹æ®Šèªæ³•-æ­£è¦è¡¨ç¤ºæ³•-Regex-Find"   >          <a href="#tags-ç‰¹æ®Šèªæ³•-æ­£è¦è¡¨ç¤ºæ³•-Regex-Find" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-ç‰¹æ®Šèªæ³•-æ­£è¦è¡¨ç¤ºæ³•-Regex-Find" class="headerlink" title="tags: ç‰¹æ®Šèªæ³• æ­£è¦è¡¨ç¤ºæ³• Regex Find"></a>tags: <code>ç‰¹æ®Šèªæ³•</code> <code>æ­£è¦è¡¨ç¤ºæ³•</code> <code>Regex</code> <code>Find</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¯èª¿è‰²å­—ä¸²ColorfulString</title>
      <link href="/tutu1023/2021/04/29/%E5%8F%AF%E8%AA%BF%E8%89%B2%E5%AD%97%E4%B8%B2ColorfulString/"/>
      <url>/tutu1023/2021/04/29/%E5%8F%AF%E8%AA%BF%E8%89%B2%E5%AD%97%E4%B8%B2ColorfulString/</url>
      
        <content type="html"><![CDATA[<p>Updateï¼š2020/03/03  Codeï¼šKotlin<br>Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://stackoverflow.com/questions/19630160/change-color-inside-strings-xml" >https://stackoverflow.com/questions/19630160/change-color-inside-strings-xml</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="/file/b1ff1386666fa0dd01b64290ae0edbee" alt="Screenshot_20200226-112535.png"><img src="/file/9feee09762abd40cbc676c61945776b0" alt="Screenshot_20200226-112035.png"></p><p>å¸Œæœ›èƒ½å¤ å¾APIå–å¾—çš„å­—ä¸²è‡ªç”±æ”¹è®Šé¡è‰²ã€‚</p><hr>        <h3 id="æ”¹è®Šæ–‡å­—æ ¼å¼"   >          <a href="#æ”¹è®Šæ–‡å­—æ ¼å¼" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ”¹è®Šæ–‡å­—æ ¼å¼" class="headerlink" title="æ”¹è®Šæ–‡å­—æ ¼å¼"></a>æ”¹è®Šæ–‡å­—æ ¼å¼</h3>      <p>é¦–å…ˆæ˜¯APIåçš„å­—ä¸²è¦æœ‰æ‰€æ”¹è®Š</p><ul><li>æ›è¡Œ<font color = 'indianred'>\n</font>æ”¹æˆ<font color = 'indianred'>&lt;br&gt;</font>  </li><li>ç©ºè¡Œ<font color = 'indianred'>\n\n</font>æ”¹æˆ<font color = 'indianred'>&lt;p&gt;</font></li><li>è¦è®Šè‰²çš„æ–‡å­—å‰å¾Œç”¨è®Šè‰²æ¨™ç±¤åŒ…èµ·ä¾†<font color = 'indianred'>&lt;font color=â€™redâ€™&gt;&lt;/font&gt;</font></li></ul><p>ï¼¢efore:</p><p>â€œæ—¥å¤œè¶•å·¥ï¼Œé¤é¤åƒæ³¡éºµï¼Œçµ‚æ–¼ä¿®å¾©ä»¥ä¸‹å•é¡Œæ‹‰<font color = 'indianred'>\n\n</font>1.æœå°‹æ¡†â€¦<font color = 'indianred'>\n</font>2.è‡ªå‹•â€¦<font color = 'indianred'>\n</font>4.æ’­æ”¾é â€¦<font color = 'indianred'>\n\n</font>P.S è¦ºå¾—APPå¥½ç”¨ï¼Œè¨˜å¾—è¦åˆ†äº«çµ¦ä½ å€‘çš„å°å¤¥ä¼´å€‘å–”ï¼â€</p><p>ï¼¡fter:</p><p>â€œæ—¥å¤œè¶•å·¥ï¼Œé¤é¤åƒæ³¡éºµï¼Œçµ‚æ–¼ä¿®å¾©ä»¥ä¸‹å•é¡Œæ‹‰<font color = 'indianred'>&lt;p&gt;</font>1.æœå°‹æ¡†â€¦<font color = 'indianred'>&lt;br&gt;</font>2.è‡ªå‹•â€¦<font color = 'indianred'>&lt;br&gt;</font>4.æ’­æ”¾é â€¦<font color = 'indianred'>&lt;p&gt;</font><font color = 'indianred'>&lt;font color=â€™redâ€™&gt;</font>P.S  è¦ºå¾—APPå¥½ç”¨ï¼Œè¨˜å¾—è¦åˆ†äº«çµ¦ä½ å€‘çš„å°å¤¥ä¼´å€‘å–”ï¼<font color = 'indianred'>&lt;/font&gt;</font>â€œ</p><p>é™„ä¸Šé¡è‰²æ¨™ç±¤ç¶²å€ï¼š<br><span class="exturl"><a class="exturl__link"   href="https://htmlcolorcodes.com/color-names/" >HTMLé¡è‰²æ¨™ç±¤(RED)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>      <span class="exturl"><a class="exturl__link"   href="https://htmlcolorcodes.com/" >HEXç¢¼æŸ¥è©¢(#ABCDEF)</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h3 id="ASæ‰¿æ¥å­—ä¸²"   >          <a href="#ASæ‰¿æ¥å­—ä¸²" class="heading-link"><i class="fas fa-link"></i></a><a href="#ASæ‰¿æ¥å­—ä¸²" class="headerlink" title="ASæ‰¿æ¥å­—ä¸²"></a>ASæ‰¿æ¥å­—ä¸²</h3>      <p>å¾APIæ¥åˆ°æ–‡å­—ä¹‹å¾Œï¼Œè¦å…ˆç¶“éHtml.fromHtml()è™•ç†æ‰èƒ½å¥—ç”¨åˆ°TextViewä¸Šé¢</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> message:String = getApiMessage()</span><br><span class="line">mTextView.setText(Html.fromHtml(message), TextView.BufferType.SPANNABLE)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p><font color = 'INDIANRED'>é€™æ¨£å°±</font><font color = 'orange'>å¯ä»¥éš¨</font><font color = '#F4D03F'>å¿ƒæ‰€æ¬²</font><font color = 'DARKSEAGREEN'>åœ°è®Šæ›</font><font color = 'STEELBLUE'>æ–‡å­—é¡</font><font color = 'MEDIUMPURPLE'>è‰²å›‰ !</font></p><p>P.S. ASç„¡æ³•è¾¨è­˜å¤ªè¤‡é›œçš„é¡è‰²æ¨™ç±¤ï¼Œå»ºè­°ä½¿ç”¨è¼ƒç‚ºç°¡å–®çš„REDã€YELLOWï¼Œåœ¨ç™¼ä½ˆå‰å…ˆæ¸¬è©¦é</p><p>æˆ–ç›´æ¥ä½¿ç”¨HEXç¢¼ã€‚</p>        <h6 id="tags-ç‰¹æ®Šèªæ³•-TextView-Html-String-è®Šè‰²"   >          <a href="#tags-ç‰¹æ®Šèªæ³•-TextView-Html-String-è®Šè‰²" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-ç‰¹æ®Šèªæ³•-TextView-Html-String-è®Šè‰²" class="headerlink" title="tags: ç‰¹æ®Šèªæ³• TextView Html String è®Šè‰²"></a>tags: <code>ç‰¹æ®Šèªæ³•</code> <code>TextView</code> <code>Html</code> <code>String</code> <code>è®Šè‰²</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>èª¿è©¦æ¨¡å¼è¨­å®šæ–¹æ³•DebugView</title>
      <link href="/tutu1023/2021/04/29/%E8%AA%BF%E8%A9%A6%E6%A8%A1%E5%BC%8F%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95DebugView/"/>
      <url>/tutu1023/2021/04/29/%E8%AA%BF%E8%A9%A6%E6%A8%A1%E5%BC%8F%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95DebugView/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2020/07/14<br>  Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://shengyu7697.github.io/blog/2019/10/26/Android-adb/" >https://shengyu7697.github.io/blog/2019/10/26/Android-adb/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p><img src="/file/f3424d7101ac9dbe1d8a2e2c1e71c44a" alt="image.png"></p><p>ç‚ºæ¸¬è©¦ä¸€æ¬¾æ–°çš„appæ˜¯å¦æ­£å¸¸æ¤å…¥GAï¼ˆæˆ–æ˜¯æ¤å…¥GAå¾Œæ²’æœ‰æ­£å¸¸æ”¶åˆ°è¨Šæ¯ï¼‰ï¼Œæ•…éœ€è¦å…ˆè¡Œæ¸¬è©¦FirebaseAnalyticsæŒ‡ä»¤æ˜¯å¦æ­£å¸¸å‚³é€ã€‚</p><hr><p>1.Firebaseå®˜ç¶²åªæåˆ°ï¼Œè¦é–‹å•Ÿæ‰‹æ©Ÿè¨­å‚™çš„èª¿è©¦æ¨¡å¼ï¼Œéœ€USBæ’ä¸Šæ‰‹æ©Ÿï¼Œä¸¦è¼¸å…¥èªæ³•ã€‚</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell setprop debug.firebase.analytics.app &lt;package_name&gt;</span><br></pre></td></tr></table></div></figure><p>åˆ°ASçš„Terminalè¼¸å…¥æŒ‡ä»¤ï¼Œç³»çµ±å»èªªä¸èªè­˜adbï¼Œé€™æ™‚é ˆå…ˆä¸‹è¼‰platform-toolså·¥å…·</p><ul><li><span class="exturl"><a class="exturl__link"   href="https://dl.google.com/android/repository/platform-tools-latest-windows.zip" >Windowsè¼‰é»</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li><li><span class="exturl"><a class="exturl__link"   href="https://dl.google.com/android/repository/platform-tools-latest-darwin.zip" >MACè¼‰é»</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ul><p>è¼‰å¥½ä¹‹å¾Œè§£å£“ç¸®ä¸¦ä¸”ä¸Ÿåˆ°ä¸€å€‹è‡ªå·±æ‰¾å¾—åˆ°çš„ä½ç½®ï¼ˆç›´æ¥ä¸Ÿåœ¨packageå…§çš„ç¬¬ä¸€å±¤ï¼‰</p><p>2.å›åˆ°Terminalï¼Œä¸¦é€²å…¥platform-toolsè³‡æ–™å¤¾ä¸­</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd platform-tools</span><br></pre></td></tr></table></div></figure><p>é€²å…¥ä¹‹å¾Œï¼Œå¯èƒ½æœƒç™¼ç¾ç³»çµ±æ‰¾ä¸åˆ°adbé€™å€‹æŒ‡ä»¤ï¼Œæ˜¯å› ç‚ºç’°å¢ƒè®Šæ•¸æ²’æœ‰è¨­ç½®å¥½ã€‚</p><p>é€™æ™‚å€™å°±å¯ä»¥åƒè€ƒ<span class="exturl"><a class="exturl__link"   href="https://medium.com/@stanleylin_7768/android-studio-mac%E4%B8%ADadb-command-not-found-9b8c2b559f4c" >ï¼ªå€‹ç¶²å€</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><pre><code>(1) é¦–å…ˆè¼¸å…¥ä¸‹åˆ—æŒ‡ä»¤ï¼Œé–‹å•Ÿä¸€å€‹æ–°æª”æ¡ˆ    touch .bash_profile(2) æ‰“é–‹è©²æª”æ¡ˆ    open -e .bash_profile(3) åœ¨è·³å‡ºçš„ç©ºç™½è¦–çª—ä¸­ï¼Œè¼¸å…¥å…ˆå‰æ”¾ç½®platform-toolsçš„è·¯å¾‘ã€‚    ä¾‹ï¼š/Users/MyMac/MyApplication/platform-tools    export PATH=$&#123;PATH&#125;:/Users/MyMac/MyApplication/platform-tools    è¼¸å…¥å®Œå¾Œç›´æ¥é—œé–‰ï¼Œæœƒè‡ªå‹•å­˜æª”ã€‚(4)è¼¸å…¥ä¸‹åˆ—æŒ‡ä»¤æ›´æ–°å‰›å‰›çš„é…ç½®    source .bash_profile    å°±å¯ä»¥ç™¼ç¾å‰›å‰›çš„adbæŒ‡ä»¤å·²ç¶“å¯ä»¥é–‹å§‹ä½¿ç”¨å•¦ï½</code></pre><p>3.è¼¸å…¥å•Ÿç”¨æŒ‡ä»¤</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell setprop debug.firebase.analytics.app &lt;package_name&gt;</span><br></pre></td></tr></table></div></figure><p>Terminalä¸æœƒæœ‰ä»»ä½•åæ‡‰ï¼Œä½†éä¸€å…©åˆ†é˜å¾Œï¼ŒFirebaseçš„DebugViewé é¢æ‡‰è©²æœƒé€£æ¥ä¸Šæ‰‹æ©Ÿã€‚</p><p>è‹¥é²é²æ²’æœ‰é€£æ¥ï¼Œå¯ä»¥åˆ°Firebaseè¨­å®šå»æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼çš„SHA1æŒ‡ç´‹æ˜¯å¦ä¸€è‡´</p><p>4.é—œé–‰èª¿é©æ¨¡å¼</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell setprop debug.firebase.analytics.app .none.</span><br></pre></td></tr></table></div></figure>        <h6 id="tags-å·¥å…·æ•™å­¸-Firebase-Debug"   >          <a href="#tags-å·¥å…·æ•™å­¸-Firebase-Debug" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-å·¥å…·æ•™å­¸-Firebase-Debug" class="headerlink" title="tags: å·¥å…·æ•™å­¸ Firebase Debug"></a>tags: <code>å·¥å…·æ•™å­¸</code> <code>Firebase</code> <code>Debug</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Blogä¸Šå‚³æ•™å­¸</title>
      <link href="/tutu1023/2021/04/29/Blog/"/>
      <url>/tutu1023/2021/04/29/Blog/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šå‚³æ–‡ç« <br>-&gt;Source-&gt;_posts-&gt;ä¸Ÿå…¥æ–‡ç« .mdæª” </p><p>æ›´æ”¹ä¸»é¡Œ<br>-&gt;themes-&gt;ä¸Ÿå…¥ä¸»é¡Œ<br>_config.yml theme: æ›¿æ›ä¸»é¡Œåç¨±</p><p>hexo clean æ¸…é™¤éœæ…‹æª”æ¡ˆ</p><p>hexo g å»ºç«‹æ–°çš„éœæ…‹æª”æ¡ˆ</p><p>hexo s æ¸¬è©¦</p><p>hexo d ä¸Šå‚³åˆ°git</p><p><span class="exturl"><a class="exturl__link"   href="https://www.notion.so/f1c7f1cd7420422a9728991f5b271715" >https://www.notion.so/f1c7f1cd7420422a9728991f5b271715</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>        <h6 id="tags-å·¥å…·æ•™å­¸-Hexo-Blog"   >          <a href="#tags-å·¥å…·æ•™å­¸-Hexo-Blog" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-å·¥å…·æ•™å­¸-Hexo-Blog" class="headerlink" title="tags: å·¥å…·æ•™å­¸ Hexo Blog"></a>tags: <code>å·¥å…·æ•™å­¸</code> <code>Hexo</code> <code>Blog</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é ç«¯æŠ•å±ChromeCast</title>
      <link href="/tutu1023/2021/04/29/%E9%81%A0%E7%AB%AF%E6%8A%95%E5%B1%8FChromeCast/"/>
      <url>/tutu1023/2021/04/29/%E9%81%A0%E7%AB%AF%E6%8A%95%E5%B1%8FChromeCast/</url>
      
        <content type="html"><![CDATA[<p>Updateï¼š2019/12/11  Codeï¼šKotlin<br>Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<br><span class="exturl"><a class="exturl__link"   href="https://qiita.com/tomo1139/items/fea907958160f77760ef" >https://qiita.com/tomo1139/items/fea907958160f77760ef</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br><span class="exturl"><a class="exturl__link"   href="https://medium.com/@quentin7b/make-your-android-app-compatible-with-your-chromecast-ca751294c4e2" >https://medium.com/@quentin7b/make-your-android-app-compatible-with-your-chromecast-ca751294c4e2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>1.å°å…¥ä¾è³´ google play service frameworkã€mediarouter</p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;androidx.appcompat:appcompat:1.1.0-rc01&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;androidx.mediarouter:mediarouter:1.1.0&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;com.google.android.gms:play-services-cast-framework:17.1.0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>2.å‰µä¸€å€‹castOptionProvider å‰µé€ notification</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">CastOptionsProvider</span> : <span class="type">OptionsProvider &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCastOptions</span><span class="params">(context: <span class="type">Context</span>)</span></span>: CastOptions &#123;</span><br><span class="line">        <span class="keyword">return</span> CastOptions.Builder()</span><br><span class="line">            .setReceiverApplicationId(context.getString(R.string.app_id))</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getAdditionalSessionProviders</span><span class="params">(context: <span class="type">Context</span>)</span></span>: List&lt;SessionProvider&gt;? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>å…¶ä¸­R.string.app_idç‚ºç”³è«‹ChromeCastå¾Œå¾—åˆ°çš„ä¸€çµ„ï¼©ï¼¤ï¼Œä½†ç¶²è·¯ä¸Šæµå‚³(?)ä¸€çµ„å¤§å®¶éƒ½å¯ä»¥ç”¨çš„id</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- App Id <span class="keyword">for</span> ChromeCast--&gt;</span><br><span class="line">&lt;string name=<span class="string">&quot;app_id&quot;</span> translatable=<span class="string">&quot;false&quot;</span>&gt;CC1AD845&lt;/string&gt;</span><br><span class="line">    </span><br></pre></td></tr></table></div></figure><p>3.ç›¸é—œæ¬Šé™ã€meta-dataæ¨™è¨˜castOptionProviderï¼Œè¨˜å¾—æ›´æ”¹æ”¾ç½®CastOptionsProviderçš„è·¯å¾‘</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;meta-<span class="keyword">data</span></span><br><span class="line">        android:name=</span><br><span class="line">            <span class="string">&quot;com.google.android.gms.cast.framework.OPTIONS_PROVIDER_CLASS_NAME&quot;</span></span><br><span class="line">        android:value=<span class="string">&quot;com.example.casttest.CastOptionsProvider&quot;</span> /&gt;  <span class="comment">//&lt;---è¨˜å¾—æ›´æ”¹</span></span><br><span class="line">&lt;/application&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>4.åœ¨æƒ³è¦æŠ•å±çš„activityè¨­å®šgetShareInstance = this</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//MainActivity.kt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> castContext: CastContext? = <span class="literal">null</span></span><br><span class="line">castContext = CastContext.getSharedInstance(<span class="keyword">this</span>)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p><strong>chromecastä¸æ”¯æ´æ©Ÿç¨®</strong></p><p>å¤§é™¸æ‰‹æ©Ÿ(å¦‚ï¼šå°ç±³)å› ç‚ºæ²’æœ‰google playï¼Œæ‰€ä»¥ä»–å€‘çš„æ‰‹æ©ŸåŸºæœ¬ä¸Šä¸æ”¯æ´chromecast</p><p>å› æ­¤åœ¨getSharedInstanceçš„æ™‚å€™å°±æœƒå ±éŒ¯</p><p>åŠ ä¸Šä¸€å€‹åˆ¤æ–·å¼æª¢æŸ¥æ˜¯å¦æ”¯æ´Googleçš„ChromeCast</p><pre><code>GoogleApiAvailability.getInstance().isGooglePlayServicesAvailable(this)</code></pre><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//MainActivity.kt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isCastApiAvailable())&#123;</span><br><span class="line">    castContext = CastContext.getSharedInstance(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isCastApiAvailable</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> isCastApiAvailable = GoogleApiAvailability.getInstance().isGooglePlayServicesAvailable(<span class="keyword">this</span>) == ConnectionResult.SUCCESS</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        CastContext.getSharedInstance(<span class="keyword">this</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        <span class="comment">// track non-fatal</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isCastApiAvailable</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>5.å¸ƒç½®castå°ˆå±¬æŒ‰éˆ•</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//main_activity.xml</span></span><br><span class="line"></span><br><span class="line">&lt;android.support.v7.app.MediaRouteButton</span><br><span class="line">    android:id=<span class="string">&quot;@+id/media_route_button&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">    android:mediaRouteTypes=<span class="string">&quot;user&quot;</span></span><br><span class="line">    android:visibility=<span class="string">&quot;gone&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//res/menu/cast_expanded_controller_menu.xml</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;menu </span><br><span class="line">    xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    xmlns:app=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span> &gt;</span><br><span class="line">    </span><br><span class="line">    &lt;item</span><br><span class="line">        android:id=<span class="string">&quot;@+id/media_route_menu_item&quot;</span></span><br><span class="line">        app:actionProviderClass=<span class="string">&quot;androidx.mediarouter.app.MediaRouteActionProvider&quot;</span></span><br><span class="line">        app:showAsAction=<span class="string">&quot;always&quot;</span> android:title=<span class="string">&quot;&quot;</span>/&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/menu&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ä¸¦åœ¨activityå…§åšä¸²æ¥çš„å‹•ä½œ</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//MainActivity.kt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateOptionsMenu</span><span class="params">(menu: <span class="type">Menu</span>)</span></span>:<span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreateOptionsMenu(menu)</span><br><span class="line">    menuInflater.inflate(R.menu.cast_expanded_controller_menu, menu)</span><br><span class="line">    CastButtonFactory.setUpMediaRouteButton(</span><br><span class="line">        applicationContext,</span><br><span class="line">        menu,</span><br><span class="line">        R.id.media_route_menu_item)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>å¦‚æœè¦æ”¹è®ŠæŒ‰éˆ•é¡è‰²ï¼ˆé è¨­ç‚ºé»‘è‰²ï¼‰ï¼Œéœ€è¦styleæª”è¨­å®š</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;style name=<span class="string">&quot;CustomMediaRouterTheme&quot;</span> parent=<span class="string">&quot;Theme.MediaRouter&quot;</span>&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;mediaRouteButtonStyle&quot;</span>&gt;<span class="meta">@style</span>/CustomMediaRouteButtonStyle&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;style name=<span class="string">&quot;CustomMediaRouteButtonStyle&quot;</span> parent=<span class="string">&quot;Widget.MediaRouter.Light.MediaRouteButton&quot;</span>&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;mediaRouteButtonTint&quot;</span>&gt;#FFFFFF&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸»è¦çš„themeä¸­æ¨™æ˜å¥—ç”¨</span></span><br><span class="line">&lt;style name=<span class="string">&quot;AppTheme&quot;</span> parent=<span class="string">&quot;Theme.AppCompat.Light.NoActionBar&quot;</span>&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;item name=<span class="string">&quot;mediaRouteTheme&quot;</span>&gt;<span class="meta">@style</span>/CustomMediaRouterTheme&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>6.sessionManagerListener é€£æ¥ç‹€æ…‹çš„ç›£è½ æœ‰startã€startFailedã€endã€resumedç­‰ç­‰ </p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> mSessionManagerListener = SessionManagerListenerImpl()</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionManagerListenerImpl</span> : <span class="type">SessionManagerListener</span>&lt;<span class="type">CastSession</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionStarting</span><span class="params">( castSession:<span class="type">CastSession</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionStarted</span><span class="params">(castSession:<span class="type">CastSession</span>, s:<span class="type">String</span> )</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionStartFailed</span><span class="params">(castSession:<span class="type">CastSession</span>, i:<span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionEnding</span><span class="params">(castSession:<span class="type">CastSession</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionEnded</span><span class="params">(castSession:<span class="type">CastSession</span>, i:<span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionResuming</span><span class="params">(castSession:<span class="type">CastSession</span>, s:<span class="type">String</span> )</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionResumed</span><span class="params">(castSession:<span class="type">CastSession</span>, b:<span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionResumeFailed</span><span class="params">(castSession:<span class="type">CastSession</span>, i:<span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionSuspended</span><span class="params">(castSession:<span class="type">CastSession</span>,  i:<span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>éœ€è¦åœ¨onPauseã€onResumeé‡æ–°å®šç¾©</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPause</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onPause()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(isCastApiAvailable())&#123;</span><br><span class="line">        castContext!!.sessionManager.removeSessionManagerListener(mSessionManagerListener, CastSession::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onResume()    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(isCastApiAvailable())&#123;</span><br><span class="line">        castContext!!.sessionManager.addSessionManagerListener(mSessionManagerListener, CastSession::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125;        </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>7.è¨­å®š<em><strong>onSessionStared</strong></em>åœ¨æˆåŠŸé€£æ¥å¾Œè¦åšçš„äº‹æƒ…</p><p><strong>movieMetadata</strong>ï¼šå„²å­˜å½±ç‰‡çš„æ¨™é¡Œã€å‰¯æ¨™é¡Œï¼Œæˆ–æ˜¯åœ–ç‰‡ç¶²å€</p><p><strong>mediaInfo</strong>ï¼šå»ºç«‹å½±ç‰‡é€£çµã€è²æ˜å½±ç‰‡æ ¼å¼ä¸”å¤¾å¸¶movieMetadata</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSessionStarted</span><span class="params">(castSession:<span class="type">CastSession</span>, s:<span class="type">String</span> )</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> movieMetadata = MediaMetadata(MediaMetadata.MEDIA_TYPE_MOVIE)</span><br><span class="line">    movieMetadata.putString(MediaMetadata.KEY_SUBTITLE, airVideoTitle)</span><br><span class="line">    movieMetadata.putString(MediaMetadata.KEY_TITLE, airVideoName)</span><br><span class="line">    movieMetadata.addImage(WebImage(Uri.parse(videoPic)))</span><br><span class="line">    movieMetadata.addImage(WebImage(Uri.parse(videoPic)))</span><br><span class="line">    <span class="keyword">val</span> mediaInfo = MediaInfo.Builder(videoUrl)</span><br><span class="line">        .setStreamType(MediaInfo.STREAM_TYPE_BUFFERED)</span><br><span class="line">        .setContentType(<span class="string">&quot;videos/mp4&quot;</span>)</span><br><span class="line">        .setMetadata(movieMetadata)</span><br><span class="line">        .build()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">val</span> remoteMediaClient = castSession.remoteMediaClient</span><br><span class="line">    remoteMediaClient.load(mediaInfo, <span class="literal">true</span>, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ç”±æ–¼é€£æ¥å¾Œéœ€è¦é¦¬ä¸Šå½ˆå‡ºç›¸é—œçš„é™æ§å™¨ç•«é¢çµ¦ä½¿ç”¨è€…ä½¿ç”¨ï¼Œæ–¼æ˜¯è¦æ”¹å¯«remoteMediaClient.loadï¼Œè¨­å®šCallBack</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">remoteMediaClient.load(mediaInfo, <span class="literal">true</span>, <span class="number">0</span>).setResultCallback(<span class="keyword">object</span> :ResultCallbacks&lt;RemoteMediaClient.MediaChannelResult&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSuccess</span><span class="params">(<span class="meta">@NonNull</span> mediaChannelResult:<span class="type">RemoteMediaClient</span>.<span class="type">MediaChannelResult</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> intent = Intent(videoContext,ExpandedControlsActivity::<span class="keyword">class</span>.java)</span><br><span class="line">        startActivity(videoContext,intent,<span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailure</span><span class="params">(<span class="meta">@NonNull</span> status: <span class="type">Status</span>)</span></span> &#123;</span><br><span class="line">        Toast.makeText(videoContext, <span class="string">&quot;é€£æ¥å¤±æ•—&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        remoteMediaClient.stop()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>8.å»ºç«‹ExpandedController</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExpandedControlsActivity</span> : <span class="type">ExpandedControllerActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateOptionsMenu</span><span class="params">(menu: <span class="type">Menu</span>)</span></span>:<span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreateOptionsMenu(menu)</span><br><span class="line">        menuInflater.inflate(R.menu.cast_expanded_controller_menu, menu)</span><br><span class="line">        CastButtonFactory.setUpMediaRouteButton(</span><br><span class="line">            applicationContext,</span><br><span class="line">            menu,</span><br><span class="line">            R.id.media_route_menu_item)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//AndroidMenifest.xml</span></span><br><span class="line"></span><br><span class="line">&lt;application&gt;</span><br><span class="line">...</span><br><span class="line">&lt;activity</span><br><span class="line">        android:name=<span class="string">&quot;.ExpandedControlsActivity&quot;</span></span><br><span class="line">        android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">        android:launchMode=<span class="string">&quot;singleTask&quot;</span></span><br><span class="line">        android:theme=<span class="string">&quot;@style/Theme.AppCompat.NoActionBar&quot;</span></span><br><span class="line">        android:screenOrientation=<span class="string">&quot;portrait&quot;</span>&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">    &lt;meta-<span class="keyword">data</span></span><br><span class="line">            android:name=<span class="string">&quot;android.support.PARENT_ACTIVITY&quot;</span></span><br><span class="line">            android:value=<span class="string">&quot;com.example.casttest.MainActivity&quot;</span>/&gt;</span><br><span class="line">&lt;/activity&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/application&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ä¸”ä¸²æ¥ Controlleråˆ°castOptionProviderä¸Š</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="class"><span class="keyword">class</span> <span class="title">CastOptionsProvider</span> : <span class="type">OptionsProvider &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCastOptions</span><span class="params">(context: <span class="type">Context</span>)</span></span>: CastOptions &#123;</span><br><span class="line">        <span class="keyword">val</span> buttonActions = arrayListOf&lt;String&gt;()   <span class="comment">//notificationè¦ä½¿ç”¨çš„æŒ‰éˆ•åˆ—è¡¨</span></span><br><span class="line">        buttonActions.add(MediaIntentReceiver.ACTION_REWIND)</span><br><span class="line">        buttonActions.add(MediaIntentReceiver.ACTION_TOGGLE_PLAYBACK)</span><br><span class="line">        buttonActions.add(MediaIntentReceiver.ACTION_FORWARD)</span><br><span class="line">        buttonActions.add(MediaIntentReceiver.ACTION_STOP_CASTING)</span><br><span class="line">        <span class="keyword">val</span> compatButtonActionsIndicies = intArrayOf(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">val</span> notificationOptions = NotificationOptions.Builder()</span><br><span class="line">            .setTargetActivityClassName(ExpandedControlsActivity::<span class="keyword">class</span>.java.name)</span><br><span class="line">            .setActions(buttonActions, compatButtonActionsIndicies)</span><br><span class="line">            .setSkipStepMs(<span class="number">30</span> * DateUtils.SECOND_IN_MILLIS)</span><br><span class="line">            .build()</span><br><span class="line">        <span class="keyword">val</span> mediaOptions = CastMediaOptions.Builder()</span><br><span class="line">            .setNotificationOptions(notificationOptions)</span><br><span class="line">            .setExpandedControllerActivityClassName(ExpandedControlsActivity::<span class="keyword">class</span>.java.name)</span><br><span class="line">            .build()</span><br><span class="line">        <span class="keyword">return</span> CastOptions.Builder()</span><br><span class="line">            .setReceiverApplicationId(context.getString(R.string.app_id))</span><br><span class="line">            .setCastMediaOptions(mediaOptions)</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getAdditionalSessionProviders</span><span class="params">(context: <span class="type">Context</span>)</span></span>: List&lt;SessionProvider&gt;? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>9.è¦†å¯«ExpandedControllerï¼Œå¥—ç”¨è‡ªå·±æ‹‰çš„ä»‹é¢ï¼Œåˆ©ç”¨uiMediaControllerä¸²æ¥åŠŸèƒ½</p><p><strong>uiMediaController.bind(ç¶å®š)SeekBar(expandedCastSeekBar,1000L)</strong></p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExpandedControlsActivity</span> : <span class="type">ExpandedControllerActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(bundle: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(bundle)</span><br><span class="line">        setContentView(R.layout.expanded_controller)   <span class="comment">//æ¯«ä¸çŒ¶è±«åœ°çµ¦ä»–å¥—ç”¨ä¸Šå»</span></span><br><span class="line"></span><br><span class="line">        uiMediaController.bindViewToRewind(expandedRewind,<span class="number">10000</span>)</span><br><span class="line">        uiMediaController.bindViewToForward(expandedForward,<span class="number">10000</span>)</span><br><span class="line">        uiMediaController.bindSeekBar(expandedCastSeekBar,<span class="number">1000L</span>)</span><br><span class="line">        uiMediaController.bindTextViewToStreamPosition(expandedPosition,<span class="literal">true</span>,<span class="number">1000</span>)</span><br><span class="line">        uiMediaController.bindTextViewToStreamDuration(expandedDuration)</span><br><span class="line">        uiMediaController.bindImageViewToPlayPauseToggle(expandedPlayPause,resources.getDrawable(R.drawable.play),resources.getDrawable(R.drawable.pause),<span class="literal">null</span>,<span class="literal">null</span>, <span class="literal">false</span>)</span><br><span class="line">        uiMediaController.bindImageViewToMuteToggle(expandedMute)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ç¼ºé»ï¼šè¶Šæ·±å…¥çš„ç‰©ä»¶åç¨±ç”±æ–¼ä¿è­·çš„é—œä¿‚ï¼Œæ‰€ä»¥çœ‹èµ·ä¾†éƒ½å¾ˆç›¸åƒï¼Œæ‹¿å–å­˜å½±ç‰‡è³‡è¨Šçš„mediaMetaDataæ™‚ï¼Œéœ€è¦ç”¨å¿ƒæŒ–</p><p>ex.</p><pre><code>private TextView zzxy; private SeekBar zzvx; private CastSeekBar zzxz; private ImageView zzya; private ImageView zzyb; private int[] zzyc; </code></pre><p>â–¼æ‹¿å–å­˜å½±ç‰‡è³‡è¨Šçš„mediaMetaData</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> metadata: com.google.android.gms.cast.MediaMetadata=session.remoteMediaClient.mediaInfo.metadata</span><br><span class="line">expandedTitle.text = metadata.getString(<span class="string">&quot;com.google.android.gms.cast.metadata.TITLE&quot;</span>)</span><br><span class="line">expandedSubTitle.text = (zzp.zzb(metadata)).toString()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>éœ‡å‹•æ–¹æ³•ä»¥åŠæŒ‰éˆ•èª¿æ•´éŸ³é‡æ–¹æ³•</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//éœ‡å‹•æ§åˆ¶</span></span><br><span class="line"><span class="keyword">val</span> myVibrator = application.getSystemService(Service.VIBRATOR_SERVICE) <span class="keyword">as</span> Vibrator</span><br><span class="line"><span class="comment">//get session</span></span><br><span class="line"><span class="keyword">val</span> session:CastSession = CastContext.getSharedInstance(applicationContext).sessionManager.currentCastSession</span><br><span class="line">expandedMute.setOnClickListener &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">26</span>) &#123;</span><br><span class="line">        myVibrator.vibrate(VibrationEffect.createOneShot(<span class="number">100</span>, <span class="number">10</span>))   <span class="comment">//æŒ‰éˆ•éœ‡å‹•</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        myVibrator.vibrate(<span class="number">50</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(session.isConnected)&#123;   </span><br><span class="line">        session.isMute = !session.isMute   <span class="comment">//éœéŸ³</span></span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//éŸ³é‡æ§åˆ¶</span></span><br><span class="line"><span class="keyword">val</span> audioManager: AudioManager = applicationContext.getSystemService(Context.AUDIO_SERVICE) <span class="keyword">as</span> AudioManager</span><br><span class="line">expandedVolDown.setOnClickListener &#123;</span><br><span class="line">    audioManager.adjustVolume(AudioManager.ADJUST_LOWER, AudioManager.FLAG_PLAY_SOUND)  <span class="comment">//éŸ³é‡--</span></span><br><span class="line">&#125;</span><br><span class="line">expandedVolUp.setOnClickListener &#123;</span><br><span class="line">    audioManager.adjustVolume(AudioManager.ADJUST_RAISE, AudioManager.FLAG_PLAY_SOUND)  <span class="comment">//éŸ³é‡++</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ExpandedControlleråœ¨æ’­æ”¾å®Œç•¢ä¹‹å¾Œä¸€æ®µæ™‚é–“æœƒè‡ªå‹•æ¶ˆå¤±ï¼Œé€™æ™‚å¦‚æœç”¨ç•¶ä½œæ·å¾‘çš„æµ®å‹•æŒ‰éˆ•ä¾†Intentå›ä¾†ï¼Œæœƒå› ç‚ºæ‰¾ä¸åˆ°æ±è¥¿è€Œå ±éŒ¯ï¼Œæ‰€ä»¥è¦Intentéä¾†ExpandedControlsActivityä»¥å‰ï¼Œå¿…é ˆè¦æª¢æŸ¥castçš„è³‡æ–™é‚„åœ¨ä¸åœ¨</p><pre><code>Objects.requireNonNull(CastContext.getSharedInstance()).getSessionManager().getCurrentCastSession()!=null</code></pre>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-Video-æŠ•å±-Chromecast-Remote-é ç«¯"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-æŠ•å±-Chromecast-Remote-é ç«¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-æŠ•å±-Chromecast-Remote-é ç«¯" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ Video æŠ•å± Chromecast Remote é ç«¯"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>Video</code> <code>æŠ•å±</code> <code>Chromecast</code> <code>Remote</code> <code>é ç«¯</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¯å…¨å±æ’­æ”¾VideoEnableWebView</title>
      <link href="/tutu1023/2021/04/29/%E5%8F%AF%E5%85%A8%E5%B1%8F%E6%92%AD%E6%94%BEVideoEnableWebView/"/>
      <url>/tutu1023/2021/04/29/%E5%8F%AF%E5%85%A8%E5%B1%8F%E6%92%AD%E6%94%BEVideoEnableWebView/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2020/04/15<br>  Codeï¼šJavaã€Kotlin<br>  Byï¼šAda</p><p>åƒè€ƒä¾†æºï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/cprcrack/VideoEnabledWebView" >https://github.com/cprcrack/VideoEnabledWebView</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>Android Studioå…§å»ºçš„WebViewå°‡ç¶²é å…§çš„full screenåŠŸèƒ½æ“‹æ‰äº†ï¼Œå› æ­¤å¦å¯«ä¸€å€‹å¯æˆåŠŸå…¨å±æ’­æ”¾çš„WebViewä¾†å–ä»£ä¹‹ã€‚</p><hr>        <h3 id="1-å‰µå»ºä¸€å€‹VideoEnabledWebChromeClient"   >          <a href="#1-å‰µå»ºä¸€å€‹VideoEnabledWebChromeClient" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-å‰µå»ºä¸€å€‹VideoEnabledWebChromeClient" class="headerlink" title="1.å‰µå»ºä¸€å€‹VideoEnabledWebChromeClient"></a>1.å‰µå»ºä¸€å€‹VideoEnabledWebChromeClient</h3>      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoEnabledWebChromeClient</span> <span class="title">extends</span> <span class="title">WebChromeClient</span> <span class="title">implements</span> <span class="title">MediaPlayer</span>.<span class="title">OnPreparedListener</span>, <span class="type">MediaPlayer.OnCompletionListener</span>, <span class="type">MediaPlayer.OnErrorListener</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToggledFullscreenCallback</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> void toggledFullscreen(boolean fullscreen);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View activityNonVideoView;</span><br><span class="line">    <span class="keyword">private</span> ViewGroup activityVideoView;</span><br><span class="line">    <span class="keyword">private</span> View loadingView;</span><br><span class="line">    <span class="keyword">private</span> VideoEnableWebView webView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> boolean isVideoFullscreen; <span class="comment">// Indicates if the video is being displayed using a custom view (typically full-screen)</span></span><br><span class="line">    <span class="keyword">private</span> FrameLayout videoViewContainer;</span><br><span class="line">    <span class="keyword">private</span> CustomViewCallback videoViewCallback;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ToggledFullscreenCallback toggledFullscreenCallback;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Never use this constructor alone.</span></span><br><span class="line"><span class="comment">     * This constructor allows this class to be defined as an inline inner class in which the user can override methods</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoEnabledWebChromeClient()</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Builds a video enabled WebChromeClient.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityNonVideoView A View in the activity&#x27;s layout that contains every other view that should be hidden when the video goes full-screen.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityVideoView A ViewGroup in the activity&#x27;s layout that will display the video. Typically you would like this to fill the whole layout.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoEnabledWebChromeClient(View activityNonVideoView, ViewGroup activityVideoView)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.activityNonVideoView = activityNonVideoView;</span><br><span class="line">        <span class="keyword">this</span>.activityVideoView = activityVideoView;</span><br><span class="line">        <span class="keyword">this</span>.loadingView = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.webView = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.isVideoFullscreen = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Builds a video enabled WebChromeClient.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityNonVideoView A View in the activity&#x27;s layout that contains every other view that should be hidden when the video goes full-screen.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityVideoView A ViewGroup in the activity&#x27;s layout that will display the video. Typically you would like this to fill the whole layout.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loadingView A View to be shown while the video is loading (typically only used in API level &lt;11). Must be already inflated and not attached to a parent view.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoEnabledWebChromeClient(View activityNonVideoView, ViewGroup activityVideoView, View loadingView)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.activityNonVideoView = activityNonVideoView;</span><br><span class="line">        <span class="keyword">this</span>.activityVideoView = activityVideoView;</span><br><span class="line">        <span class="keyword">this</span>.loadingView = loadingView;</span><br><span class="line">        <span class="keyword">this</span>.webView = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.isVideoFullscreen = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Builds a video enabled WebChromeClient.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityNonVideoView A View in the activity&#x27;s layout that contains every other view that should be hidden when the video goes full-screen.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityVideoView A ViewGroup in the activity&#x27;s layout that will display the video. Typically you would like this to fill the whole layout.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loadingView A View to be shown while the video is loading (typically only used in API level &lt;11). Must be already inflated and not attached to a parent view.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> webView The owner VideoEnabledWebView. Passing it will enable the VideoEnabledWebChromeClient to detect the HTML5 video ended event and exit full-screen.</span></span><br><span class="line"><span class="comment">     * Note: The web page must only contain one video tag in order for the HTML5 video ended event to work. This could be improved if needed (see Javascript code).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoEnabledWebChromeClient(View activityNonVideoView, ViewGroup activityVideoView, View loadingView, VideoEnableWebView webView)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.activityNonVideoView = activityNonVideoView;</span><br><span class="line">        <span class="keyword">this</span>.activityVideoView = activityVideoView;</span><br><span class="line">        <span class="keyword">this</span>.loadingView = loadingView;</span><br><span class="line">        <span class="keyword">this</span>.webView = webView;</span><br><span class="line">        <span class="keyword">this</span>.isVideoFullscreen = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Indicates if the video is being displayed using a custom view (typically full-screen)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true it the video is being displayed using a custom view (typically full-screen)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> boolean isVideoFullscreen()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> isVideoFullscreen;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Set a callback that will be fired when the video starts or finishes displaying using a custom view (typically full-screen)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callback A VideoEnabledWebChromeClient.ToggledFullscreenCallback callback</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> void setOnToggledFullscreen(ToggledFullscreenCallback callback)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.toggledFullscreenCallback = callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void onShowCustomView(View view, CustomViewCallback callback)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (view instanceof FrameLayout)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// A video wants to be shown</span></span><br><span class="line">            FrameLayout frameLayout = (FrameLayout) view;</span><br><span class="line">            View focusedChild = frameLayout.getFocusedChild();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Save video related variables</span></span><br><span class="line">            <span class="keyword">this</span>.isVideoFullscreen = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">this</span>.videoViewContainer = frameLayout;</span><br><span class="line">            <span class="keyword">this</span>.videoViewCallback = callback;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Hide the non-video view, add the video view, and show it</span></span><br><span class="line">            activityNonVideoView.setVisibility(View.INVISIBLE);</span><br><span class="line">            activityVideoView.addView(videoViewContainer, new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT));</span><br><span class="line">            activityVideoView.setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (focusedChild instanceof android.widget.VideoView)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// android.widget.VideoView (typically API level &lt;11)</span></span><br><span class="line">                android.widget.VideoView videoView = (android.widget.VideoView) focusedChild;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Handle all the required events</span></span><br><span class="line">                videoView.setOnPreparedListener(<span class="keyword">this</span>);</span><br><span class="line">                videoView.setOnCompletionListener(<span class="keyword">this</span>);</span><br><span class="line">                videoView.setOnErrorListener(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Other classes, including:</span></span><br><span class="line">                <span class="comment">// - android.webkit.HTML5VideoFullScreen$VideoSurfaceView, which inherits from android.view.SurfaceView (typically API level 11-18)</span></span><br><span class="line">                <span class="comment">// - android.webkit.HTML5VideoFullScreen$VideoTextureView, which inherits from android.view.TextureView (typically API level 11-18)</span></span><br><span class="line">                <span class="comment">// - com.android.org.chromium.content.browser.ContentVideoView$VideoSurfaceView, which inherits from android.view.SurfaceView (typically API level 19+)</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Handle HTML5 video ended event only if the class is a SurfaceView</span></span><br><span class="line">                <span class="comment">// Test case: TextureView of Sony Xperia T API level 16 doesn&#x27;t work fullscreen when loading the javascript below</span></span><br><span class="line">                <span class="keyword">if</span> (webView != <span class="literal">null</span> &amp;&amp; webView.getSettings().getJavaScriptEnabled() &amp;&amp; focusedChild instanceof SurfaceView)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Run javascript code that detects the video end and notifies the Javascript interface</span></span><br><span class="line">                    String js = <span class="string">&quot;javascript:&quot;</span>;</span><br><span class="line">                    js += <span class="string">&quot;var _ytrp_html5_video_last;&quot;</span>;</span><br><span class="line">                    js += <span class="string">&quot;var _ytrp_html5_video = document.getElementsByTagName(&#x27;video&#x27;)[0];&quot;</span>;</span><br><span class="line">                    js += <span class="string">&quot;if (_ytrp_html5_video != undefined &amp;&amp; _ytrp_html5_video != _ytrp_html5_video_last) &#123;&quot;</span>;</span><br><span class="line">                    &#123;</span><br><span class="line">                        js += <span class="string">&quot;_ytrp_html5_video_last = _ytrp_html5_video;&quot;</span>;</span><br><span class="line">                        js += <span class="string">&quot;function _ytrp_html5_video_ended() &#123;&quot;</span>;</span><br><span class="line">                        &#123;</span><br><span class="line">                            js += <span class="string">&quot;_VideoEnabledWebView.notifyVideoEnd();&quot;</span>; <span class="comment">// Must match Javascript interface name and method of VideoEnableWebView</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        js += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">                        js += <span class="string">&quot;_ytrp_html5_video.addEventListener(&#x27;ended&#x27;, _ytrp_html5_video_ended);&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    js += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">                    webView.loadUrl(js);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Notify full-screen change</span></span><br><span class="line">            <span class="keyword">if</span> (toggledFullscreenCallback != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                toggledFullscreenCallback.toggledFullscreen(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;deprecation&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> void onShowCustomView(View view, int requestedOrientation, CustomViewCallback callback) <span class="comment">// Available in API level 14+, deprecated in API level 18+</span></span><br><span class="line">    &#123;</span><br><span class="line">        onShowCustomView(view, callback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void onHideCustomView()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// This method should be manually called on video end in all cases because it&#x27;s not always called automatically.</span></span><br><span class="line">        <span class="comment">// This method must be manually called on back key press (from this class&#x27; onBackPressed() method).</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isVideoFullscreen)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Hide the video view, remove it, and show the non-video view</span></span><br><span class="line">            activityVideoView.setVisibility(View.INVISIBLE);</span><br><span class="line">            activityVideoView.removeView(videoViewContainer);</span><br><span class="line">            activityNonVideoView.setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Call back (only in API level &lt;19, because in API level 19+ with chromium webview it crashes)</span></span><br><span class="line">            <span class="keyword">if</span> (videoViewCallback != <span class="literal">null</span> &amp;&amp; !videoViewCallback.getClass().getName().contains(<span class="string">&quot;.chromium.&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                videoViewCallback.onCustomViewHidden();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Reset video related variables</span></span><br><span class="line">            isVideoFullscreen = <span class="literal">false</span>;</span><br><span class="line">            videoViewContainer = <span class="literal">null</span>;</span><br><span class="line">            videoViewCallback = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Notify full-screen change</span></span><br><span class="line">            <span class="keyword">if</span> (toggledFullscreenCallback != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                toggledFullscreenCallback.toggledFullscreen(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> View getVideoLoadingProgressView() <span class="comment">// Video will start loading</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (loadingView != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            loadingView.setVisibility(View.VISIBLE);</span><br><span class="line">            <span class="keyword">return</span> loadingView;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.getVideoLoadingProgressView();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void onPrepared(MediaPlayer mp) <span class="comment">// Video will start playing, only called in the case of android.widget.VideoView (typically API level &lt;11)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (loadingView != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            loadingView.setVisibility(View.GONE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void onCompletion(MediaPlayer mp) <span class="comment">// Video finished playing, only called in the case of android.widget.VideoView (typically API level &lt;11)</span></span><br><span class="line">    &#123;</span><br><span class="line">        onHideCustomView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> boolean onError(MediaPlayer mp, int what, int extra) <span class="comment">// Error while playing video, only called in the case of android.widget.VideoView (typically API level &lt;11)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// By returning false, onCompletion() will be called</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Notifies the class that the back key has been pressed by the user.</span></span><br><span class="line"><span class="comment">     * This must be called from the Activity&#x27;s onBackPressed(), and if it returns false, the activity itself should handle it. Otherwise don&#x27;t do anything.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Returns true if the event was handled, and false if was not (video view is not visible)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> boolean onBackPressed()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (isVideoFullscreen)</span><br><span class="line">        &#123;</span><br><span class="line">            onHideCustomView();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">### <span class="number">2.</span>å‰µå»ºVideoEnableWebView</span><br><span class="line"></span><br><span class="line">```Java</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoEnableWebView</span> <span class="title">extends</span> <span class="title">WebView</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavascriptInterface</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">@android</span>.webkit.JavascriptInterface <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">        <span class="keyword">public</span> void notifyVideoEnd() <span class="comment">// Must match Javascript interface method of VideoEnabledWebChromeClient</span></span><br><span class="line">        &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;___&quot;</span>, <span class="string">&quot;GOT IT&quot;</span>);</span><br><span class="line">            <span class="comment">// This code is not executed in the UI thread, so we must force that to happen</span></span><br><span class="line">            new Handler(Looper.getMainLooper()).post(new Runnable()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> void run()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (videoEnabledWebChromeClient != <span class="literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        videoEnabledWebChromeClient.onHideCustomView();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> VideoEnabledWebChromeClient videoEnabledWebChromeClient;</span><br><span class="line">    <span class="keyword">private</span> boolean addedJavascriptInterface;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoEnableWebView(Context context)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        addedJavascriptInterface = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoEnableWebView(Context context, AttributeSet attrs)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        addedJavascriptInterface = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> VideoEnableWebView(Context context, AttributeSet attrs, int defStyle)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</span><br><span class="line">        addedJavascriptInterface = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Indicates if the video is being displayed using a custom view (typically full-screen)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true it the video is being displayed using a custom view (typically full-screen)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(<span class="meta-string">&quot;unused&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> boolean isVideoFullscreen()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> videoEnabledWebChromeClient != <span class="literal">null</span> &amp;&amp; videoEnabledWebChromeClient.isVideoFullscreen();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Pass only a VideoEnabledWebChromeClient instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="meta">@SuppressLint(<span class="meta-string">&quot;SetJavaScriptEnabled&quot;</span>)</span></span><br><span class="line">    <span class="keyword">public</span> void setWebChromeClient(WebChromeClient client)</span><br><span class="line">    &#123;</span><br><span class="line">        getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (client instanceof VideoEnabledWebChromeClient)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.videoEnabledWebChromeClient = (VideoEnabledWebChromeClient) client;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.setWebChromeClient(client);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void loadData(String <span class="keyword">data</span>, String mimeType, String encoding)</span><br><span class="line">    &#123;</span><br><span class="line">        addJavascriptInterface();</span><br><span class="line">        <span class="keyword">super</span>.loadData(<span class="keyword">data</span>, mimeType, encoding);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void loadDataWithBaseURL(String baseUrl, String <span class="keyword">data</span>, String mimeType, String encoding, String historyUrl)</span><br><span class="line">    &#123;</span><br><span class="line">        addJavascriptInterface();</span><br><span class="line">        <span class="keyword">super</span>.loadDataWithBaseURL(baseUrl, <span class="keyword">data</span>, mimeType, encoding, historyUrl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void loadUrl(String url)</span><br><span class="line">    &#123;</span><br><span class="line">        addJavascriptInterface();</span><br><span class="line">        <span class="keyword">super</span>.loadUrl(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> void loadUrl(String url, Map&lt;String, String&gt; additionalHttpHeaders)</span><br><span class="line">    &#123;</span><br><span class="line">        addJavascriptInterface();</span><br><span class="line">        <span class="keyword">super</span>.loadUrl(url, additionalHttpHeaders);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> void addJavascriptInterface()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!addedJavascriptInterface)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Add javascript interface to be called when the video ends (must be done before page load)</span></span><br><span class="line">            <span class="comment">//noinspection all</span></span><br><span class="line">            addJavascriptInterface(new JavascriptInterface(), <span class="string">&quot;_VideoEnabledWebView&quot;</span>); <span class="comment">// Must match Javascript interface name of VideoEnabledWebChromeClient</span></span><br><span class="line"></span><br><span class="line">            addedJavascriptInterface = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h3 id="3-å°‡VideoEnableWebViewå¥—ç”¨åˆ°layoutä¸­"   >          <a href="#3-å°‡VideoEnableWebViewå¥—ç”¨åˆ°layoutä¸­" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-å°‡VideoEnableWebViewå¥—ç”¨åˆ°layoutä¸­" class="headerlink" title="3.å°‡VideoEnableWebViewå¥—ç”¨åˆ°layoutä¸­"></a>3.å°‡VideoEnableWebViewå¥—ç”¨åˆ°layoutä¸­</h3>      <p>å°‡ä¸‹æ–¹ç¨‹å¼ç¢¼å–ä»£&lt;WebView/&gt;</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;RelativeLayout</span><br><span class="line"></span><br><span class="line">    android:id=<span class="string">&quot;@+id/webviewLayout&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- View that will be hidden <span class="keyword">when</span> video goes fullscreen --&gt;</span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">            android:id=<span class="string">&quot;@+id/nonVideoLayout&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;match_parent&quot;</span> &gt;</span><br><span class="line"></span><br><span class="line">        &lt;com.android.a58btv.Tool.VideoEnableWebView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/videoEnableWebview&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">                android:focusable=<span class="string">&quot;true&quot;</span> android:focusableInTouchMode=<span class="string">&quot;true&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- View <span class="keyword">where</span> the video will be shown <span class="keyword">when</span> video goes fullscreen --&gt;</span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">            android:id=<span class="string">&quot;@+id/videoLayout&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;match_parent&quot;</span> &gt;</span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ç°¡å–®ä¾†èªªå°±æ˜¯å°‡å½±ç‰‡ç¨ç«‹å‡ºä¾†ï¼Œç”¨videoLayoutä¾†æ‰¿æ¥ï¼Œå…¶ä»–éƒ¨åˆ†å‰‡æ˜¯ä½¿ç”¨nonVideoLayoutè£¡çš„VideoEnableWebViewé¡¯ç¤ºã€‚</p>        <h3 id="4-å¯¦éš›æ“ä½œ"   >          <a href="#4-å¯¦éš›æ“ä½œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-å¯¦éš›æ“ä½œ" class="headerlink" title="4.å¯¦éš›æ“ä½œ"></a>4.å¯¦éš›æ“ä½œ</h3>      <p>åˆ°Activityæ‰¿æ¥Viewï¼Œä¸¦å»ºç½®ä¸€å€‹webChromeClientï¼Œç„¶å¾Œè¤‡å¯«onToggledFullscreenæ–¹æ³•</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> videoEnableWebview = findViewById&lt;VideoEnableWebView&gt;(R.id.videoEnableWebview)</span><br><span class="line"><span class="keyword">val</span> nonVideoLayout = findViewById&lt;RelativeLayout&gt;(R.id.nonVideoLayout) <span class="comment">// Your own view, read class comments</span></span><br><span class="line"><span class="keyword">val</span> videoLayout = findViewById&lt;ViewGroup&gt;(R.id.videoLayout) <span class="comment">// Your own view, read class comments</span></span><br><span class="line"><span class="keyword">val</span> loadingView = layoutInflater.inflate(R.layout.view_loading_video, <span class="literal">null</span>) <span class="comment">// Your own view, read class comments</span></span><br><span class="line"><span class="keyword">val</span> webChromeClient = <span class="keyword">object</span> :VideoEnabledWebChromeClient(nonVideoLayout, videoLayout, loadingView, backupWebview) <span class="comment">// See all available constructors...</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">webChromeClient.setOnToggledFullscreen &#123; fullscreen -&gt;</span><br><span class="line">    <span class="keyword">if</span> (fullscreen) &#123;</span><br><span class="line">        <span class="keyword">val</span> attrs = window.attributes</span><br><span class="line">        attrs.flags += WindowManager.LayoutParams.FLAG_FULLSCREEN</span><br><span class="line">        attrs.flags += WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON</span><br><span class="line">        window.attributes = attrs</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">14</span>) &#123;</span><br><span class="line">            <span class="comment">//noinspection all</span></span><br><span class="line">            window.decorView.systemUiVisibility = (SYSTEM_UI_FLAG_LAYOUT_STABLE+</span><br><span class="line">                SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION+</span><br><span class="line">                SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN+</span><br><span class="line">                SYSTEM_UI_FLAG_HIDE_NAVIGATION+</span><br><span class="line">                SYSTEM_UI_FLAG_FULLSCREEN+</span><br><span class="line">                SYSTEM_UI_FLAG_IMMERSIVE_STICKY)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> attrs = window.attributes</span><br><span class="line">        attrs.flags -= WindowManager.LayoutParams.FLAG_FULLSCREEN</span><br><span class="line">        attrs.flags -= WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON</span><br><span class="line">        window.attributes = attrs</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">14</span>) &#123;</span><br><span class="line">            <span class="comment">//noinspection all</span></span><br><span class="line">            window.decorView.systemUiVisibility = SYSTEM_UI_FLAG_VISIBLE</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">videoEnableWebview.webChromeClient = webChromeClient</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>è¤‡å¯«viedoEnableWebViewçš„webViewClientæ–¹æ³•</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">videoEnableWebview.webViewClient = <span class="keyword">object</span>: WebViewClient()&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(view:<span class="type">WebView</span> , url:<span class="type">String</span> )</span></span>:<span class="built_in">Boolean</span> &#123;</span><br><span class="line">        view.loadUrl(url)  <span class="comment">//æ””æˆªrequestï¼Œæ‰ä¸æœƒè·³å‡ºAppå¦é–‹å•Ÿç€è¦½å™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPageStarted</span><span class="params">(view: <span class="type">WebView</span>?, url: <span class="type">String</span>?, favicon: <span class="type">Bitmap</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onPageStarted(view, url, favicon)</span><br><span class="line">        loadingLayout.visibility=VISIBLE</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPageFinished</span><span class="params">(view: <span class="type">WebView</span>?, url: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onPageFinished(view, url)</span><br><span class="line">        loadingLayout.visibility=GONE</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>æœ€å¾ŒåŸ·è¡ŒloadUrlå‹•ä½œ</p><figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">videoEnableWebview.loadUrl(yourUrl)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>        <h6 id="tags-æ‡‰ç”¨æŠ€è¡“-Video-WebView"   >          <a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-WebView" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-æ‡‰ç”¨æŠ€è¡“-Video-WebView" class="headerlink" title="tags: æ‡‰ç”¨æŠ€è¡“ Video WebView"></a>tags: <code>æ‡‰ç”¨æŠ€è¡“</code> <code>Video</code> <code>WebView</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¡¬åŠ é€ŸHardwareAccelerated</title>
      <link href="/tutu1023/2021/04/29/%E7%A1%AC%E5%8A%A0%E9%80%9FHardwareAccelerated/"/>
      <url>/tutu1023/2021/04/29/%E7%A1%AC%E5%8A%A0%E9%80%9FHardwareAccelerated/</url>
      
        <content type="html"><![CDATA[<p>  Updateï¼š2020/01/07<br>  Byï¼šAda</p>        <h5 id="ç­è§£ç¡¬åŠ é€Ÿçš„å„ªç¼ºé»ï¼šã€Androidã€‘-ç¡¬ä»¶åŠ é€Ÿ-hardwareAccelerated-å¯èƒ½å°è‡´çš„å•é¡Œ"   >          <a href="#ç­è§£ç¡¬åŠ é€Ÿçš„å„ªç¼ºé»ï¼šã€Androidã€‘-ç¡¬ä»¶åŠ é€Ÿ-hardwareAccelerated-å¯èƒ½å°è‡´çš„å•é¡Œ" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç­è§£ç¡¬åŠ é€Ÿçš„å„ªç¼ºé»ï¼šã€Androidã€‘-ç¡¬ä»¶åŠ é€Ÿ-hardwareAccelerated-å¯èƒ½å°è‡´çš„å•é¡Œ" class="headerlink" title="ç­è§£ç¡¬åŠ é€Ÿçš„å„ªç¼ºé»ï¼šã€Androidã€‘ ç¡¬ä»¶åŠ é€Ÿ(hardwareAccelerated)å¯èƒ½å°è‡´çš„å•é¡Œ"></a>ç­è§£ç¡¬åŠ é€Ÿçš„å„ªç¼ºé»ï¼š<span class="exturl"><a class="exturl__link"   href="http://stephenandroiddv.blogspot.com/2017/11/android-hardwareaccelerated.html" >ã€Androidã€‘ ç¡¬ä»¶åŠ é€Ÿ(hardwareAccelerated)å¯èƒ½å°è‡´çš„å•é¡Œ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></h5>      <p>ç³»çµ±é è¨­ç‚ºé–‹å•Ÿï¼Œä½†è‹¥æ˜¯æ‰‹å‹•è¨­ç‚ºfalseçš„è©±ï¼Œæœƒä½¿appå¡é “ã€cardViewå¤±æ•ˆã€å…ƒä»¶çš„elevationé™°å½±æ¶ˆå¤±</p><p><code>AndroidManifest.xml</code></p><figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;application</span><br><span class="line">    android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">    android:icon=<span class="string">&quot;@mipmap/icon&quot;</span></span><br><span class="line">    android:theme=<span class="string">&quot;@style/AppTheme&quot;</span></span><br><span class="line">    android:hardwareAccelerated=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">&lt;/application&gt;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ç¡¬ä»¶çš„åŠ é€Ÿæœƒä½”ç”¨ä¸€å®šçš„RAMï¼Œä½†å¦‚æœappåªæ˜¯æ¨™æº–çš„Viewå’Œå¯æ‹‰ä¼¸ï¼Œå…¨å±€éƒ½æ‰“é–‹ç¡¬ä»¶åŠ é€Ÿï¼Œæ˜¯ä¸æœƒæœ‰ä»»ä½•å•é¡Œçš„ã€‚</p><p>è‹¥æ˜¯å‹•ç•«å¾ˆå¤šçš„è©±ï¼Œæƒ³è¦åªé‡å°æŸäº›ç¯„åœé€²è¡Œä¸æœƒå¡é “çš„ç¡¬åŠ é€Ÿï¼Œå¯ä»¥åƒè€ƒä¸‹é¢ç¶²å€</p><p><span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/janronehoo/article/details/7517284" >androidå­¦ä¹ â€”â€”æ§åˆ¶ç¡¬åŠ é€Ÿ hardwareAccelerated åœ¨3.0æ‰æœ‰çš„ã€‚</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><p>çµè«–å°±æ˜¯æ²’äº‹ä¸è¦äº‚æ‰“é–‹å°±ä¸æœƒæœ‰äº‹QQ</p>        <h6 id="tags-å•é¡Œèªªæ˜-å¡é “-hardwareAccelerated-ç¡¬ä»¶åŠ é€Ÿ"   >          <a href="#tags-å•é¡Œèªªæ˜-å¡é “-hardwareAccelerated-ç¡¬ä»¶åŠ é€Ÿ" class="heading-link"><i class="fas fa-link"></i></a><a href="#tags-å•é¡Œèªªæ˜-å¡é “-hardwareAccelerated-ç¡¬ä»¶åŠ é€Ÿ" class="headerlink" title="tags: å•é¡Œèªªæ˜ å¡é “ hardwareAccelerated ç¡¬ä»¶åŠ é€Ÿ"></a>tags: <code>å•é¡Œèªªæ˜</code> <code>å¡é “</code> <code>hardwareAccelerated</code> <code>ç¡¬ä»¶åŠ é€Ÿ</code></h6>      ]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
